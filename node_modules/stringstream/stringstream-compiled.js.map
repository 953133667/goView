{"version":3,"sources":["stringstream.js"],"names":[],"mappings":"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","file":"stringstream-compiled.js","sourcesContent":["var util = require('util')\nvar Stream = require('stream')\nvar StringDecoder = require('string_decoder').StringDecoder\n\nmodule.exports = StringStream\nmodule.exports.AlignedStringDecoder = AlignedStringDecoder\n\nfunction StringStream(from, to) {\n  if (!(this instanceof StringStream)) return new StringStream(from, to)\n\n  Stream.call(this)\n\n  if (from == null) from = 'utf8'\n\n  this.readable = this.writable = true\n  this.paused = false\n  this.toEncoding = (to == null ? from : to)\n  this.fromEncoding = (to == null ? '' : from)\n  this.decoder = new AlignedStringDecoder(this.toEncoding)\n}\nutil.inherits(StringStream, Stream)\n\nStringStream.prototype.write = function(data) {\n  if (!this.writable) {\n    var err = new Error('stream not writable')\n    err.code = 'EPIPE'\n    this.emit('error', err)\n    return false\n  }\n  if (this.fromEncoding) {\n    if (Buffer.isBuffer(data)) data = data.toString()\n    data = new Buffer(data, this.fromEncoding)\n  }\n  var string = this.decoder.write(data)\n  if (string.length) this.emit('data', string)\n  return !this.paused\n}\n\nStringStream.prototype.flush = function() {\n  if (this.decoder.flush) {\n    var string = this.decoder.flush()\n    if (string.length) this.emit('data', string)\n  }\n}\n\nStringStream.prototype.end = function() {\n  if (!this.writable && !this.readable) return\n  this.flush()\n  this.emit('end')\n  this.writable = this.readable = false\n  this.destroy()\n}\n\nStringStream.prototype.destroy = function() {\n  this.decoder = null\n  this.writable = this.readable = false\n  this.emit('close')\n}\n\nStringStream.prototype.pause = function() {\n  this.paused = true\n}\n\nStringStream.prototype.resume = function () {\n  if (this.paused) this.emit('drain')\n  this.paused = false\n}\n\nfunction AlignedStringDecoder(encoding) {\n  StringDecoder.call(this, encoding)\n\n  switch (this.encoding) {\n    case 'base64':\n      this.write = alignedWrite\n      this.alignedBuffer = new Buffer(3)\n      this.alignedBytes = 0\n      break\n  }\n}\nutil.inherits(AlignedStringDecoder, StringDecoder)\n\nAlignedStringDecoder.prototype.flush = function() {\n  if (!this.alignedBuffer || !this.alignedBytes) return ''\n  var leftover = this.alignedBuffer.toString(this.encoding, 0, this.alignedBytes)\n  this.alignedBytes = 0\n  return leftover\n}\n\nfunction alignedWrite(buffer) {\n  var rem = (this.alignedBytes + buffer.length) % this.alignedBuffer.length\n  if (!rem && !this.alignedBytes) return buffer.toString(this.encoding)\n\n  var returnBuffer = new Buffer(this.alignedBytes + buffer.length - rem)\n\n  this.alignedBuffer.copy(returnBuffer, 0, 0, this.alignedBytes)\n  buffer.copy(returnBuffer, this.alignedBytes, 0, buffer.length - rem)\n\n  buffer.copy(this.alignedBuffer, 0, buffer.length - rem, buffer.length)\n  this.alignedBytes = rem\n\n  return returnBuffer.toString(this.encoding)\n}\n"]}