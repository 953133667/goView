{"version":3,"sources":["applyPluginsParallelBailResultTest.js"],"names":[],"mappings":"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","file":"applyPluginsParallelBailResultTest-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Tapable = require(\"../lib/Tapable\");\r\nvar should = require(\"should\");\r\n\r\nfunction makeTestPlugin(arr, index) {\r\n\tvar last;\r\n\tvar f = function() {\r\n\t\tf.shouldNotBeCalled();\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\targs.unshift(index);\r\n\t\tlast = args;\r\n\t\tarr.push(args);\r\n\t};\r\n\tf.issue = function() {\r\n\t\tf.shouldBeCalled();\r\n\t\tlast.pop().apply(null, arguments);\r\n\t\tlast = null;\r\n\t};\r\n\tf.shouldNotBeCalled = function() {\r\n\t\tif(last) throw new Error(\"Plugin \" + index + \" was called, but shouldn't be.\");\r\n\t};\r\n\tf.shouldBeCalled = function() {\r\n\t\tif(!last) throw new Error(\"Plugin \" + index + \" was not called, but should be.\");\r\n\t};\r\n\tf.shouldBeCalledAsyncWith = function() {\r\n\t\tf.shouldBeCalled();\r\n\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\tfor(var i = 0; i < args.length && i < last.length - 2; i++) {\r\n\t\t\tif(args[i] === null || args[i] === undefined) {\r\n\t\t\t\tshould.not.exist(last[i+1]);\r\n\t\t\t} else {\r\n\t\t\t\tshould.exist(last[i+1]);\r\n\t\t\t\tlast[i+1].should.be.eql(args[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\targs.length.should.be.eql(last.length - 2);\r\n\t};\r\n\treturn f;\r\n}\r\n\r\ndescribe(\"applyPluginsParallelBailResult\", function() {\r\n\tit(\"should call all handlers\", function() {\r\n\t\tvar tapable = new Tapable();\r\n\t\tvar log = [];\r\n\t\tvar p1 = makeTestPlugin(log, 1);\r\n\t\tvar p2 = makeTestPlugin(log, 2);\r\n\t\tvar p3 = makeTestPlugin(log, 3);\r\n\t\tvar p4 = makeTestPlugin(log, 4);\r\n\t\tvar result = makeTestPlugin(log, 0);\r\n\t\ttapable.plugin(\"test\", p1);\r\n\t\ttapable.plugin(\"test\", p2);\r\n\t\ttapable.plugin(\"xxxx\", p3);\r\n\t\ttapable.plugin(\"test\", p4);\r\n\t\ttapable.applyPluginsParallelBailResult(\"test\", 1, 2, result);\r\n\t\tp1.shouldBeCalledAsyncWith(1, 2);\r\n\t\tp2.shouldBeCalledAsyncWith(1, 2);\r\n\t\tp3.shouldNotBeCalled();\r\n\t\tp4.shouldBeCalledAsyncWith(1, 2);\r\n\t\tp1.issue();\r\n\t\tp2.issue(null, \"ok\");\r\n\t\tp4.issue(null, \"fail\");\r\n\t\tlog.should.be.eql([\r\n\t\t\t[1, 1, 2],\r\n\t\t\t[2, 1, 2],\r\n\t\t\t[4, 1, 2],\r\n\t\t\t[0, null, \"ok\"]\r\n\t\t]);\r\n\t});\r\n\tit(\"should save valid results\", function() {\r\n\t\tvar tapable = new Tapable();\r\n\t\tvar log = [];\r\n\t\tvar p1 = makeTestPlugin(log, 1);\r\n\t\tvar p2 = makeTestPlugin(log, 2);\r\n\t\tvar p3 = makeTestPlugin(log, 3);\r\n\t\ttapable.plugin(\"test\", p1);\r\n\t\ttapable.plugin(\"test\", p2);\r\n\t\ttapable.plugin(\"test\", p3);\r\n\t\tvar result = makeTestPlugin(log, 0);\r\n\t\ttapable.applyPluginsParallelBailResult(\"test\", \"a\", result);\r\n\t\tp3.issue(null, \"fail\");\r\n\t\tp2.issue(null, \"ok\");\r\n\t\tp1.issue();\r\n\t\tlog.should.be.eql([\r\n\t\t\t[1, \"a\"],\r\n\t\t\t[2, \"a\"],\r\n\t\t\t[3, \"a\"],\r\n\t\t\t[0, null, \"ok\"],\r\n\t\t]);\r\n\t});\r\n\tit(\"should take the first result\", function() {\r\n\t\tvar tapable = new Tapable();\r\n\t\tvar log = [];\r\n\t\tvar p1 = makeTestPlugin(log, 1);\r\n\t\tvar p2 = makeTestPlugin(log, 2);\r\n\t\tvar p3 = makeTestPlugin(log, 3);\r\n\t\ttapable.plugin(\"test\", p1);\r\n\t\ttapable.plugin(\"test\", p2);\r\n\t\ttapable.plugin(\"test\", p3);\r\n\t\tvar result = makeTestPlugin(log, 0);\r\n\t\ttapable.applyPluginsParallelBailResult(\"test\", \"a\", result);\r\n\t\tlog.length.should.be.eql(3);\r\n\t\tp1.issue(null, \"ok\");\r\n\t\tlog.length.should.be.eql(4);\r\n\t\tp2.issue(new Error(\"fail\"));\r\n\t\tp3.issue();\r\n\t\tlog.should.be.eql([\r\n\t\t\t[1, \"a\"],\r\n\t\t\t[2, \"a\"],\r\n\t\t\t[3, \"a\"],\r\n\t\t\t[0, null, \"ok\"],\r\n\t\t]);\r\n\t});\r\n\tit(\"should return errors\", function() {\r\n\t\tvar tapable = new Tapable();\r\n\t\tvar log = [];\r\n\t\tvar p1 = makeTestPlugin(log, 1);\r\n\t\tvar p2 = makeTestPlugin(log, 2);\r\n\t\tvar p3 = makeTestPlugin(log, 3);\r\n\t\ttapable.plugin(\"test\", p1);\r\n\t\ttapable.plugin(\"test\", p2);\r\n\t\ttapable.plugin(\"test\", p3);\r\n\t\tvar result = makeTestPlugin(log, 0);\r\n\t\ttapable.applyPluginsParallelBailResult(\"test\", \"a\", result);\r\n\t\tlog.length.should.be.eql(3);\r\n\t\tp1.issue(\"ok\");\r\n\t\tlog.length.should.be.eql(4);\r\n\t\tp2.issue();\r\n\t\tp3.issue(null, \"fail\");\r\n\t\tlog.should.be.eql([\r\n\t\t\t[1, \"a\"],\r\n\t\t\t[2, \"a\"],\r\n\t\t\t[3, \"a\"],\r\n\t\t\t[0, \"ok\", undefined],\r\n\t\t]);\r\n\t});\r\n\r\n});"]}