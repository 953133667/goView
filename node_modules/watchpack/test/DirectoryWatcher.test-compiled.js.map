{"version":3,"sources":["DirectoryWatcher.test.js"],"names":[],"mappings":"AAAA;AACA,QAAQ,QAAR;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,aAAa,QAAQ,sBAAR,CAAjB;AACA,IAAI,sBAAsB,QAAQ,yBAAR,CAA1B;;AAEA,IAAI,WAAW,KAAK,IAAL,CAAU,SAAV,EAAqB,UAArB,CAAf;AACA,IAAI,aAAa,IAAI,UAAJ,CAAe,QAAf,CAAjB;;AAEA,IAAI,eAAe,EAAnB;;AAEA,IAAI,mBAAmB,UAAS,CAAT,EAAY,OAAZ,EAAqB;AAC3C,KAAI,IAAI,IAAI,mBAAJ,CAAwB,CAAxB,EAA2B,OAA3B,CAAR;AACA,cAAa,IAAb,CAAkB,CAAlB;AACA,KAAI,WAAW,EAAE,KAAjB;AACA,GAAE,KAAF,GAAU,YAAW;AACpB,WAAS,IAAT,CAAc,IAAd;AACA,MAAI,MAAM,aAAa,OAAb,CAAqB,CAArB,CAAV;AACA,MAAG,MAAM,CAAT,EACC,MAAM,IAAI,KAAJ,CAAU,qCAAV,CAAN;AACD,eAAa,MAAb,CAAoB,GAApB,EAAyB,CAAzB;AACA,EAND;AAOA,QAAO,CAAP;AACA,CAZD;;AAcA,SAAS,kBAAT,EAA6B,YAAW;AACvC,MAAK,OAAL,CAAa,KAAb;AACA,YAAW,WAAW,MAAtB;AACA,WAAU,WAAW,KAArB;AACA,WAAU,YAAW;AACpB,eAAa,OAAb,CAAqB,UAAS,CAAT,EAAY;AAChC,WAAQ,GAAR,CAAY,uBAAuB,EAAE,IAAzB,GAAgC,mBAA5C;AACA,KAAE,KAAF;AACA,GAHD;AAIA,EALD;;AAOA,IAAG,+BAAH,EAAoC,UAAS,IAAT,EAAe;AAClD,MAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,MAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,CAAR;AACA,IAAE,EAAF,CAAK,QAAL,EAAe,UAAS,KAAT,EAAgB;AAC9B,SAAM,MAAN,CAAa,EAAb,CAAgB,IAAhB,CAAqB,QAArB;AACA,UAAO,IAAP,CAAY,EAAE,QAAF,EAAZ,EAA0B,IAA1B,GAAiC,MAAjC,CAAwC,EAAxC,CAA2C,GAA3C,CAA+C,CAC9C,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAD8C,CAA/C;AAGA,KAAE,KAAF;AACA;AACA,GAPD;AAQA,aAAW,IAAX,CAAgB,YAAW;AAC1B,cAAW,IAAX,CAAgB,GAAhB;AACA,GAFD;AAGA,EAdD;;AAgBA,IAAG,6BAAH,EAAkC,UAAS,IAAT,EAAe;AAChD,MAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,aAAW,IAAX,CAAgB,GAAhB;AACA,MAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,CAAR;AACA,IAAE,EAAF,CAAK,QAAL,EAAe,UAAS,KAAT,EAAgB;AAC9B,SAAM,MAAN,CAAa,EAAb,CAAgB,IAAhB,CAAqB,QAArB;AACA,KAAE,KAAF;AACA;AACA,GAJD;AAKA,aAAW,IAAX,CAAgB,YAAW;AAC1B,cAAW,IAAX,CAAgB,GAAhB;AACA,GAFD;AAGA,EAZD;;AAcA,IAAG,iDAAH,EAAsD,UAAS,IAAT,EAAe;AACpE,aAAW,IAAX,CAAgB,GAAhB;AACA,aAAW,IAAX,CAAgB,YAAW;AAC1B,OAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,OAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,CAAR;AACA,KAAE,EAAF,CAAK,QAAL,EAAe,YAAW;AACzB,UAAM,IAAI,KAAJ,CAAU,wBAAV,CAAN;AACA,IAFD;AAGA,cAAW,IAAX,CAAgB,YAAW;AAC1B,MAAE,KAAF;AACA;AACA,IAHD;AAIA,GAVD;AAWA,EAbD;;AAeA,IAAG,6DAAH,EAAkE,UAAS,IAAT,EAAe;AAChF,MAAI,QAAQ,IAAI,IAAJ,EAAZ;AACA,aAAW,IAAX,CAAgB,IAAhB,EAAsB,YAAW;AAChC,cAAW,IAAX,CAAgB,GAAhB;AACA,cAAW,IAAX,CAAgB,IAAhB,EAAsB,YAAW;AAChC,QAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,QAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,EAAkC,KAAlC,CAAR;AACA,MAAE,EAAF,CAAK,QAAL,EAAe,YAAW;AACzB,OAAE,KAAF;AACA;AACA,KAHD;AAIA,IAPD;AAQA,GAVD;AAWA,EAbD;;AAeA,IAAG,oEAAH,EAAyE,UAAS,IAAT,EAAe;AACvF,aAAW,IAAX,CAAgB,GAAhB;AACA,aAAW,IAAX,CAAgB,YAAW;AAC1B,OAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,OAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,CAAR;AACA,KAAE,EAAF,CAAK,QAAL,EAAe,YAAW;AACzB,UAAM,IAAI,KAAJ,CAAU,wBAAV,CAAN;AACA,IAFD;AAGA,cAAW,IAAX,CAAgB,YAAW;AAC1B,MAAE,KAAF;AACA;AACA,IAHD;AAIA,GAVD;AAWA,EAbD;;AAeA,KAAI,UAAU;AACb,QAAM,GADO;AAEb,QAAM;AAFO,EAAd;AAIA,QAAO,IAAP,CAAY,OAAZ,EAAqB,OAArB,CAA6B,UAAS,IAAT,EAAe;AAC3C,MAAI,OAAO,QAAQ,IAAR,CAAX;AACA,KAAG,0CAA0C,IAA1C,GAAiD,GAApD,EAAyD,UAAS,IAAT,EAAe;AACvE,OAAI,IAAI,IAAI,gBAAJ,CAAqB,QAArB,EAA+B,EAA/B,CAAR;AACA,cAAW,IAAX,CAAgB,GAAhB;AACA,cAAW,IAAX,CAAgB,YAAW;AAC1B,QAAI,IAAI,EAAE,KAAF,CAAQ,KAAK,IAAL,CAAU,QAAV,EAAoB,GAApB,CAAR,CAAR;AACA,QAAI,QAAQ,EAAZ;AACA,QAAI,aAAa,KAAjB;AACA,MAAE,EAAF,CAAK,QAAL,EAAe,UAAS,KAAT,EAAgB;AAC9B,WAAM,MAAN,CAAa,EAAb,CAAgB,IAAhB,CAAqB,QAArB;AACA,SAAG,CAAC,UAAJ,EAAgB;AAChB,kBAAa,KAAb;AACA,SAAG,WAAW,CAAd,EAAiB;AAChB,QAAE,KAAF;AACA;AACA,MAHD,MAGO;AACN,iBAAW,IAAX,CAAgB,IAAhB,EAAsB,YAAW;AAChC,oBAAa,IAAb;AACA,kBAAW,IAAX,CAAgB,GAAhB;AACA,OAHD;AAIA;AACD,KAbD;AAcA,eAAW,IAAX,CAAgB,YAAW;AAC1B,kBAAa,IAAb;AACA,gBAAW,IAAX,CAAgB,GAAhB;AACA,KAHD;AAIA,IAtBD;AAuBA,GA1BD;AA2BA,EA7BD;AA8BA,CAxHD","file":"DirectoryWatcher.test-compiled.js","sourcesContent":["/*globals describe it beforeEach afterEach */\r\nrequire(\"should\");\r\nvar path = require(\"path\");\r\nvar TestHelper = require(\"./helpers/TestHelper\");\r\nvar OrgDirectoryWatcher = require(\"../lib/DirectoryWatcher\");\r\n\r\nvar fixtures = path.join(__dirname, \"fixtures\");\r\nvar testHelper = new TestHelper(fixtures);\r\n\r\nvar openWatchers = [];\r\n\r\nvar DirectoryWatcher = function(p, options) {\r\n\tvar d = new OrgDirectoryWatcher(p, options);\r\n\topenWatchers.push(d);\r\n\tvar orgClose = d.close;\r\n\td.close = function() {\r\n\t\torgClose.call(this);\r\n\t\tvar idx = openWatchers.indexOf(d);\r\n\t\tif(idx < 0)\r\n\t\t\tthrow new Error(\"DirectoryWatcher was already closed\");\r\n\t\topenWatchers.splice(idx, 1);\r\n\t};\r\n\treturn d;\r\n};\r\n\r\ndescribe(\"DirectoryWatcher\", function() {\r\n\tthis.timeout(10000);\r\n\tbeforeEach(testHelper.before);\r\n\tafterEach(testHelper.after);\r\n\tafterEach(function() {\r\n\t\topenWatchers.forEach(function(d) {\r\n\t\t\tconsole.log(\"DirectoryWatcher (\" + d.path + \") was not closed.\");\r\n\t\t\td.close();\r\n\t\t});\r\n\t});\r\n\r\n\tit(\"should detect a file creation\", function(done) {\r\n\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\tvar a = d.watch(path.join(fixtures, \"a\"));\r\n\t\ta.on(\"change\", function(mtime) {\r\n\t\t\tmtime.should.be.type(\"number\");\r\n\t\t\tObject.keys(d.getTimes()).sort().should.be.eql([\r\n\t\t\t\tpath.join(fixtures, \"a\")\r\n\t\t\t]);\r\n\t\t\ta.close();\r\n\t\t\tdone();\r\n\t\t});\r\n\t\ttestHelper.tick(function() {\r\n\t\t\ttestHelper.file(\"a\");\r\n\t\t});\r\n\t});\r\n\r\n\tit(\"should detect a file change\", function(done) {\r\n\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\ttestHelper.file(\"a\");\r\n\t\tvar a = d.watch(path.join(fixtures, \"a\"));\r\n\t\ta.on(\"change\", function(mtime) {\r\n\t\t\tmtime.should.be.type(\"number\");\r\n\t\t\ta.close();\r\n\t\t\tdone();\r\n\t\t});\r\n\t\ttestHelper.tick(function() {\r\n\t\t\ttestHelper.file(\"a\");\r\n\t\t});\r\n\t});\r\n\r\n\tit(\"should not detect a file change in initial scan\", function(done) {\r\n\t\ttestHelper.file(\"a\");\r\n\t\ttestHelper.tick(function() {\r\n\t\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\t\tvar a = d.watch(path.join(fixtures, \"a\"));\r\n\t\t\ta.on(\"change\", function() {\r\n\t\t\t\tthrow new Error(\"should not be detected\");\r\n\t\t\t});\r\n\t\t\ttestHelper.tick(function() {\r\n\t\t\t\ta.close();\r\n\t\t\t\tdone();\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\tit(\"should detect a file change in initial scan with start date\", function(done) {\r\n\t\tvar start = new Date();\r\n\t\ttestHelper.tick(1000, function() {\r\n\t\t\ttestHelper.file(\"a\");\r\n\t\t\ttestHelper.tick(1000, function() {\r\n\t\t\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\t\t\tvar a = d.watch(path.join(fixtures, \"a\"), start);\r\n\t\t\t\ta.on(\"change\", function() {\r\n\t\t\t\t\ta.close();\r\n\t\t\t\t\tdone();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\tit(\"should not detect a file change in initial scan without start date\", function(done) {\r\n\t\ttestHelper.file(\"a\");\r\n\t\ttestHelper.tick(function() {\r\n\t\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\t\tvar a = d.watch(path.join(fixtures, \"a\"));\r\n\t\t\ta.on(\"change\", function() {\r\n\t\t\t\tthrow new Error(\"should not be detected\");\r\n\t\t\t});\r\n\t\t\ttestHelper.tick(function() {\r\n\t\t\t\ta.close();\r\n\t\t\t\tdone();\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n\r\n\tvar timings = {\r\n\t\tslow: 300,\r\n\t\tfast: 50\r\n\t};\r\n\tObject.keys(timings).forEach(function(name) {\r\n\t\tvar time = timings[name];\r\n\t\tit(\"should detect multiple file changes (\" + name + \")\", function(done) {\r\n\t\t\tvar d = new DirectoryWatcher(fixtures, {});\r\n\t\t\ttestHelper.file(\"a\");\r\n\t\t\ttestHelper.tick(function() {\r\n\t\t\t\tvar a = d.watch(path.join(fixtures, \"a\"));\r\n\t\t\t\tvar count = 20;\r\n\t\t\t\tvar wasChanged = false;\r\n\t\t\t\ta.on(\"change\", function(mtime) {\r\n\t\t\t\t\tmtime.should.be.type(\"number\");\r\n\t\t\t\t\tif(!wasChanged) return;\r\n\t\t\t\t\twasChanged = false;\r\n\t\t\t\t\tif(count-- <= 0) {\r\n\t\t\t\t\t\ta.close();\r\n\t\t\t\t\t\tdone();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttestHelper.tick(time, function() {\r\n\t\t\t\t\t\t\twasChanged = true;\r\n\t\t\t\t\t\t\ttestHelper.file(\"a\");\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\ttestHelper.tick(function() {\r\n\t\t\t\t\twasChanged = true;\r\n\t\t\t\t\ttestHelper.file(\"a\");\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t});\r\n});\r\n"]}