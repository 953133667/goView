{"version":3,"sources":["watchpack.js"],"names":[],"mappings":"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","file":"watchpack-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar watcherManager = require(\"./watcherManager\");\r\nvar EventEmitter = require(\"events\").EventEmitter;\r\n\r\nfunction Watchpack(options) {\r\n\tEventEmitter.call(this);\r\n\tif(!options) options = {};\r\n\tif(!options.aggregateTimeout) options.aggregateTimeout = 200;\r\n\tthis.options = options;\r\n\tthis.watcherOptions = {\r\n\t\tpoll: options.poll\r\n\t};\r\n\tthis.fileWatchers = [];\r\n\tthis.dirWatchers = [];\r\n\tthis.mtimes = {};\r\n\tthis.paused = false;\r\n\tthis.aggregatedChanges = [];\r\n\tthis.aggregateTimeout = 0;\r\n\tthis._onTimeout = this._onTimeout.bind(this);\r\n}\r\n\r\nmodule.exports = Watchpack;\r\n\r\nWatchpack.prototype = Object.create(EventEmitter.prototype);\r\n\r\nWatchpack.prototype.watch = function watch(files, directories, startTime) {\r\n\tthis.paused = false;\r\n\tvar oldFileWatchers = this.fileWatchers;\r\n\tvar oldDirWatchers = this.dirWatchers;\r\n\tthis.fileWatchers = files.map(function(file) {\r\n\t\treturn this._fileWatcher(file, watcherManager.watchFile(file, this.watcherOptions, startTime));\r\n\t}, this);\r\n\tthis.dirWatchers = directories.map(function(dir) {\r\n\t\treturn this._dirWatcher(dir, watcherManager.watchDirectory(dir, this.watcherOptions, startTime));\r\n\t}, this);\r\n\toldFileWatchers.forEach(function(w) {\r\n\t\tw.close();\r\n\t}, this);\r\n\toldDirWatchers.forEach(function(w) {\r\n\t\tw.close();\r\n\t}, this);\r\n};\r\n\r\nWatchpack.prototype.close = function resume() {\r\n\tthis.paused = true;\r\n\tif(this.aggregateTimeout)\r\n\t\tclearTimeout(this.aggregateTimeout);\r\n\tthis.fileWatchers.forEach(function(w) {\r\n\t\tw.close();\r\n\t}, this);\r\n\tthis.dirWatchers.forEach(function(w) {\r\n\t\tw.close();\r\n\t}, this);\r\n\tthis.fileWatchers.length = 0;\r\n\tthis.dirWatchers.length = 0;\r\n};\r\n\r\nWatchpack.prototype.pause = function pause() {\r\n\tthis.paused = true;\r\n\tif(this.aggregateTimeout)\r\n\t\tclearTimeout(this.aggregateTimeout);\r\n};\r\n\r\nfunction addWatchersToArray(watchers, array) {\r\n\twatchers.forEach(function(w) {\r\n\t\tif(array.indexOf(w.directoryWatcher) < 0) {\r\n\t\t\tarray.push(w.directoryWatcher);\r\n\t\t\taddWatchersToArray(Object.keys(w.directoryWatcher.directories).reduce(function(a, dir) {\r\n\t\t\t\tif(w.directoryWatcher.directories[dir] !== true)\r\n\t\t\t\t\ta.push(w.directoryWatcher.directories[dir]);\r\n\t\t\t\treturn a;\r\n\t\t\t}, []), array);\r\n\t\t}\r\n\t});\r\n}\r\n\r\nWatchpack.prototype.getTimes = function() {\r\n\tvar directoryWatchers = [];\r\n\taddWatchersToArray(this.fileWatchers.concat(this.dirWatchers), directoryWatchers);\r\n\tvar obj = {};\r\n\tdirectoryWatchers.forEach(function(w) {\r\n\t\tvar times = w.getTimes();\r\n\t\tObject.keys(times).forEach(function(file) {\r\n\t\t\tobj[file] = times[file];\r\n\t\t});\r\n\t});\r\n\treturn obj;\r\n};\r\n\r\nWatchpack.prototype._fileWatcher = function _fileWatcher(file, watcher) {\r\n\twatcher.on(\"change\", this._onChange.bind(this, file));\r\n\treturn watcher;\r\n};\r\n\r\nWatchpack.prototype._dirWatcher = function _dirWatcher(item, watcher) {\r\n\twatcher.on(\"change\", function(file, mtime) {\r\n\t\tthis._onChange(item, mtime, file);\r\n\t}.bind(this));\r\n\treturn watcher;\r\n};\r\n\r\nWatchpack.prototype._onChange = function _onChange(item, mtime, file) {\r\n\tfile = file || item;\r\n\tthis.mtimes[file] = mtime;\r\n\tif(this.paused) return;\r\n\tthis.emit(\"change\", file, mtime);\r\n\tif(this.aggregateTimeout)\r\n\t\tclearTimeout(this.aggregateTimeout);\r\n\tif(this.aggregatedChanges.indexOf(item) < 0)\r\n\t\tthis.aggregatedChanges.push(item);\r\n\tthis.aggregateTimeout = setTimeout(this._onTimeout, this.options.aggregateTimeout);\r\n};\r\n\r\nWatchpack.prototype._onTimeout = function _onTimeout() {\r\n\tthis.aggregateTimeout = 0;\r\n\tvar changes = this.aggregatedChanges;\r\n\tthis.aggregatedChanges = [];\r\n\tthis.emit(\"aggregated\", changes);\r\n};\r\n"]}