{"version":3,"sources":["DirectoryWatcher.js"],"names":[],"mappings":"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","file":"DirectoryWatcher-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar EventEmitter = require(\"events\").EventEmitter;\r\nvar async = require(\"async\");\r\nvar chokidar = require(\"chokidar\");\r\nvar fs = require(\"graceful-fs\");\r\nvar path = require(\"path\");\r\n\r\nvar watcherManager = require(\"./watcherManager\");\r\n\r\nvar FS_ACCURENCY = 10000;\r\n\r\n\r\nfunction withoutCase(str) {\r\n\treturn str.toLowerCase();\r\n}\r\n\r\n\r\nfunction Watcher(directoryWatcher, filePath, startTime) {\r\n\tEventEmitter.call(this);\r\n\tthis.directoryWatcher = directoryWatcher;\r\n\tthis.path = filePath;\r\n\tthis.startTime = startTime && +startTime;\r\n\tthis.data = 0;\r\n}\r\n\r\nWatcher.prototype = Object.create(EventEmitter.prototype);\r\nWatcher.prototype.constructor = Watcher;\r\n\r\nWatcher.prototype.checkStartTime = function checkStartTime(mtime, initial) {\r\n\tif(typeof this.startTime !== \"number\") return !initial;\r\n\tvar startTime = this.startTime && Math.floor(this.startTime / FS_ACCURENCY) * FS_ACCURENCY;\r\n\treturn startTime <= mtime;\r\n};\r\n\r\nWatcher.prototype.close = function close() {\r\n\tthis.emit(\"closed\");\r\n};\r\n\r\n\r\nfunction DirectoryWatcher(directoryPath, options) {\r\n\tEventEmitter.call(this);\r\n\tthis.path = directoryPath;\r\n\tthis.files = {};\r\n\tthis.directories = {};\r\n\tthis.watcher = chokidar.watch(directoryPath, {\r\n\t\tignoreInitial: true,\r\n\t\tpersistent: true,\r\n\t\tfollowSymlinks: false,\r\n\t\tdepth: 0,\r\n\t\tatomic: false,\r\n\t\talwaysStat: true,\r\n\t\tignorePermissionErrors: true,\r\n\t\tusePolling: options.poll ? true : undefined,\r\n\t\tinterval: typeof options.poll === \"number\" ? options.poll : undefined\r\n\t});\r\n\tthis.watcher.on(\"add\", this.onFileAdded.bind(this));\r\n\tthis.watcher.on(\"addDir\", this.onDirectoryAdded.bind(this));\r\n\tthis.watcher.on(\"change\", this.onChange.bind(this));\r\n\tthis.watcher.on(\"unlink\", this.onFileUnlinked.bind(this));\r\n\tthis.watcher.on(\"unlinkDir\", this.onDirectoryUnlinked.bind(this));\r\n\tthis.watcher.on(\"error\", this.onWatcherError.bind(this));\r\n\tthis.initialScan = true;\r\n\tthis.nestedWatching = false;\r\n\tthis.initialScanRemoved = [];\r\n\tthis.doInitialScan();\r\n\tthis.watchers = {};\r\n\tthis.refs = 0;\r\n}\r\nmodule.exports = DirectoryWatcher;\r\n\r\nDirectoryWatcher.prototype = Object.create(EventEmitter.prototype);\r\nDirectoryWatcher.prototype.constructor = DirectoryWatcher;\r\n\r\nDirectoryWatcher.prototype.setFileTime = function setFileTime(filePath, mtime, initial, type) {\r\n\tvar now = Date.now();\r\n\tvar old = this.files[filePath];\r\n\tthis.files[filePath] = [initial ? Math.min(now, mtime) : now, mtime];\r\n\tif(!old) {\r\n\t\tif(mtime) {\r\n\t\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\t\tif(!initial || w.checkStartTime(mtime, initial)) {\r\n\t\t\t\t\t\tw.emit(\"change\", mtime);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t} else if(!initial && mtime && type !== \"add\") {\r\n\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\tw.emit(\"change\", mtime);\r\n\t\t\t});\r\n\t\t}\r\n\t} else if(!initial && !mtime) {\r\n\t\tif(this.watchers[withoutCase(filePath)]) {\r\n\t\t\tthis.watchers[withoutCase(filePath)].forEach(function(w) {\r\n\t\t\t\tw.emit(\"remove\");\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tif(this.watchers[withoutCase(this.path)]) {\r\n\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\tif(!initial || w.checkStartTime(mtime, initial)) {\r\n\t\t\t\tw.emit(\"change\", filePath, mtime);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.setDirectory = function setDirectory(directoryPath, exist, initial) {\r\n\tvar old = this.directories[directoryPath];\r\n\tif(!old) {\r\n\t\tif(exist) {\r\n\t\t\tif(this.nestedWatching) {\r\n\t\t\t\tthis.createNestedWatcher(directoryPath);\r\n\t\t\t} else {\r\n\t\t\t\tthis.directories[directoryPath] = true;\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif(!exist) {\r\n\t\t\tif(this.nestedWatching)\r\n\t\t\t\tthis.directories[directoryPath].close();\r\n\t\t\tdelete this.directories[directoryPath];\r\n\t\t\tif(!initial && this.watchers[withoutCase(this.path)]) {\r\n\t\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\t\tw.emit(\"change\", directoryPath, w.data);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.createNestedWatcher = function(directoryPath) {\r\n\tthis.directories[directoryPath] = watcherManager.watchDirectory(directoryPath, this.options, 1);\r\n\tthis.directories[directoryPath].on(\"change\", function(filePath, mtime) {\r\n\t\tif(this.watchers[withoutCase(this.path)]) {\r\n\t\t\tthis.watchers[withoutCase(this.path)].forEach(function(w) {\r\n\t\t\t\tif(w.checkStartTime(mtime, false)) {\r\n\t\t\t\t\tw.emit(\"change\", filePath, mtime);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}.bind(this));\r\n};\r\n\r\nDirectoryWatcher.prototype.setNestedWatching = function(flag) {\r\n\tif(this.nestedWatching !== !!flag) {\r\n\t\tthis.nestedWatching = !!flag;\r\n\t\tif(this.nestedWatching) {\r\n\t\t\tObject.keys(this.directories).forEach(function(directory) {\r\n\t\t\t\tthis.createNestedWatcher(directory);\r\n\t\t\t}, this);\r\n\t\t} else {\r\n\t\t\tObject.keys(this.directories).forEach(function(directory) {\r\n\t\t\t\tthis.directories[directory].close();\r\n\t\t\t\tthis.directories[directory] = true;\r\n\t\t\t}, this);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.watch = function watch(filePath, startTime) {\r\n\tthis.watchers[withoutCase(filePath)] = this.watchers[withoutCase(filePath)] || [];\r\n\tthis.refs++;\r\n\tvar watcher = new Watcher(this, filePath, startTime);\r\n\twatcher.on(\"closed\", function() {\r\n\t\tvar idx = this.watchers[withoutCase(filePath)].indexOf(watcher);\r\n\t\tthis.watchers[withoutCase(filePath)].splice(idx, 1);\r\n\t\tif(this.watchers[withoutCase(filePath)].length === 0) {\r\n\t\t\tdelete this.watchers[withoutCase(filePath)];\r\n\t\t\tif(this.path === filePath)\r\n\t\t\t\tthis.setNestedWatching(false);\r\n\t\t}\r\n\t\tif(--this.refs <= 0)\r\n\t\t\tthis.close();\r\n\t}.bind(this));\r\n\tthis.watchers[withoutCase(filePath)].push(watcher);\r\n\tvar data;\r\n\tif(filePath === this.path) {\r\n\t\tthis.setNestedWatching(true);\r\n\t\tdata = false;\r\n\t\tObject.keys(this.files).forEach(function(file) {\r\n\t\t\tvar d = this.files[file];\r\n\t\t\tif(!data)\r\n\t\t\t\tdata = d;\r\n\t\t\telse\r\n\t\t\t\tdata = [Math.max(data[0], d[0]), Math.max(data[1], d[1])];\r\n\t\t}, this);\r\n\t} else {\r\n\t\tdata = this.files[filePath];\r\n\t}\r\n\tprocess.nextTick(function() {\r\n\t\tif(data) {\r\n\t\t\tif(data[0] > startTime)\r\n\t\t\t\twatcher.emit(\"change\", data[1]);\r\n\t\t} else if(this.initialScan && this.initialScanRemoved.indexOf(filePath) >= 0) {\r\n\t\t\twatcher.emit(\"remove\");\r\n\t\t}\r\n\t}.bind(this));\r\n\treturn watcher;\r\n};\r\n\r\nDirectoryWatcher.prototype.onFileAdded = function onFileAdded(filePath, stat) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\r\n\tthis.setFileTime(filePath, +stat.mtime, false, \"add\");\r\n};\r\n\r\nDirectoryWatcher.prototype.onDirectoryAdded = function onDirectoryAdded(directoryPath /*, stat */) {\r\n\tif(directoryPath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\r\n\tthis.setDirectory(directoryPath, true, false);\r\n};\r\n\r\nDirectoryWatcher.prototype.onChange = function onChange(filePath, stat) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\tvar mtime = +stat.mtime;\r\n\tif(FS_ACCURENCY > 1 && mtime % 1 !== 0)\r\n\t\tFS_ACCURENCY = 1;\r\n\telse if(FS_ACCURENCY > 10 && mtime % 10 !== 0)\r\n\t\tFS_ACCURENCY = 10;\r\n\telse if(FS_ACCURENCY > 100 && mtime % 100 !== 0)\r\n\t\tFS_ACCURENCY = 100;\r\n\telse if(FS_ACCURENCY > 1000 && mtime % 1000 !== 0)\r\n\t\tFS_ACCURENCY = 1000;\r\n\telse if(FS_ACCURENCY > 2000 && mtime % 2000 !== 0)\r\n\t\tFS_ACCURENCY = 2000;\r\n\tthis.setFileTime(filePath, mtime, false, \"change\");\r\n};\r\n\r\nDirectoryWatcher.prototype.onFileUnlinked = function onFileUnlinked(filePath) {\r\n\tif(filePath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(filePath.substr(this.path.length + 1))) return;\r\n\tthis.setFileTime(filePath, null, false, \"unlink\");\r\n\tif(this.initialScan) {\r\n\t\tthis.initialScanRemoved.push(filePath);\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.onDirectoryUnlinked = function onDirectoryUnlinked(directoryPath) {\r\n\tif(directoryPath.indexOf(this.path) !== 0) return;\r\n\tif(/[\\\\\\/]/.test(directoryPath.substr(this.path.length + 1))) return;\r\n\tthis.setDirectory(directoryPath, false, false);\r\n\tif(this.initialScan) {\r\n\t\tthis.initialScanRemoved.push(directoryPath);\r\n\t}\r\n};\r\n\r\nDirectoryWatcher.prototype.onWatcherError = function onWatcherError(/* err */) {\r\n};\r\n\r\nDirectoryWatcher.prototype.doInitialScan = function doInitialScan() {\r\n\tfs.readdir(this.path, function(err, items) {\r\n\t\tif(err) {\r\n\t\t\tthis.initialScan = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tasync.forEach(items, function(item, callback) {\r\n\t\t\tvar itemPath = path.join(this.path, item);\r\n\t\t\tfs.stat(itemPath, function(err2, stat) {\r\n\t\t\t\tif(!this.initialScan) return;\r\n\t\t\t\tif(err2) {\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif(stat.isFile()) {\r\n\t\t\t\t\tif(!this.files[itemPath])\r\n\t\t\t\t\t\tthis.setFileTime(itemPath, +stat.mtime, true);\r\n\t\t\t\t} else if(stat.isDirectory()) {\r\n\t\t\t\t\tif(!this.directories[itemPath])\r\n\t\t\t\t\t\tthis.setDirectory(itemPath, true, true);\r\n\t\t\t\t}\r\n\t\t\t\tcallback();\r\n\t\t\t}.bind(this));\r\n\t\t}.bind(this), function() {\r\n\t\t\tthis.initialScan = false;\r\n\t\t\tthis.initialScanRemoved = null;\r\n\t\t}.bind(this));\r\n\t}.bind(this));\r\n};\r\n\r\nDirectoryWatcher.prototype.getTimes = function() {\r\n\tvar obj = {};\r\n\tvar selfTime = 0;\r\n\tObject.keys(this.files).forEach(function(file) {\r\n\t\tvar data = this.files[file];\r\n\t\tif(data[1]) {\r\n\t\t\tvar time = Math.max(data[0], data[1]);\r\n\t\t\tobj[file] = time;\r\n\t\t\tif(time > selfTime)\r\n\t\t\t\tselfTime = time;\r\n\t\t}\r\n\t}, this);\r\n\tif(this.nestedWatching) {\r\n\t\tObject.keys(this.directories).forEach(function(dir) {\r\n\t\t\tvar w = this.directories[dir];\r\n\t\t\tvar times = w.directoryWatcher.getTimes();\r\n\t\t\tObject.keys(times).forEach(function(file) {\r\n\t\t\t\tvar time = times[file];\r\n\t\t\t\tobj[file] = time;\r\n\t\t\t\tif(time > selfTime)\r\n\t\t\t\t\tselfTime = time;\r\n\t\t\t});\r\n\t\t}, this);\r\n\t\tobj[this.path] = selfTime;\r\n\t}\r\n\treturn obj;\r\n};\r\n\r\nDirectoryWatcher.prototype.close = function() {\r\n\tthis.initialScan = false;\r\n\tthis.watcher.close();\r\n\tif(this.nestedWatching) {\r\n\t\tObject.keys(this.directories).forEach(function(dir) {\r\n\t\t\tthis.directories[dir].close();\r\n\t\t}, this);\r\n\t}\r\n\tthis.emit(\"closed\");\r\n};\r\n"]}