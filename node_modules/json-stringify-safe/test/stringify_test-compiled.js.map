{"version":3,"sources":["stringify_test.js"],"names":[],"mappings":"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","file":"stringify_test-compiled.js","sourcesContent":["var Sinon = require(\"sinon\")\nvar stringify = require(\"..\")\nfunction jsonify(obj) { return JSON.stringify(obj, null, 2) }\n\ndescribe(\"Stringify\", function() {\n  it(\"must stringify circular objects\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = obj\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n  })\n\n  it(\"must stringify circular objects with intermediaries\", function() {\n    var obj = {name: \"Alice\"}\n    obj.identity = {self: obj}\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify({name: \"Alice\", identity: {self: \"[Circular ~]\"}}))\n  })\n\n  it(\"must stringify circular objects deeper\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n    obj.child.self = obj.child\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      child: {name: \"Bob\", self: \"[Circular ~.child]\"}\n    }))\n  })\n\n  it(\"must stringify circular objects deeper with intermediaries\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n    obj.child.identity = {self: obj.child}\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      child: {name: \"Bob\", identity: {self: \"[Circular ~.child]\"}}\n    }))\n  })\n\n  it(\"must stringify circular objects in an array\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = [obj, obj]\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\", self: [\"[Circular ~]\", \"[Circular ~]\"]\n    }))\n  })\n\n  it(\"must stringify circular objects deeper in an array\", function() {\n    var obj = {name: \"Alice\", children: [{name: \"Bob\"}, {name: \"Eve\"}]}\n    obj.children[0].self = obj.children[0]\n    obj.children[1].self = obj.children[1]\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      name: \"Alice\",\n      children: [\n        {name: \"Bob\", self: \"[Circular ~.children.0]\"},\n        {name: \"Eve\", self: \"[Circular ~.children.1]\"}\n      ]\n    }))\n  })\n\n  it(\"must stringify circular arrays\", function() {\n    var obj = []\n    obj.push(obj)\n    obj.push(obj)\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify([\"[Circular ~]\", \"[Circular ~]\"]))\n  })\n\n  it(\"must stringify circular arrays with intermediaries\", function() {\n    var obj = []\n    obj.push({name: \"Alice\", self: obj})\n    obj.push({name: \"Bob\", self: obj})\n\n    stringify(obj, null, 2).must.eql(jsonify([\n      {name: \"Alice\", self: \"[Circular ~]\"},\n      {name: \"Bob\", self: \"[Circular ~]\"}\n    ]))\n  })\n\n  it(\"must stringify repeated objects in objects\", function() {\n    var obj = {}\n    var alice = {name: \"Alice\"}\n    obj.alice1 = alice\n    obj.alice2 = alice\n\n    stringify(obj, null, 2).must.eql(jsonify({\n      alice1: {name: \"Alice\"},\n      alice2: {name: \"Alice\"}\n    }))\n  })\n\n  it(\"must stringify repeated objects in arrays\", function() {\n    var alice = {name: \"Alice\"}\n    var obj = [alice, alice]\n    var json = stringify(obj, null, 2)\n    json.must.eql(jsonify([{name: \"Alice\"}, {name: \"Alice\"}]))\n  })\n\n  it(\"must call given decycler and use its output\", function() {\n    var obj = {}\n    obj.a = obj\n    obj.b = obj\n\n    var decycle = Sinon.spy(function() { return decycle.callCount })\n    var json = stringify(obj, null, 2, decycle)\n    json.must.eql(jsonify({a: 1, b: 2}, null, 2))\n\n    decycle.callCount.must.equal(2)\n    decycle.thisValues[0].must.equal(obj)\n    decycle.args[0][0].must.equal(\"a\")\n    decycle.args[0][1].must.equal(obj)\n    decycle.thisValues[1].must.equal(obj)\n    decycle.args[1][0].must.equal(\"b\")\n    decycle.args[1][1].must.equal(obj)\n  })\n\n  it(\"must call replacer and use its output\", function() {\n    var obj = {name: \"Alice\", child: {name: \"Bob\"}}\n\n    var replacer = Sinon.spy(bangString)\n    var json = stringify(obj, replacer, 2)\n    json.must.eql(jsonify({name: \"Alice!\", child: {name: \"Bob!\"}}))\n\n    replacer.callCount.must.equal(4)\n    replacer.args[0][0].must.equal(\"\")\n    replacer.args[0][1].must.equal(obj)\n    replacer.thisValues[1].must.equal(obj)\n    replacer.args[1][0].must.equal(\"name\")\n    replacer.args[1][1].must.equal(\"Alice\")\n    replacer.thisValues[2].must.equal(obj)\n    replacer.args[2][0].must.equal(\"child\")\n    replacer.args[2][1].must.equal(obj.child)\n    replacer.thisValues[3].must.equal(obj.child)\n    replacer.args[3][0].must.equal(\"name\")\n    replacer.args[3][1].must.equal(\"Bob\")\n  })\n\n  it(\"must call replacer after describing circular references\", function() {\n    var obj = {name: \"Alice\"}\n    obj.self = obj\n\n    var replacer = Sinon.spy(bangString)\n    var json = stringify(obj, replacer, 2)\n    json.must.eql(jsonify({name: \"Alice!\", self: \"[Circular ~]!\"}))\n\n    replacer.callCount.must.equal(3)\n    replacer.args[0][0].must.equal(\"\")\n    replacer.args[0][1].must.equal(obj)\n    replacer.thisValues[1].must.equal(obj)\n    replacer.args[1][0].must.equal(\"name\")\n    replacer.args[1][1].must.equal(\"Alice\")\n    replacer.thisValues[2].must.equal(obj)\n    replacer.args[2][0].must.equal(\"self\")\n    replacer.args[2][1].must.equal(\"[Circular ~]\")\n  })\n\n  it(\"must call given decycler and use its output for nested objects\",\n    function() {\n    var obj = {}\n    obj.a = obj\n    obj.b = {self: obj}\n\n    var decycle = Sinon.spy(function() { return decycle.callCount })\n    var json = stringify(obj, null, 2, decycle)\n    json.must.eql(jsonify({a: 1, b: {self: 2}}))\n\n    decycle.callCount.must.equal(2)\n    decycle.args[0][0].must.equal(\"a\")\n    decycle.args[0][1].must.equal(obj)\n    decycle.args[1][0].must.equal(\"self\")\n    decycle.args[1][1].must.equal(obj)\n  })\n\n  it(\"must use decycler's output when it returned null\", function() {\n    var obj = {a: \"b\"}\n    obj.self = obj\n    obj.selves = [obj, obj]\n\n    function decycle() { return null }\n    stringify(obj, null, 2, decycle).must.eql(jsonify({\n      a: \"b\",\n      self: null,\n      selves: [null, null]\n    }))\n  })\n\n  it(\"must use decycler's output when it returned undefined\", function() {\n    var obj = {a: \"b\"}\n    obj.self = obj\n    obj.selves = [obj, obj]\n\n    function decycle() {}\n    stringify(obj, null, 2, decycle).must.eql(jsonify({\n      a: \"b\",\n      selves: [null, null]\n    }))\n  })\n\n  it(\"must throw given a decycler that returns a cycle\", function() {\n    var obj = {}\n    obj.self = obj\n    var err\n    function identity(key, value) { return value }\n    try { stringify(obj, null, 2, identity) } catch (ex) { err = ex }\n    err.must.be.an.instanceof(TypeError)\n  })\n\n  describe(\".getSerialize\", function() {\n    it(\"must stringify circular objects\", function() {\n      var obj = {a: \"b\"}\n      obj.circularRef = obj\n      obj.list = [obj, obj]\n\n      var json = JSON.stringify(obj, stringify.getSerialize(), 2)\n      json.must.eql(jsonify({\n        \"a\": \"b\",\n        \"circularRef\": \"[Circular ~]\",\n        \"list\": [\"[Circular ~]\", \"[Circular ~]\"]\n      }))\n    })\n\n    // This is the behavior as of Mar 3, 2015.\n    // The serializer function keeps state inside the returned function and\n    // so far I'm not sure how to not do that. JSON.stringify's replacer is not\n    // called _after_ serialization.\n    xit(\"must return a function that could be called twice\", function() {\n      var obj = {name: \"Alice\"}\n      obj.self = obj\n\n      var json\n      var serializer = stringify.getSerialize()\n\n      json = JSON.stringify(obj, serializer, 2)\n      json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n\n      json = JSON.stringify(obj, serializer, 2)\n      json.must.eql(jsonify({name: \"Alice\", self: \"[Circular ~]\"}))\n    })\n  })\n})\n\nfunction bangString(key, value) {\n  return typeof value == \"string\" ? value + \"!\" : value\n}\n"]}