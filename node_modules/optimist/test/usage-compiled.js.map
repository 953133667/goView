{"version":3,"sources":["usage.js"],"names":[],"mappings":"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","file":"usage-compiled.js","sourcesContent":["var Hash = require('hashish');\nvar optimist = require('../index');\nvar test = require('tap').test;\n\ntest('usageFail', function (t) {\n    var r = checkUsage(function () {\n        return optimist('-x 10 -z 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .demand(['x','y'])\n            .argv;\n    });\n    t.same(\n        r.result,\n        { x : 10, z : 20, _ : [], $0 : './usage' }\n    );\n\n    t.same(\n        r.errors.join('\\n').split(/\\n+/),\n        [\n            'Usage: ./usage -x NUM -y NUM',\n            'Options:',\n            '  -x  [required]',\n            '  -y  [required]',\n            'Missing required arguments: y',\n        ]\n    );\n    t.same(r.logs, []);\n    t.ok(r.exit);\n    t.end();\n});\n\n\ntest('usagePass', function (t) {\n    var r = checkUsage(function () {\n        return optimist('-x 10 -y 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .demand(['x','y'])\n            .argv;\n    });\n    t.same(r, {\n        result : { x : 10, y : 20, _ : [], $0 : './usage' },\n        errors : [],\n        logs : [],\n        exit : false,\n    });\n    t.end();\n});\n\ntest('checkPass', function (t) {\n    var r = checkUsage(function () {\n        return optimist('-x 10 -y 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .check(function (argv) {\n                if (!('x' in argv)) throw 'You forgot about -x';\n                if (!('y' in argv)) throw 'You forgot about -y';\n            })\n            .argv;\n    });\n    t.same(r, {\n        result : { x : 10, y : 20, _ : [], $0 : './usage' },\n        errors : [],\n        logs : [],\n        exit : false,\n    });\n    t.end();\n});\n\ntest('checkFail', function (t) {\n    var r = checkUsage(function () {\n        return optimist('-x 10 -z 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .check(function (argv) {\n                if (!('x' in argv)) throw 'You forgot about -x';\n                if (!('y' in argv)) throw 'You forgot about -y';\n            })\n            .argv;\n    });\n\n    t.same(\n        r.result,\n        { x : 10, z : 20, _ : [], $0 : './usage' }\n    );\n\n    t.same(\n        r.errors.join('\\n').split(/\\n+/),\n        [\n            'Usage: ./usage -x NUM -y NUM',\n            'You forgot about -y'\n        ]\n    );\n\n    t.same(r.logs, []);\n    t.ok(r.exit);\n    t.end();\n});\n\ntest('checkCondPass', function (t) {\n    function checker (argv) {\n        return 'x' in argv && 'y' in argv;\n    }\n\n    var r = checkUsage(function () {\n        return optimist('-x 10 -y 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .check(checker)\n            .argv;\n    });\n    t.same(r, {\n        result : { x : 10, y : 20, _ : [], $0 : './usage' },\n        errors : [],\n        logs : [],\n        exit : false,\n    });\n    t.end();\n});\n\ntest('checkCondFail', function (t) {\n    function checker (argv) {\n        return 'x' in argv && 'y' in argv;\n    }\n\n    var r = checkUsage(function () {\n        return optimist('-x 10 -z 20'.split(' '))\n            .usage('Usage: $0 -x NUM -y NUM')\n            .check(checker)\n            .argv;\n    });\n\n    t.same(\n        r.result,\n        { x : 10, z : 20, _ : [], $0 : './usage' }\n    );\n\n    t.same(\n        r.errors.join('\\n').split(/\\n+/).join('\\n'),\n        'Usage: ./usage -x NUM -y NUM\\n'\n        + 'Argument check failed: ' + checker.toString()\n    );\n\n    t.same(r.logs, []);\n    t.ok(r.exit);\n    t.end();\n});\n\ntest('countPass', function (t) {\n    var r = checkUsage(function () {\n        return optimist('1 2 3 --moo'.split(' '))\n            .usage('Usage: $0 [x] [y] [z] {OPTIONS}')\n            .demand(3)\n            .argv;\n    });\n    t.same(r, {\n        result : { _ : [ '1', '2', '3' ], moo : true, $0 : './usage' },\n        errors : [],\n        logs : [],\n        exit : false,\n    });\n    t.end();\n});\n\ntest('countFail', function (t) {\n    var r = checkUsage(function () {\n        return optimist('1 2 --moo'.split(' '))\n            .usage('Usage: $0 [x] [y] [z] {OPTIONS}')\n            .demand(3)\n            .argv;\n    });\n    t.same(\n        r.result,\n        { _ : [ '1', '2' ], moo : true, $0 : './usage' }\n    );\n\n    t.same(\n        r.errors.join('\\n').split(/\\n+/),\n        [\n            'Usage: ./usage [x] [y] [z] {OPTIONS}',\n            'Not enough non-option arguments: got 2, need at least 3',\n        ]\n    );\n\n    t.same(r.logs, []);\n    t.ok(r.exit);\n    t.end();\n});\n\ntest('defaultSingles', function (t) {\n    var r = checkUsage(function () {\n        return optimist('--foo 50 --baz 70 --powsy'.split(' '))\n            .default('foo', 5)\n            .default('bar', 6)\n            .default('baz', 7)\n            .argv\n        ;\n    });\n    t.same(r.result, {\n        foo : '50',\n        bar : 6,\n        baz : '70',\n        powsy : true,\n        _ : [],\n        $0 : './usage',\n    });\n    t.end();\n});\n\ntest('defaultAliases', function (t) {\n    var r = checkUsage(function () {\n        return optimist('')\n            .alias('f', 'foo')\n            .default('f', 5)\n            .argv\n        ;\n    });\n    t.same(r.result, {\n        f : '5',\n        foo : '5',\n        _ : [],\n        $0 : './usage',\n    });\n    t.end();\n});\n\ntest('defaultHash', function (t) {\n    var r = checkUsage(function () {\n        return optimist('--foo 50 --baz 70'.split(' '))\n            .default({ foo : 10, bar : 20, quux : 30 })\n            .argv\n        ;\n    });\n    t.same(r.result, {\n        _ : [],\n        $0 : './usage',\n        foo : 50,\n        baz : 70,\n        bar : 20,\n        quux : 30,\n    });\n    t.end();\n});\n\ntest('rebase', function (t) {\n    t.equal(\n        optimist.rebase('/home/substack', '/home/substack/foo/bar/baz'),\n        './foo/bar/baz'\n    );\n    t.equal(\n        optimist.rebase('/home/substack/foo/bar/baz', '/home/substack'),\n        '../../..'\n    );\n    t.equal(\n        optimist.rebase('/home/substack/foo', '/home/substack/pow/zoom.txt'),\n        '../pow/zoom.txt'\n    );\n    t.end();\n});\n\nfunction checkUsage (f) {\n\n    var exit = false;\n\n    process._exit = process.exit;\n    process._env = process.env;\n    process._argv = process.argv;\n\n    process.exit = function (t) { exit = true };\n    process.env = Hash.merge(process.env, { _ : 'node' });\n    process.argv = [ './usage' ];\n\n    var errors = [];\n    var logs = [];\n\n    console._error = console.error;\n    console.error = function (msg) { errors.push(msg) };\n    console._log = console.log;\n    console.log = function (msg) { logs.push(msg) };\n\n    var result = f();\n\n    process.exit = process._exit;\n    process.env = process._env;\n    process.argv = process._argv;\n\n    console.error = console._error;\n    console.log = console._log;\n\n    return {\n        errors : errors,\n        logs : logs,\n        exit : exit,\n        result : result,\n    };\n};\n"]}