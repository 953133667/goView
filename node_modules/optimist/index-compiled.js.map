{"version":3,"sources":["index.js"],"names":[],"mappings":"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","file":"index-compiled.js","sourcesContent":["var path = require('path');\nvar minimist = require('minimist');\nvar wordwrap = require('wordwrap');\n\n/*  Hack an instance of Argv with process.argv into Argv\n    so people can do\n        require('optimist')(['--beeble=1','-z','zizzle']).argv\n    to parse a list of args and\n        require('optimist').argv\n    to get a parsed version of process.argv.\n*/\n\nvar inst = Argv(process.argv.slice(2));\nObject.keys(inst).forEach(function (key) {\n    Argv[key] = typeof inst[key] == 'function'\n        ? inst[key].bind(inst)\n        : inst[key];\n});\n\nvar exports = module.exports = Argv;\nfunction Argv (processArgs, cwd) {\n    var self = {};\n    if (!cwd) cwd = process.cwd();\n    \n    self.$0 = process.argv\n        .slice(0,2)\n        .map(function (x) {\n            var b = rebase(cwd, x);\n            return x.match(/^\\//) && b.length < x.length\n                ? b : x\n        })\n        .join(' ')\n    ;\n    \n    if (process.env._ != undefined && process.argv[1] == process.env._) {\n        self.$0 = process.env._.replace(\n            path.dirname(process.execPath) + '/', ''\n        );\n    }\n    \n    var options = {\n        boolean: [],\n        string: [],\n        alias: {},\n        default: []\n    };\n    \n    self.boolean = function (bools) {\n        options.boolean.push.apply(options.boolean, [].concat(bools));\n        return self;\n    };\n    \n    self.string = function (strings) {\n        options.string.push.apply(options.string, [].concat(strings));\n        return self;\n    };\n    \n    self.default = function (key, value) {\n        if (typeof key === 'object') {\n            Object.keys(key).forEach(function (k) {\n                self.default(k, key[k]);\n            });\n        }\n        else {\n            options.default[key] = value;\n        }\n        return self;\n    };\n    \n    self.alias = function (x, y) {\n        if (typeof x === 'object') {\n            Object.keys(x).forEach(function (key) {\n                self.alias(key, x[key]);\n            });\n        }\n        else {\n            options.alias[x] = (options.alias[x] || []).concat(y);\n        }\n        return self;\n    };\n    \n    var demanded = {};\n    self.demand = function (keys) {\n        if (typeof keys == 'number') {\n            if (!demanded._) demanded._ = 0;\n            demanded._ += keys;\n        }\n        else if (Array.isArray(keys)) {\n            keys.forEach(function (key) {\n                self.demand(key);\n            });\n        }\n        else {\n            demanded[keys] = true;\n        }\n        \n        return self;\n    };\n    \n    var usage;\n    self.usage = function (msg, opts) {\n        if (!opts && typeof msg === 'object') {\n            opts = msg;\n            msg = null;\n        }\n        \n        usage = msg;\n        \n        if (opts) self.options(opts);\n        \n        return self;\n    };\n    \n    function fail (msg) {\n        self.showHelp();\n        if (msg) console.error(msg);\n        process.exit(1);\n    }\n    \n    var checks = [];\n    self.check = function (f) {\n        checks.push(f);\n        return self;\n    };\n    \n    var descriptions = {};\n    self.describe = function (key, desc) {\n        if (typeof key === 'object') {\n            Object.keys(key).forEach(function (k) {\n                self.describe(k, key[k]);\n            });\n        }\n        else {\n            descriptions[key] = desc;\n        }\n        return self;\n    };\n    \n    self.parse = function (args) {\n        return parseArgs(args);\n    };\n    \n    self.option = self.options = function (key, opt) {\n        if (typeof key === 'object') {\n            Object.keys(key).forEach(function (k) {\n                self.options(k, key[k]);\n            });\n        }\n        else {\n            if (opt.alias) self.alias(key, opt.alias);\n            if (opt.demand) self.demand(key);\n            if (typeof opt.default !== 'undefined') {\n                self.default(key, opt.default);\n            }\n            \n            if (opt.boolean || opt.type === 'boolean') {\n                self.boolean(key);\n            }\n            if (opt.string || opt.type === 'string') {\n                self.string(key);\n            }\n            \n            var desc = opt.describe || opt.description || opt.desc;\n            if (desc) {\n                self.describe(key, desc);\n            }\n        }\n        \n        return self;\n    };\n    \n    var wrap = null;\n    self.wrap = function (cols) {\n        wrap = cols;\n        return self;\n    };\n    \n    self.showHelp = function (fn) {\n        if (!fn) fn = console.error;\n        fn(self.help());\n    };\n    \n    self.help = function () {\n        var keys = Object.keys(\n            Object.keys(descriptions)\n            .concat(Object.keys(demanded))\n            .concat(Object.keys(options.default))\n            .reduce(function (acc, key) {\n                if (key !== '_') acc[key] = true;\n                return acc;\n            }, {})\n        );\n        \n        var help = keys.length ? [ 'Options:' ] : [];\n        \n        if (usage) {\n            help.unshift(usage.replace(/\\$0/g, self.$0), '');\n        }\n        \n        var switches = keys.reduce(function (acc, key) {\n            acc[key] = [ key ].concat(options.alias[key] || [])\n                .map(function (sw) {\n                    return (sw.length > 1 ? '--' : '-') + sw\n                })\n                .join(', ')\n            ;\n            return acc;\n        }, {});\n        \n        var switchlen = longest(Object.keys(switches).map(function (s) {\n            return switches[s] || '';\n        }));\n        \n        var desclen = longest(Object.keys(descriptions).map(function (d) { \n            return descriptions[d] || '';\n        }));\n        \n        keys.forEach(function (key) {\n            var kswitch = switches[key];\n            var desc = descriptions[key] || '';\n            \n            if (wrap) {\n                desc = wordwrap(switchlen + 4, wrap)(desc)\n                    .slice(switchlen + 4)\n                ;\n            }\n            \n            var spadding = new Array(\n                Math.max(switchlen - kswitch.length + 3, 0)\n            ).join(' ');\n            \n            var dpadding = new Array(\n                Math.max(desclen - desc.length + 1, 0)\n            ).join(' ');\n            \n            var type = null;\n            \n            if (options.boolean[key]) type = '[boolean]';\n            if (options.string[key]) type = '[string]';\n            \n            if (!wrap && dpadding.length > 0) {\n                desc += dpadding;\n            }\n            \n            var prelude = '  ' + kswitch + spadding;\n            var extra = [\n                type,\n                demanded[key]\n                    ? '[required]'\n                    : null\n                ,\n                options.default[key] !== undefined\n                    ? '[default: ' + JSON.stringify(options.default[key]) + ']'\n                    : null\n                ,\n            ].filter(Boolean).join('  ');\n            \n            var body = [ desc, extra ].filter(Boolean).join('  ');\n            \n            if (wrap) {\n                var dlines = desc.split('\\n');\n                var dlen = dlines.slice(-1)[0].length\n                    + (dlines.length === 1 ? prelude.length : 0)\n                \n                body = desc + (dlen + extra.length > wrap - 2\n                    ? '\\n'\n                        + new Array(wrap - extra.length + 1).join(' ')\n                        + extra\n                    : new Array(wrap - extra.length - dlen + 1).join(' ')\n                        + extra\n                );\n            }\n            \n            help.push(prelude + body);\n        });\n        \n        help.push('');\n        return help.join('\\n');\n    };\n    \n    Object.defineProperty(self, 'argv', {\n        get : function () { return parseArgs(processArgs) },\n        enumerable : true,\n    });\n    \n    function parseArgs (args) {\n        var argv = minimist(args, options);\n        argv.$0 = self.$0;\n        \n        if (demanded._ && argv._.length < demanded._) {\n            fail('Not enough non-option arguments: got '\n                + argv._.length + ', need at least ' + demanded._\n            );\n        }\n        \n        var missing = [];\n        Object.keys(demanded).forEach(function (key) {\n            if (!argv[key]) missing.push(key);\n        });\n        \n        if (missing.length) {\n            fail('Missing required arguments: ' + missing.join(', '));\n        }\n        \n        checks.forEach(function (f) {\n            try {\n                if (f(argv) === false) {\n                    fail('Argument check failed: ' + f.toString());\n                }\n            }\n            catch (err) {\n                fail(err)\n            }\n        });\n        \n        return argv;\n    }\n    \n    function longest (xs) {\n        return Math.max.apply(\n            null,\n            xs.map(function (x) { return x.length })\n        );\n    }\n    \n    return self;\n};\n\n// rebase an absolute path to a relative one with respect to a base directory\n// exported for tests\nexports.rebase = rebase;\nfunction rebase (base, dir) {\n    var ds = path.normalize(dir).split('/').slice(1);\n    var bs = path.normalize(base).split('/').slice(1);\n    \n    for (var i = 0; ds[i] && ds[i] == bs[i]; i++);\n    ds.splice(0, i); bs.splice(0, i);\n    \n    var p = path.normalize(\n        bs.map(function () { return '..' }).concat(ds).join('/')\n    ).replace(/\\/$/,'').replace(/^$/, '.');\n    return p.match(/^[.\\/]/) ? p : './' + p;\n};\n"]}