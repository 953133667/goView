{"version":3,"sources":["node-extensions.js"],"names":[],"mappings":"AAAA;;AAEA;AACA;;AAEA,IAAI,UAAU,QAAQ,WAAR,CAAd;AACA,IAAI,OAAO,QAAQ,MAAR,CAAX;;AAEA,OAAO,OAAP,GAAiB,OAAjB;;AAEA;;AAEA,QAAQ,SAAR,GAAoB,UAAU,EAAV,EAAc,aAAd,EAA6B;AAC/C,MACE,OAAO,aAAP,KAAyB,QAAzB,IAAqC,kBAAkB,QADzD,EAEE;AACA,WAAO,mBAAmB,EAAnB,EAAuB,aAAvB,CAAP;AACD,GAJD,MAIO;AACL,WAAO,sBAAsB,EAAtB,CAAP;AACD;AACF,CARD;;AAUA,IAAI,aACF,0BACA,yCADA,GAEA,GAHF;AAKA,SAAS,kBAAT,CAA4B,EAA5B,EAAgC,aAAhC,EAA+C;AAC7C,MAAI,OAAO,EAAX;AACA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,aAApB,EAAmC,GAAnC,EAAwC;AACtC,SAAK,IAAL,CAAU,MAAM,CAAhB;AACD;AACD,MAAI,OAAO,CACT,sBAAsB,KAAK,IAAL,CAAU,GAAV,CAAtB,GAAuC,KAD9B,EAET,kBAFS,EAGT,wCAHS,EAIT,oBAJS,EAKT,CAAC,MAAD,EAAS,MAAT,CAAgB,IAAhB,EAAsB,MAAtB,CAA6B,CAAC,UAAD,CAA7B,EAA2C,IAA3C,CAAgD,GAAhD,CALS,EAMT,IANS,EAOT,YAPS,EAQT,2DARS,EAST,gCATS,EAUT,cAVS,EAWT,KAXS,EAYT,IAZS,EAaT,IAbS,CAaJ,EAbI,CAAX;AAcA,SAAO,SAAS,CAAC,SAAD,EAAY,IAAZ,CAAT,EAA4B,IAA5B,EAAkC,OAAlC,EAA2C,EAA3C,CAAP;AACD;AACD,SAAS,qBAAT,CAA+B,EAA/B,EAAmC;AACjC,MAAI,WAAW,KAAK,GAAL,CAAS,GAAG,MAAH,GAAY,CAArB,EAAwB,CAAxB,CAAf;AACA,MAAI,OAAO,EAAX;AACA,OAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,QAApB,EAA8B,GAA9B,EAAmC;AACjC,SAAK,IAAL,CAAU,MAAM,CAAhB;AACD;AACD,MAAI,OAAO,CACT,sBAAsB,KAAK,IAAL,CAAU,GAAV,CAAtB,GAAuC,KAD9B,EAET,kBAFS,EAGT,WAHS,EAIT,mCAJS,EAKT,4BAA4B,QAA5B,GAAuC,KAL9B,EAMT,yCANS,EAOT,8CAPS,EAQT,yBARS,EAST,GATS,EAUT,GAVS,EAWT,wCAXS,EAYT,cAAc,UAAd,GAA2B,GAZlB,EAaT,UAbS,EAcT,sBAdS,EAeT,KAAK,MAAL,CAAY,CAAC,OAAD,CAAZ,EAAuB,GAAvB,CAA2B,UAAU,CAAV,EAAa,KAAb,EAAoB;AAC7C,WACE,UAAW,KAAX,GAAoB,GAApB,GACA,gBADA,GACmB,CAAC,MAAD,EAAS,MAAT,CAAgB,KAAK,KAAL,CAAW,CAAX,EAAc,KAAd,CAAhB,EAAsC,MAAtC,CAA6C,IAA7C,EAAmD,IAAnD,CAAwD,GAAxD,CADnB,GACkF,IADlF,GAEA,QAHF;AAKD,GAND,EAMG,IANH,CAMQ,EANR,CAfS,EAsBT,UAtBS,EAuBT,uBAvBS,EAwBT,6BAxBS,EAyBT,GAzBS,EA2BT,YA3BS,EA4BT,2DA5BS,EA6BT,gCA7BS,EA8BT,cA9BS,EA+BT,KA/BS,EAgCT,IAhCS,EAiCT,IAjCS,CAiCJ,EAjCI,CAAX;;AAmCA,SAAO,SACL,CAAC,SAAD,EAAY,IAAZ,CADK,EAEL,IAFK,EAGL,OAHK,EAGI,EAHJ,CAAP;AAID;;AAED,QAAQ,OAAR,GAAkB,UAAU,EAAV,EAAc;AAC9B,SAAO,YAAY;AACjB,QAAI,OAAO,MAAM,SAAN,CAAgB,KAAhB,CAAsB,IAAtB,CAA2B,SAA3B,CAAX;AACA,QAAI,WACF,OAAO,KAAK,KAAK,MAAL,GAAc,CAAnB,CAAP,KAAiC,UAAjC,GAA8C,KAAK,GAAL,EAA9C,GAA2D,IAD7D;AAEA,QAAI,MAAM,IAAV;AACA,QAAI;AACF,aAAO,GAAG,KAAH,CAAS,IAAT,EAAe,SAAf,EAA0B,OAA1B,CAAkC,QAAlC,EAA4C,GAA5C,CAAP;AACD,KAFD,CAEE,OAAO,EAAP,EAAW;AACX,UAAI,aAAa,IAAb,IAAqB,OAAO,QAAP,IAAmB,WAA5C,EAAyD;AACvD,eAAO,IAAI,OAAJ,CAAY,UAAU,OAAV,EAAmB,MAAnB,EAA2B;AAC5C,iBAAO,EAAP;AACD,SAFM,CAAP;AAGD,OAJD,MAIO;AACL,aAAK,YAAY;AACf,mBAAS,IAAT,CAAc,GAAd,EAAmB,EAAnB;AACD,SAFD;AAGD;AACF;AACF,GAlBD;AAmBD,CApBD;;AAsBA,QAAQ,SAAR,CAAkB,OAAlB,GAA4B,UAAU,QAAV,EAAoB,GAApB,EAAyB;AACnD,MAAI,OAAO,QAAP,IAAmB,UAAvB,EAAmC,OAAO,IAAP;;AAEnC,OAAK,IAAL,CAAU,UAAU,KAAV,EAAiB;AACzB,SAAK,YAAY;AACf,eAAS,IAAT,CAAc,GAAd,EAAmB,IAAnB,EAAyB,KAAzB;AACD,KAFD;AAGD,GAJD,EAIG,UAAU,GAAV,EAAe;AAChB,SAAK,YAAY;AACf,eAAS,IAAT,CAAc,GAAd,EAAmB,GAAnB;AACD,KAFD;AAGD,GARD;AASD,CAZD","file":"node-extensions-compiled.js","sourcesContent":["'use strict';\n\n// This file contains then/promise specific extensions that are only useful\n// for node.js interop\n\nvar Promise = require('./core.js');\nvar asap = require('asap');\n\nmodule.exports = Promise;\n\n/* Static Functions */\n\nPromise.denodeify = function (fn, argumentCount) {\n  if (\n    typeof argumentCount === 'number' && argumentCount !== Infinity\n  ) {\n    return denodeifyWithCount(fn, argumentCount);\n  } else {\n    return denodeifyWithoutCount(fn);\n  }\n}\n\nvar callbackFn = (\n  'function (err, res) {' +\n  'if (err) { rj(err); } else { rs(res); }' +\n  '}'\n);\nfunction denodeifyWithCount(fn, argumentCount) {\n  var args = [];\n  for (var i = 0; i < argumentCount; i++) {\n    args.push('a' + i);\n  }\n  var body = [\n    'return function (' + args.join(',') + ') {',\n    'var self = this;',\n    'return new Promise(function (rs, rj) {',\n    'var res = fn.call(',\n    ['self'].concat(args).concat([callbackFn]).join(','),\n    ');',\n    'if (res &&',\n    '(typeof res === \"object\" || typeof res === \"function\") &&',\n    'typeof res.then === \"function\"',\n    ') {rs(res);}',\n    '});',\n    '};'\n  ].join('');\n  return Function(['Promise', 'fn'], body)(Promise, fn);\n}\nfunction denodeifyWithoutCount(fn) {\n  var fnLength = Math.max(fn.length - 1, 3);\n  var args = [];\n  for (var i = 0; i < fnLength; i++) {\n    args.push('a' + i);\n  }\n  var body = [\n    'return function (' + args.join(',') + ') {',\n    'var self = this;',\n    'var args;',\n    'var argLength = arguments.length;',\n    'if (arguments.length > ' + fnLength + ') {',\n    'args = new Array(arguments.length + 1);',\n    'for (var i = 0; i < arguments.length; i++) {',\n    'args[i] = arguments[i];',\n    '}',\n    '}',\n    'return new Promise(function (rs, rj) {',\n    'var cb = ' + callbackFn + ';',\n    'var res;',\n    'switch (argLength) {',\n    args.concat(['extra']).map(function (_, index) {\n      return (\n        'case ' + (index) + ':' +\n        'res = fn.call(' + ['self'].concat(args.slice(0, index)).concat('cb').join(',') + ');' +\n        'break;'\n      );\n    }).join(''),\n    'default:',\n    'args[argLength] = cb;',\n    'res = fn.apply(self, args);',\n    '}',\n    \n    'if (res &&',\n    '(typeof res === \"object\" || typeof res === \"function\") &&',\n    'typeof res.then === \"function\"',\n    ') {rs(res);}',\n    '});',\n    '};'\n  ].join('');\n\n  return Function(\n    ['Promise', 'fn'],\n    body\n  )(Promise, fn);\n}\n\nPromise.nodeify = function (fn) {\n  return function () {\n    var args = Array.prototype.slice.call(arguments);\n    var callback =\n      typeof args[args.length - 1] === 'function' ? args.pop() : null;\n    var ctx = this;\n    try {\n      return fn.apply(this, arguments).nodeify(callback, ctx);\n    } catch (ex) {\n      if (callback === null || typeof callback == 'undefined') {\n        return new Promise(function (resolve, reject) {\n          reject(ex);\n        });\n      } else {\n        asap(function () {\n          callback.call(ctx, ex);\n        })\n      }\n    }\n  }\n}\n\nPromise.prototype.nodeify = function (callback, ctx) {\n  if (typeof callback != 'function') return this;\n\n  this.then(function (value) {\n    asap(function () {\n      callback.call(ctx, null, value);\n    });\n  }, function (err) {\n    asap(function () {\n      callback.call(ctx, err);\n    });\n  });\n}\n"]}