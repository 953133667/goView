{"version":3,"sources":["ContextReplacementPlugin.js"],"names":[],"mappings":"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","file":"ContextReplacementPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\nvar ContextElementDependency = require(\"./dependencies/ContextElementDependency\");\r\n\r\nfunction ContextReplacementPlugin(resourceRegExp, newContentResource, newContentRecursive, newContentRegExp) {\r\n\tthis.resourceRegExp = resourceRegExp;\r\n\tif(typeof newContentResource === \"function\") {\r\n\t\tthis.newContentCallback = newContentResource;\r\n\t} else if(typeof newContentResource === \"string\" && typeof newContentRecursive === \"object\") {\r\n\t\tthis.newContentResource = newContentResource;\r\n\t\tthis.newContentCreateContextMap = function(fs, callback) {\r\n\t\t\tcallback(null, newContentRecursive)\r\n\t\t};\r\n\t} else if(typeof newContentResource === \"string\" && typeof newContentRecursive === \"function\") {\r\n\t\tthis.newContentResource = newContentResource;\r\n\t\tthis.newContentCreateContextMap = newContentRecursive;\r\n\t} else {\r\n\t\tif(typeof newContentResource !== \"string\") {\r\n\t\t\tnewContentRegExp = newContentRecursive;\r\n\t\t\tnewContentRecursive = newContentResource;\r\n\t\t\tnewContentResource = undefined;\r\n\t\t}\r\n\t\tif(typeof newContentRecursive !== \"boolean\") {\r\n\t\t\tnewContentRegExp = newContentRecursive;\r\n\t\t\tnewContentRecursive = undefined;\r\n\t\t}\r\n\t\tthis.newContentResource = newContentResource;\r\n\t\tthis.newContentRecursive = newContentRecursive;\r\n\t\tthis.newContentRegExp = newContentRegExp;\r\n\t}\r\n}\r\nmodule.exports = ContextReplacementPlugin;\r\nContextReplacementPlugin.prototype.apply = function(compiler) {\r\n\tvar resourceRegExp = this.resourceRegExp;\r\n\tvar newContentCallback = this.newContentCallback;\r\n\tvar newContentResource = this.newContentResource;\r\n\tvar newContentRecursive = this.newContentRecursive;\r\n\tvar newContentRegExp = this.newContentRegExp;\r\n\tvar newContentCreateContextMap = this.newContentCreateContextMap;\r\n\tcompiler.plugin(\"context-module-factory\", function(cmf) {\r\n\t\tcmf.plugin(\"before-resolve\", function(result, callback) {\r\n\t\t\tif(!result) return callback();\r\n\t\t\tif(resourceRegExp.test(result.request)) {\r\n\t\t\t\tif(typeof newContentResource !== \"undefined\")\r\n\t\t\t\t\tresult.request = newContentResource;\r\n\t\t\t\tif(typeof newContentRecursive !== \"undefined\")\r\n\t\t\t\t\tresult.recursive = newContentRecursive;\r\n\t\t\t\tif(typeof newContentRegExp !== \"undefined\")\r\n\t\t\t\t\tresult.regExp = newContentRegExp;\r\n\t\t\t\tif(typeof newContentCallback === \"function\") {\r\n\t\t\t\t\tnewContentCallback(result);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn callback(null, result);\r\n\t\t});\r\n\t\tcmf.plugin(\"after-resolve\", function(result, callback) {\r\n\t\t\tif(!result) return callback();\r\n\t\t\tif(resourceRegExp.test(result.resource)) {\r\n\t\t\t\tif(typeof newContentResource !== \"undefined\")\r\n\t\t\t\t\tresult.resource = path.resolve(result.resource, newContentResource);\r\n\t\t\t\tif(typeof newContentRecursive !== \"undefined\")\r\n\t\t\t\t\tresult.recursive = newContentRecursive;\r\n\t\t\t\tif(typeof newContentRegExp !== \"undefined\")\r\n\t\t\t\t\tresult.regExp = newContentRegExp;\r\n\t\t\t\tif(typeof newContentCreateContextMap === \"function\")\r\n\t\t\t\t\tresult.resolveDependencies = createResolveDependenciesFromContextMap(newContentCreateContextMap);\r\n\t\t\t\tif(typeof newContentCallback === \"function\") {\r\n\t\t\t\t\tvar origResource = result.resource;\r\n\t\t\t\t\tnewContentCallback(result);\r\n\t\t\t\t\tif(result.resource !== origResource) {\r\n\t\t\t\t\t\tresult.resource = path.resolve(origResource, result.resource);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn callback(null, result);\r\n\t\t});\r\n\t});\r\n};\r\n\r\nfunction createResolveDependenciesFromContextMap(createContextMap) {\r\n\treturn function resolveDependenciesFromContextMap(fs, resource, recursive, regExp, callback) {\r\n\t\tcreateContextMap(fs, function(err, map) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tvar dependencies = Object.keys(map).map(function(key) {\r\n\t\t\t\treturn new ContextElementDependency(map[key], key);\r\n\t\t\t});\r\n\t\t\tcallback(null, dependencies);\r\n\t\t});\r\n\t}\r\n};\r\n"]}