{"version":3,"sources":["NormalModuleFactory.js"],"names":[],"mappings":"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","file":"NormalModuleFactory-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar async = require(\"async\");\r\n\r\nvar Tapable = require(\"tapable\");\r\nvar NormalModule = require(\"./NormalModule\");\r\nvar RawModule = require(\"./RawModule\");\r\nvar LoadersList = require(\"webpack-core/lib/LoadersList\");\r\n\r\nfunction NormalModuleFactory(context, resolvers, parser, options) {\r\n\tTapable.call(this);\r\n\tthis.resolvers = resolvers;\r\n\tthis.parser = parser;\r\n\tthis.loaders = new LoadersList(options.loaders);\r\n\tthis.preLoaders = new LoadersList(options.preLoaders);\r\n\tthis.postLoaders = new LoadersList(options.postLoaders);\r\n\tthis.context = context || \"\";\r\n\tthis.plugin(\"factory\", function() {\r\n\t\tvar _this = this;\r\n\t\treturn function(result, callback) {\r\n\t\t\tvar resolver = _this.applyPluginsWaterfall(\"resolver\", null);\r\n\r\n\t\t\t// Ignored\r\n\t\t\tif(!resolver) return callback();\r\n\r\n\t\t\tresolver(result, function onDoneResolving(err, data) {\r\n\t\t\t\tif(err) return callback(err);\r\n\r\n\t\t\t\t// Ignored\r\n\t\t\t\tif(!data) return callback();\r\n\r\n\t\t\t\t// direct module\r\n\t\t\t\tif(typeof data.source === \"function\")\r\n\t\t\t\t\treturn callback(null, data);\r\n\r\n\t\t\t\t_this.applyPluginsAsyncWaterfall(\"after-resolve\", data, function(err, result) {\r\n\t\t\t\t\tif(err) return callback(err);\r\n\r\n\t\t\t\t\t// Ignored\r\n\t\t\t\t\tif(!result) return callback();\r\n\r\n\t\t\t\t\tvar createdModule = _this.applyPluginsBailResult(\"create-module\", result);\r\n\t\t\t\t\tif(!createdModule) {\r\n\t\t\t\t\t\tcreatedModule = new NormalModule(\r\n\t\t\t\t\t\t\tresult.request,\r\n\t\t\t\t\t\t\tresult.userRequest,\r\n\t\t\t\t\t\t\tresult.rawRequest,\r\n\t\t\t\t\t\t\tresult.loaders,\r\n\t\t\t\t\t\t\tresult.resource,\r\n\t\t\t\t\t\t\tresult.parser\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tcreatedModule = _this.applyPluginsWaterfall(\"module\", createdModule);\r\n\r\n\t\t\t\t\treturn callback(null, createdModule);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t};\r\n\t});\r\n\tthis.plugin(\"resolver\", function() {\r\n\t\tvar _this = this;\r\n\t\treturn function(data, callback) {\r\n\t\t\tvar context = data.context;\r\n\t\t\tvar request = data.request;\r\n\r\n\t\t\tvar noAutoLoaders = /^-?!/.test(request);\r\n\t\t\tvar noPrePostAutoLoaders = /^!!/.test(request);\r\n\t\t\tvar noPostAutoLoaders = /^-!/.test(request);\r\n\t\t\tvar elements = request.replace(/^-?!+/, \"\").replace(/!!+/g, \"!\").split(\"!\");\r\n\t\t\tvar resource = elements.pop();\r\n\r\n\t\t\tasync.parallel([\r\n\t\t\t\tfunction(callback) {\r\n\t\t\t\t\t_this.resolveRequestArray(context, elements, _this.resolvers.loader, callback);\r\n\t\t\t\t},\r\n\t\t\t\tfunction(callback) {\r\n\t\t\t\t\tif(resource === \"\" || resource[0] === \"?\")\r\n\t\t\t\t\t\treturn callback(null, resource);\r\n\t\t\t\t\t_this.resolvers.normal.resolve(context, resource, callback);\r\n\t\t\t\t}\r\n\t\t\t], function(err, results) {\r\n\t\t\t\tif(err) return callback(err);\r\n\t\t\t\tvar loaders = results[0];\r\n\t\t\t\tresource = results[1];\r\n\r\n\t\t\t\tif(resource === false)\r\n\t\t\t\t\treturn callback(null,\r\n\t\t\t\t\t\tnew RawModule(\"/* (ignored) */\",\r\n\t\t\t\t\t\t\t\"ignored \" + context + \" \" + request,\r\n\t\t\t\t\t\t\trequest + \" (ignored)\")); // ignored\r\n\r\n\t\t\t\tvar userRequest = loaders.concat([resource]).join(\"!\");\r\n\r\n\t\t\t\tif(noPrePostAutoLoaders)\r\n\t\t\t\t\treturn onDoneResolving();\r\n\t\t\t\tif(noAutoLoaders) {\r\n\t\t\t\t\tasync.parallel([\r\n\t\t\t\t\t\t_this.resolveRequestArray.bind(_this, context, noPostAutoLoaders ? [] : _this.postLoaders.match(resource), _this.resolvers.loader),\r\n\t\t\t\t\t\t_this.resolveRequestArray.bind(_this, context, _this.preLoaders.match(resource), _this.resolvers.loader)\r\n\t\t\t\t\t], function(err, results) {\r\n\t\t\t\t\t\tif(err) return callback(err);\r\n\t\t\t\t\t\tloaders = results[0].concat(loaders).concat(results[1]);\r\n\t\t\t\t\t\tonDoneResolving();\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tasync.parallel([\r\n\t\t\t\t\t\t_this.resolveRequestArray.bind(_this, context, noPostAutoLoaders ? [] : _this.postLoaders.match(resource), _this.resolvers.loader),\r\n\t\t\t\t\t\t_this.resolveRequestArray.bind(_this, context, _this.loaders.match(resource), _this.resolvers.loader),\r\n\t\t\t\t\t\t_this.resolveRequestArray.bind(_this, context, _this.preLoaders.match(resource), _this.resolvers.loader)\r\n\t\t\t\t\t], function(err, results) {\r\n\t\t\t\t\t\tif(err) return callback(err);\r\n\t\t\t\t\t\tloaders = results[0].concat(loaders).concat(results[1]).concat(results[2]);\r\n\t\t\t\t\t\tonDoneResolving();\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tfunction onDoneResolving() {\r\n\t\t\t\t\tcallback(null, {\r\n\t\t\t\t\t\tcontext: context,\r\n\t\t\t\t\t\trequest: loaders.concat([resource]).join(\"!\"),\r\n\t\t\t\t\t\tuserRequest: userRequest,\r\n\t\t\t\t\t\trawRequest: request,\r\n\t\t\t\t\t\tloaders: loaders,\r\n\t\t\t\t\t\tresource: resource,\r\n\t\t\t\t\t\tparser: _this.parser\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t};\r\n\t});\r\n}\r\nmodule.exports = NormalModuleFactory;\r\n\r\nNormalModuleFactory.prototype = Object.create(Tapable.prototype);\r\nNormalModuleFactory.prototype.constructor = NormalModuleFactory;\r\n\r\nNormalModuleFactory.prototype.create = function(context, dependency, callback) {\r\n\tvar _this = this;\r\n\tcontext = context || this.context;\r\n\tvar request = dependency.request;\r\n\t_this.applyPluginsAsyncWaterfall(\"before-resolve\", {\r\n\t\tcontext: context,\r\n\t\trequest: request,\r\n\t\tdependency: dependency\r\n\t}, function(err, result) {\r\n\t\tif(err) return callback(err);\r\n\r\n\t\t// Ignored\r\n\t\tif(!result) return callback();\r\n\r\n\t\tvar factory = _this.applyPluginsWaterfall(\"factory\", null);\r\n\r\n\t\t// Ignored\r\n\t\tif(!factory) return callback();\r\n\r\n\t\tfactory(result, callback);\r\n\r\n\t});\r\n};\r\n\r\nNormalModuleFactory.prototype.resolveRequestArray = function resolveRequestArray(context, array, resolver, callback) {\r\n\tif(array.length === 0) return callback(null, []);\r\n\tasync.map(array, function(item, callback) {\r\n\t\tif(item === \"\" || item[0] === \"?\")\r\n\t\t\treturn callback(null, item);\r\n\t\tresolver.resolve(context, item, callback);\r\n\t}, callback);\r\n};\r\n"]}