{"version":3,"sources":["DefinePlugin.js"],"names":[],"mappings":"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","file":"DefinePlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar ConstDependency = require(\"./dependencies/ConstDependency\");\r\nvar BasicEvaluatedExpression = require(\"./BasicEvaluatedExpression\");\r\n\r\nvar NullFactory = require(\"./NullFactory\");\r\n\r\nfunction DefinePlugin(definitions) {\r\n\tthis.definitions = definitions;\r\n}\r\nmodule.exports = DefinePlugin;\r\nDefinePlugin.prototype.apply = function(compiler) {\r\n\tcompiler.plugin(\"compilation\", function(compilation) {\r\n\t\tcompilation.dependencyFactories.set(ConstDependency, new NullFactory());\r\n\t\tcompilation.dependencyTemplates.set(ConstDependency, new ConstDependency.Template());\r\n\t});\r\n\t(function walkDefinitions(definitions, prefix) {\r\n\t\tObject.keys(definitions).forEach(function(key) {\r\n\t\t\tvar code = definitions[key];\r\n\t\t\tif(code && typeof code === \"object\" && !(code instanceof RegExp)) {\r\n\t\t\t\twalkDefinitions(code, prefix + key + \".\");\r\n\t\t\t\tapplyObjectDefine(prefix + key, code);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tapplyDefineKey(prefix, key);\r\n\t\t\tapplyDefine(prefix + key, code);\r\n\t\t});\r\n\t}(this.definitions, \"\"));\r\n\r\n\tfunction stringifyObj(obj) {\r\n\t\treturn \"{\" + Object.keys(obj).map(function(key) {\r\n\t\t\tvar code = obj[key];\r\n\t\t\treturn JSON.stringify(key) + \":\" + toCode(code);\r\n\t\t}).join(\",\") + \"}\";\r\n\t}\r\n\r\n\tfunction toCode(code) {\r\n\t\tif(code === null) return \"null\";\r\n\t\telse if(code === undefined) return \"undefined\";\r\n\t\telse if(code instanceof RegExp && code.toString) return code.toString();\r\n\t\telse if(typeof code === \"function\" && code.toString) return code.toString();\r\n\t\telse if(typeof code === \"object\") return stringifyObj(code);\r\n\t\telse return code + \"\";\r\n\t}\r\n\r\n\tfunction applyDefineKey(prefix, key) {\r\n\t\tvar splittedKey = key.split(\".\");\r\n\t\tsplittedKey.slice(1).forEach(function(_, i) {\r\n\t\t\tvar fullKey = prefix + splittedKey.slice(0, i + 1).join(\".\");\r\n\t\t\tcompiler.parser.plugin(\"can-rename \" + fullKey, function() {\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tfunction applyDefine(key, code) {\r\n\t\tvar isTypeof = /^typeof\\s+/.test(key);\r\n\t\tif(isTypeof) key = key.replace(/^typeof\\s+/, \"\");\r\n\t\tvar recurse = false;\r\n\t\tvar recurseTypeof = false;\r\n\t\tcode = toCode(code);\r\n\t\tif(!isTypeof) {\r\n\t\t\tcompiler.parser.plugin(\"can-rename \" + key, function() {\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t\tcompiler.parser.plugin(\"evaluate Identifier \" + key, function(expr) {\r\n\t\t\t\tif(recurse) return;\r\n\t\t\t\trecurse = true;\r\n\t\t\t\tvar res = compiler.parser.evaluate(code);\r\n\t\t\t\trecurse = false;\r\n\t\t\t\tres.setRange(expr.range);\r\n\t\t\t\treturn res;\r\n\t\t\t});\r\n\t\t\tcompiler.parser.plugin(\"expression \" + key, function(expr) {\r\n\t\t\t\tvar dep = new ConstDependency(\"(\" + code + \")\", expr.range);\r\n\t\t\t\tdep.loc = expr.loc;\r\n\t\t\t\tthis.state.current.addDependency(dep);\r\n\t\t\t\treturn true;\r\n\t\t\t});\r\n\t\t}\r\n\t\tvar typeofCode = isTypeof ? code : \"typeof (\" + code + \")\";\r\n\t\tcompiler.parser.plugin(\"evaluate typeof \" + key, function(expr) {\r\n\t\t\tif(recurseTypeof) return;\r\n\t\t\trecurseTypeof = true;\r\n\t\t\tvar res = compiler.parser.evaluate(typeofCode);\r\n\t\t\trecurseTypeof = false;\r\n\t\t\tres.setRange(expr.range);\r\n\t\t\treturn res;\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"typeof \" + key, function(expr) {\r\n\t\t\tvar res = compiler.parser.evaluate(typeofCode);\r\n\t\t\tif(!res.isString()) return;\r\n\t\t\tvar dep = new ConstDependency(JSON.stringify(res.string), expr.range);\r\n\t\t\tdep.loc = expr.loc;\r\n\t\t\tthis.state.current.addDependency(dep);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction applyObjectDefine(key, obj) {\r\n\t\tvar code = stringifyObj(obj);\r\n\t\tcompiler.parser.plugin(\"can-rename \" + key, function() {\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"evaluate Identifier \" + key, function(expr) {\r\n\t\t\treturn new BasicEvaluatedExpression().setRange(expr.range);\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"evaluate typeof \" + key, function(expr) {\r\n\t\t\treturn new BasicEvaluatedExpression().setString(\"object\").setRange(expr.range);\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"expression \" + key, function(expr) {\r\n\t\t\tvar dep = new ConstDependency(\"(\" + code + \")\", expr.range);\r\n\t\t\tdep.loc = expr.loc;\r\n\t\t\tthis.state.current.addDependency(dep);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"typeof \" + key, function(expr) {\r\n\t\t\tvar dep = new ConstDependency(\"\\\"object\\\"\", expr.range);\r\n\t\t\tdep.loc = expr.loc;\r\n\t\t\tthis.state.current.addDependency(dep);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n};\r\n"]}