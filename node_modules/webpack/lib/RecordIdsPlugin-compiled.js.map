{"version":3,"sources":["RecordIdsPlugin.js"],"names":[],"mappings":"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","file":"RecordIdsPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\n\r\nfunction RecordIdsPlugin() {}\r\nmodule.exports = RecordIdsPlugin;\r\n\r\nfunction makeRelative(compiler, identifier) {\r\n\tvar context = compiler.context;\r\n\treturn identifier.split(\"|\").map(function(str) {\r\n\t\treturn identifier.split(\"!\").map(function(str) {\r\n\t\t\treturn path.relative(context, str);\r\n\t\t}).join(\"!\");\r\n\t}).join(\"|\");\r\n}\r\n\r\nRecordIdsPlugin.prototype.apply = function(compiler) {\r\n\tcompiler.plugin(\"compilation\", function(compilation) {\r\n\t\tcompilation.plugin(\"record-modules\", function(modules, records) {\r\n\t\t\trecords.nextFreeModuleId = compilation.nextFreeModuleId;\r\n\t\t\tif(!records.modules) records.modules = {};\r\n\t\t\tif(!records.modules.byIdentifier) records.modules.byIdentifier = {};\r\n\t\t\tmodules.forEach(function(module) {\r\n\t\t\t\tvar identifier = makeRelative(compiler, module.identifier());\r\n\t\t\t\trecords.modules.byIdentifier[identifier] = module.id;\r\n\t\t\t});\r\n\t\t});\r\n\t\tcompilation.plugin(\"revive-modules\", function(modules, records) {\r\n\t\t\tif(records.nextFreeModuleId)\r\n\t\t\t\tcompilation.nextFreeModuleId = records.nextFreeModuleId;\r\n\t\t\tif(!records.modules || !records.modules.byIdentifier) return;\r\n\t\t\tvar usedIds = {\r\n\t\t\t\t0: true\r\n\t\t\t};\r\n\t\t\tmodules.forEach(function(module) {\r\n\t\t\t\tif(module.id !== null) return;\r\n\t\t\t\tvar identifier = makeRelative(compiler, module.identifier());\r\n\t\t\t\tvar id = records.modules.byIdentifier[identifier];\r\n\t\t\t\tif(id === undefined) return;\r\n\t\t\t\tif(usedIds[id]) return;\r\n\t\t\t\tusedIds[id] = true;\r\n\t\t\t\tmodule.id = id;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tfunction getDepBlockIdent(chunk, block) {\r\n\t\t\tvar ident = [];\r\n\t\t\tif(block.chunks.length > 1)\r\n\t\t\t\tident.push(block.chunks.indexOf(chunk));\r\n\t\t\twhile(block.parent) {\r\n\t\t\t\tvar p = block.parent;\r\n\t\t\t\tvar idx = p.blocks.indexOf(block);\r\n\t\t\t\tvar l = p.blocks.length - 1;\r\n\t\t\t\tident.unshift(idx + \"/\" + l);\r\n\t\t\t\tblock = block.parent;\r\n\t\t\t}\r\n\t\t\tif(!block.identifier) return null;\r\n\t\t\tident.unshift(makeRelative(compiler, block.identifier()));\r\n\t\t\treturn ident.join(\":\");\r\n\t\t}\r\n\t\tcompilation.plugin(\"record-chunks\", function(chunks, records) {\r\n\t\t\trecords.nextFreeChunkId = compilation.nextFreeChunkId;\r\n\t\t\tif(!records.chunks) records.chunks = {};\r\n\t\t\tif(!records.chunks.byName) records.chunks.byName = {};\r\n\t\t\tif(!records.chunks.byBlocks) records.chunks.byBlocks = {};\r\n\t\t\tchunks.forEach(function(chunk) {\r\n\t\t\t\tvar name = chunk.name;\r\n\t\t\t\tvar blockIdents = chunk.blocks.map(getDepBlockIdent.bind(null, chunk)).filter(Boolean);\r\n\t\t\t\tif(name) records.chunks.byName[name] = chunk.id;\r\n\t\t\t\tblockIdents.forEach(function(blockIdent) {\r\n\t\t\t\t\trecords.chunks.byBlocks[blockIdent] = chunk.id;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\tcompilation.plugin(\"revive-chunks\", function(chunks, records) {\r\n\t\t\tif(records.nextFreeChunkId)\r\n\t\t\t\tcompilation.nextFreeChunkId = records.nextFreeChunkId;\r\n\t\t\tif(!records.chunks) return;\r\n\t\t\tvar usedIds = {};\r\n\t\t\tif(records.chunks.byName) {\r\n\t\t\t\tchunks.forEach(function(chunk) {\r\n\t\t\t\t\tif(chunk.id !== null) return;\r\n\t\t\t\t\tif(!chunk.name) return;\r\n\t\t\t\t\tvar id = records.chunks.byName[chunk.name];\r\n\t\t\t\t\tif(id === undefined) return;\r\n\t\t\t\t\tif(usedIds[id]) return;\r\n\t\t\t\t\tusedIds[id] = true;\r\n\t\t\t\t\tchunk.id = id;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tif(records.chunks.byBlocks) {\r\n\t\t\t\tvar argumentedChunks = chunks.filter(function(chunk) {\r\n\t\t\t\t\treturn chunk.id === null;\r\n\t\t\t\t}).map(function(chunk) {\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tchunk: chunk,\r\n\t\t\t\t\t\tblockIdents: chunk.blocks.map(getDepBlockIdent.bind(null, chunk)).filter(Boolean)\r\n\t\t\t\t\t};\r\n\t\t\t\t}).filter(function(arg) {\r\n\t\t\t\t\treturn arg.blockIdents.length > 0;\r\n\t\t\t\t});\r\n\t\t\t\tvar blockIdentsCount = {};\r\n\t\t\t\targumentedChunks.forEach(function(arg, idx) {\r\n\t\t\t\t\targ.blockIdents.forEach(function(blockIdent) {\r\n\t\t\t\t\t\tvar id = records.chunks.byBlocks[blockIdent];\r\n\t\t\t\t\t\tif(typeof id !== \"number\") return;\r\n\t\t\t\t\t\tvar accessor = id + \":\" + idx;\r\n\t\t\t\t\t\tblockIdentsCount[accessor] = (blockIdentsCount[accessor] || 0) + 1;\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tblockIdentsCount = Object.keys(blockIdentsCount).map(function(accessor) {\r\n\t\t\t\t\treturn [blockIdentsCount[accessor]].concat(accessor.split(\":\").map(Number));\r\n\t\t\t\t}).sort(function(a, b) {\r\n\t\t\t\t\treturn b[0] - a[0];\r\n\t\t\t\t});\r\n\t\t\t\tblockIdentsCount.forEach(function(arg) {\r\n\t\t\t\t\tvar id = arg[1];\r\n\t\t\t\t\tif(usedIds[id]) return;\r\n\t\t\t\t\tvar idx = arg[2];\r\n\t\t\t\t\tvar chunk = argumentedChunks[idx].chunk;\r\n\t\t\t\t\tif(chunk.id !== null) return;\r\n\t\t\t\t\tusedIds[id] = true;\r\n\t\t\t\t\tchunk.id = id;\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n};\r\n"]}