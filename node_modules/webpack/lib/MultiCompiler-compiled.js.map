{"version":3,"sources":["MultiCompiler.js"],"names":[],"mappings":"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","file":"MultiCompiler-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Tapable = require(\"tapable\");\r\nvar async = require(\"async\");\r\nvar Stats = require(\"./Stats\");\r\n\r\nfunction MultiWatching(watchings) {\r\n\tthis.watchings = watchings;\r\n}\r\n\r\nMultiWatching.prototype.invalidate = function() {\r\n\tthis.watchings.forEach(function(watching) {\r\n\t\twatching.invalidate();\r\n\t});\r\n};\r\n\r\nMultiWatching.prototype.close = function(callback) {\r\n\tasync.forEach(this.watchings, function(watching, callback) {\r\n\t\twatching.close(callback);\r\n\t}, callback);\r\n};\r\n\r\nfunction MultiCompiler(compilers) {\r\n\tTapable.call(this);\r\n\tif(!Array.isArray(compilers)) {\r\n\t\tcompilers = Object.keys(compilers).map(function(name) {\r\n\t\t\tcompilers[name].name = name;\r\n\t\t\treturn compilers[name];\r\n\t\t});\r\n\t}\r\n\tthis.compilers = compilers;\r\n\r\n\tfunction delegateProperty(name) {\r\n\t\tObject.defineProperty(this, name, {\r\n\t\t\tconfigurable: false,\r\n\t\t\tget: function() {\r\n\t\t\t\tthrow new Error(\"Cannot read \" + name + \" of a MultiCompiler\");\r\n\t\t\t},\r\n\t\t\tset: function(value) {\r\n\t\t\t\tthis.compilers.forEach(function(compiler) {\r\n\t\t\t\t\tcompiler[name] = value;\r\n\t\t\t\t});\r\n\t\t\t}.bind(this)\r\n\t\t});\r\n\t}\r\n\tdelegateProperty.call(this, \"outputFileSystem\");\r\n\tdelegateProperty.call(this, \"inputFileSystem\");\r\n\r\n\tObject.defineProperty(this, \"outputPath\", {\r\n\t\tconfigurable: false,\r\n\t\tget: function() {\r\n\t\t\tvar commonPath = compilers[0].outputPath;\r\n\t\t\tfor(var i = 1; i < compilers.length; i++) {\r\n\t\t\t\twhile(compilers[i].outputPath.indexOf(commonPath) !== 0 && /[\\/\\\\]/.test(commonPath)) {\r\n\t\t\t\t\tcommonPath = commonPath.replace(/[\\/\\\\][^\\/\\\\]*$/, \"\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif(!commonPath && compilers[0].outputPath[0] === \"/\") return \"/\";\r\n\t\t\treturn commonPath;\r\n\t\t}\r\n\t});\r\n\r\n\tvar doneCompilers = 0;\r\n\tvar compilerStats = [];\r\n\tthis.compilers.forEach(function(compiler, idx) {\r\n\t\tvar compilerDone = false;\r\n\t\tcompiler.plugin(\"done\", function(stats) {\r\n\t\t\tif(!compilerDone) {\r\n\t\t\t\tcompilerDone = true;\r\n\t\t\t\tdoneCompilers++;\r\n\t\t\t}\r\n\t\t\tcompilerStats[idx] = stats;\r\n\t\t\tif(doneCompilers === this.compilers.length) {\r\n\t\t\t\tthis.applyPlugins(\"done\", new MultiStats(compilerStats));\r\n\t\t\t}\r\n\t\t}.bind(this));\r\n\t\tcompiler.plugin(\"invalid\", function() {\r\n\t\t\tif(compilerDone) {\r\n\t\t\t\tcompilerDone = false;\r\n\t\t\t\tdoneCompilers--;\r\n\t\t\t}\r\n\t\t\tthis.applyPlugins(\"invalid\");\r\n\t\t}.bind(this));\r\n\t}, this);\r\n}\r\nmodule.exports = MultiCompiler;\r\n\r\nMultiCompiler.prototype = Object.create(Tapable.prototype);\r\nMultiCompiler.prototype.constructor = MultiCompiler;\r\n\r\nMultiCompiler.prototype.watch = function(watchDelay, handler) {\r\n\tvar watchings = this.compilers.map(function(compiler) {\r\n\t\treturn compiler.watch(watchDelay, handler);\r\n\t});\r\n\treturn new MultiWatching(watchings);\r\n};\r\n\r\nMultiCompiler.prototype.run = function(callback) {\r\n\tasync.map(this.compilers, function(compiler, callback) {\r\n\t\tcompiler.run(callback);\r\n\t}, function(err, stats) {\r\n\t\tif(err) return callback(err);\r\n\t\tcallback(null, new MultiStats(stats));\r\n\t});\r\n};\r\n\r\nMultiCompiler.prototype.purgeInputFileSystem = function() {\r\n\tthis.compilers.forEach(function(compiler) {\r\n\t\tif(compiler.inputFileSystem && compiler.inputFileSystem.purge)\r\n\t\t\tcompiler.inputFileSystem.purge();\r\n\t});\r\n};\r\n\r\nfunction MultiStats(stats) {\r\n\tthis.stats = stats;\r\n\tthis.hash = stats.map(function(stat) {\r\n\t\treturn stat.hash;\r\n\t}).join(\"\");\r\n}\r\n\r\nMultiStats.prototype.hasErrors = function() {\r\n\treturn this.stats.map(function(stat) {\r\n\t\treturn stat.hasErrors();\r\n\t}).reduce(function(a, b) {\r\n\t\treturn a || b;\r\n\t}, false);\r\n};\r\n\r\nMultiStats.prototype.hasWarnings = function() {\r\n\treturn this.stats.map(function(stat) {\r\n\t\treturn stat.hasWarnings();\r\n\t}).reduce(function(a, b) {\r\n\t\treturn a || b;\r\n\t}, false);\r\n};\r\n\r\nMultiStats.prototype.toJson = function(options, forToString) {\r\n\tvar jsons = this.stats.map(function(stat) {\r\n\t\tvar obj = stat.toJson(options, forToString);\r\n\t\tobj.name = stat.compilation && stat.compilation.name;\r\n\t\treturn obj;\r\n\t});\r\n\tvar obj = {\r\n\t\terrors: jsons.reduce(function(arr, j) {\r\n\t\t\treturn arr.concat(j.errors.map(function(msg) {\r\n\t\t\t\treturn \"(\" + j.name + \") \" + msg;\r\n\t\t\t}));\r\n\t\t}, []),\r\n\t\twarnings: jsons.reduce(function(arr, j) {\r\n\t\t\treturn arr.concat(j.warnings.map(function(msg) {\r\n\t\t\t\treturn \"(\" + j.name + \") \" + msg;\r\n\t\t\t}));\r\n\t\t}, [])\r\n\t};\r\n\tif(!options || options.version !== false)\r\n\t\tobj.version = require(\"../package.json\").version;\r\n\tif(!options || options.hash !== false)\r\n\t\tobj.hash = this.hash;\r\n\tif(!options || options.children !== false)\r\n\t\tobj.children = jsons;\r\n\treturn obj;\r\n};\r\n\r\nMultiStats.prototype.toString = Stats.prototype.toString;\r\n"]}