{"version":3,"sources":["CommonJsPlugin.js"],"names":[],"mappings":"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","file":"CommonJsPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar ConstDependency = require(\"./ConstDependency\");\r\nvar CommonJsRequireDependency = require(\"./CommonJsRequireDependency\");\r\nvar CommonJsRequireContextDependency = require(\"./CommonJsRequireContextDependency\");\r\nvar RequireResolveDependency = require(\"./RequireResolveDependency\");\r\nvar RequireResolveContextDependency = require(\"./RequireResolveContextDependency\");\r\nvar RequireResolveHeaderDependency = require(\"./RequireResolveHeaderDependency\");\r\nvar RequireHeaderDependency = require(\"./RequireHeaderDependency\");\r\n\r\nvar NullFactory = require(\"../NullFactory\");\r\n\r\nvar RequireResolveDependencyParserPlugin = require(\"./RequireResolveDependencyParserPlugin\");\r\nvar CommonJsRequireDependencyParserPlugin = require(\"./CommonJsRequireDependencyParserPlugin\");\r\n\r\nvar BasicEvaluatedExpression = require(\"../BasicEvaluatedExpression\");\r\n\r\nfunction CommonJsPlugin(options) {\r\n\tthis.options = options;\r\n}\r\nmodule.exports = CommonJsPlugin;\r\n\r\nCommonJsPlugin.prototype.apply = function(compiler) {\r\n\tfunction setTypeof(expr, value) {\r\n\t\tcompiler.parser.plugin(\"evaluate typeof \" + expr, function(expr) {\r\n\t\t\treturn new BasicEvaluatedExpression().setString(value).setRange(expr.range);\r\n\t\t});\r\n\t\tcompiler.parser.plugin(\"typeof \" + expr, function(expr) {\r\n\t\t\tvar dep = new ConstDependency(JSON.stringify(value), expr.range);\r\n\t\t\tdep.loc = expr.loc;\r\n\t\t\tthis.state.current.addDependency(dep);\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\tcompiler.plugin(\"compilation\", function(compilation, params) {\r\n\t\tvar normalModuleFactory = params.normalModuleFactory;\r\n\t\tvar contextModuleFactory = params.contextModuleFactory;\r\n\r\n\t\tcompilation.dependencyFactories.set(CommonJsRequireDependency, normalModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(CommonJsRequireDependency, new CommonJsRequireDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(CommonJsRequireContextDependency, contextModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(CommonJsRequireContextDependency, new CommonJsRequireContextDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(RequireResolveDependency, normalModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(RequireResolveDependency, new RequireResolveDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(RequireResolveContextDependency, contextModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(RequireResolveContextDependency, new RequireResolveContextDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(RequireResolveHeaderDependency, new NullFactory());\r\n\t\tcompilation.dependencyTemplates.set(RequireResolveHeaderDependency, new RequireResolveHeaderDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(RequireHeaderDependency, new NullFactory());\r\n\t\tcompilation.dependencyTemplates.set(RequireHeaderDependency, new RequireHeaderDependency.Template());\r\n\t});\r\n\tsetTypeof(\"require\", \"function\");\r\n\tsetTypeof(\"require.resolve\", \"function\");\r\n\tsetTypeof(\"require.resolveWeak\", \"function\");\r\n\tcompiler.parser.plugin(\"evaluate typeof module\", function(expr) {\r\n\t\treturn new BasicEvaluatedExpression().setString(\"object\").setRange(expr.range);\r\n\t});\r\n\tcompiler.parser.plugin(\"assign require\", function(expr) {\r\n\t\t// to not leak to global \"require\", we need to define a local require here.\r\n\t\tvar dep = new ConstDependency(\"var require;\", 0);\r\n\t\tdep.loc = expr.loc;\r\n\t\tthis.state.current.addDependency(dep);\r\n\t\tthis.scope.definitions.push(\"require\");\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"can-rename require\", function() {\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"rename require\", function(expr) {\r\n\t\t// define the require variable. It's still undefined, but not \"not defined\".\r\n\t\tvar dep = new ConstDependency(\"var require;\", 0);\r\n\t\tdep.loc = expr.loc;\r\n\t\tthis.state.current.addDependency(dep);\r\n\t\treturn false;\r\n\t});\r\n\tcompiler.parser.plugin(\"typeof module\", function() {\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"evaluate typeof exports\", function(expr) {\r\n\t\treturn new BasicEvaluatedExpression().setString(\"object\").setRange(expr.range);\r\n\t});\r\n\tcompiler.parser.apply(\r\n\t\tnew CommonJsRequireDependencyParserPlugin(this.options),\r\n\t\tnew RequireResolveDependencyParserPlugin(this.options)\r\n\t);\r\n};\r\n"]}