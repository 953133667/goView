{"version":3,"sources":["CommonsChunkPlugin.js"],"names":[],"mappings":"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","file":"CommonsChunkPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar nextIdent = 0;\r\n\r\nfunction CommonsChunkPlugin(options, filenameTemplate, selectedChunks, minChunks) {\r\n\tif(options && typeof options === \"object\" && !Array.isArray(options)) {\r\n\t\tthis.chunkNames = options.name || options.names;\r\n\t\tthis.filenameTemplate = options.filename;\r\n\t\tthis.minChunks = options.minChunks;\r\n\t\tthis.selectedChunks = options.chunks;\r\n\t\tif(options.children) this.selectedChunks = false;\r\n\t\tthis.async = options.async;\r\n\t\tthis.minSize = options.minSize;\r\n\t} else {\r\n\t\tvar chunkNames = options;\r\n\t\tif(typeof filenameTemplate !== \"string\" && filenameTemplate !== null) {\r\n\t\t\tminChunks = selectedChunks;\r\n\t\t\tselectedChunks = filenameTemplate;\r\n\t\t\tfilenameTemplate = chunkNames;\r\n\t\t}\r\n\t\tif(!Array.isArray(selectedChunks) && typeof selectedChunks !== \"boolean\" && selectedChunks !== null) {\r\n\t\t\tminChunks = selectedChunks;\r\n\t\t\tselectedChunks = undefined;\r\n\t\t}\r\n\t\tthis.chunkNames = chunkNames;\r\n\t\tthis.filenameTemplate = filenameTemplate;\r\n\t\tthis.minChunks = minChunks;\r\n\t\tthis.selectedChunks = selectedChunks;\r\n\t}\r\n\tthis.ident = __filename + (nextIdent++);\r\n}\r\n\r\nmodule.exports = CommonsChunkPlugin;\r\nCommonsChunkPlugin.prototype.apply = function(compiler) {\r\n\tvar chunkNames = this.chunkNames;\r\n\tvar filenameTemplate = this.filenameTemplate;\r\n\tvar minChunks = this.minChunks;\r\n\tvar selectedChunks = this.selectedChunks;\r\n\tvar async = this.async;\r\n\tvar minSize = this.minSize;\r\n\tvar ident = this.ident;\r\n\tcompiler.plugin(\"this-compilation\", function(compilation) {\r\n\t\tcompilation.plugin([\"optimize-chunks\", \"optimize-extracted-chunks\"], function(chunks) {\r\n\t\t\t// only optimize once\r\n\t\t\tif(compilation[ident]) return;\r\n\t\t\tcompilation[ident] = true;\r\n\r\n\t\t\tvar commonChunks;\r\n\t\t\tif(!chunkNames && (selectedChunks === false || async)) {\r\n\t\t\t\tcommonChunks = chunks;\r\n\t\t\t} else if(Array.isArray(chunkNames) || typeof chunkNames === \"string\") {\r\n\t\t\t\tcommonChunks = [].concat(chunkNames).map(function(chunkName) {\r\n\t\t\t\t\tvar chunk = chunks.filter(function(chunk) {\r\n\t\t\t\t\t\treturn chunk.name === chunkName;\r\n\t\t\t\t\t})[0];\r\n\t\t\t\t\tif(!chunk) {\r\n\t\t\t\t\t\tchunk = this.addChunk(chunkName);\r\n\t\t\t\t\t\tchunk.initial = chunk.entry = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn chunk;\r\n\t\t\t\t}, this);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error(\"Invalid chunkNames argument\");\r\n\t\t\t}\r\n\t\t\tcommonChunks.forEach(function processCommonChunk(commonChunk, idx) {\r\n\t\t\t\tvar commonModulesCount = [];\r\n\t\t\t\tvar commonModules = [];\r\n\t\t\t\tvar usedChunks;\r\n\t\t\t\tif(Array.isArray(selectedChunks)) {\r\n\t\t\t\t\tusedChunks = chunks.filter(function(chunk) {\r\n\t\t\t\t\t\tif(chunk === commonChunk) return false;\r\n\t\t\t\t\t\treturn selectedChunks.indexOf(chunk.name) >= 0;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if(selectedChunks === false || async) {\r\n\t\t\t\t\tusedChunks = (commonChunk.chunks || []).filter(function(chunk) {\r\n\t\t\t\t\t\t// we can only move modules from this chunk if the \"commonChunk\" is the only parent\r\n\t\t\t\t\t\treturn async || chunk.parents.length === 1;\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif(!commonChunk.entry) {\r\n\t\t\t\t\t\tcompilation.errors.push(new Error(\"CommonsChunkPlugin: While running in normal mode it's not allowed to use a non-entry chunk (\" + commonChunk.name + \")\"));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tusedChunks = chunks.filter(function(chunk) {\r\n\t\t\t\t\t\tvar found = commonChunks.indexOf(chunk);\r\n\t\t\t\t\t\tif(found >= idx) return false;\r\n\t\t\t\t\t\treturn chunk.entry;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(async) {\r\n\t\t\t\t\tvar asyncChunk = this.addChunk(typeof async === \"string\" ? async : undefined);\r\n\t\t\t\t\tasyncChunk.chunkReason = \"async commons chunk\";\r\n\t\t\t\t\tasyncChunk.extraAsync = true;\r\n\t\t\t\t\tasyncChunk.addParent(commonChunk);\r\n\t\t\t\t\tcommonChunk.addChunk(asyncChunk);\r\n\t\t\t\t\tcommonChunk = asyncChunk;\r\n\t\t\t\t}\r\n\t\t\t\tusedChunks.forEach(function(chunk) {\r\n\t\t\t\t\tchunk.modules.forEach(function(module) {\r\n\t\t\t\t\t\tvar idx = commonModules.indexOf(module);\r\n\t\t\t\t\t\tif(idx < 0) {\r\n\t\t\t\t\t\t\tcommonModules.push(module);\r\n\t\t\t\t\t\t\tcommonModulesCount.push(1);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tcommonModulesCount[idx]++;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t});\r\n\t\t\t\tvar reallyUsedChunks = [];\r\n\t\t\t\tvar reallyUsedModules = [];\r\n\t\t\t\tcommonModulesCount.forEach(function(count, idx) {\r\n\t\t\t\t\tvar module = commonModules[idx];\r\n\t\t\t\t\tif(typeof minChunks === \"function\") {\r\n\t\t\t\t\t\tif(!minChunks(module, count))\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t} else if(count < (minChunks || Math.max(2, usedChunks.length))) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treallyUsedModules.push(module);\r\n\t\t\t\t});\r\n\t\t\t\tif(minSize) {\r\n\t\t\t\t\tvar size = reallyUsedModules.reduce(function(a, b) {\r\n\t\t\t\t\t\treturn a + b.size();\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t\tif(size < minSize)\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treallyUsedModules.forEach(function(module) {\r\n\t\t\t\t\tusedChunks.forEach(function(chunk) {\r\n\t\t\t\t\t\tif(module.removeChunk(chunk)) {\r\n\t\t\t\t\t\t\tif(reallyUsedChunks.indexOf(chunk) < 0)\r\n\t\t\t\t\t\t\t\treallyUsedChunks.push(chunk);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcommonChunk.addModule(module);\r\n\t\t\t\t\tmodule.addChunk(commonChunk);\r\n\t\t\t\t});\r\n\t\t\t\tif(async) {\r\n\t\t\t\t\treallyUsedChunks.forEach(function(chunk) {\r\n\t\t\t\t\t\tif(chunk.initial || chunk.entry)\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\tchunk.blocks.forEach(function(block) {\r\n\t\t\t\t\t\t\tblock.chunks.unshift(commonChunk);\r\n\t\t\t\t\t\t\tcommonChunk.addBlock(block);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t});\r\n\t\t\t\t\tasyncChunk.origins = reallyUsedChunks.map(function(chunk) {\r\n\t\t\t\t\t\treturn chunk.origins.map(function(origin) {\r\n\t\t\t\t\t\t\tvar newOrigin = Object.create(origin);\r\n\t\t\t\t\t\t\tnewOrigin.reasons = (origin.reasons || []).slice();\r\n\t\t\t\t\t\t\tnewOrigin.reasons.push(\"async commons\");\r\n\t\t\t\t\t\t\treturn newOrigin;\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}).reduce(function(arr, a) {\r\n\t\t\t\t\t\tarr.push.apply(arr, a);\r\n\t\t\t\t\t\treturn arr;\r\n\t\t\t\t\t}, []);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tusedChunks.forEach(function(chunk) {\r\n\t\t\t\t\t\tchunk.parents = [commonChunk];\r\n\t\t\t\t\t\tcommonChunk.chunks.push(chunk);\r\n\t\t\t\t\t\tif(chunk.initial)\r\n\t\t\t\t\t\t\tcommonChunk.initial = true;\r\n\t\t\t\t\t\tif(chunk.entry) {\r\n\t\t\t\t\t\t\tcommonChunk.entry = true;\r\n\t\t\t\t\t\t\tchunk.entry = false;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif(filenameTemplate)\r\n\t\t\t\t\tcommonChunk.filenameTemplate = filenameTemplate;\r\n\t\t\t}, this);\r\n\t\t\tthis.restartApplyPlugins();\r\n\t\t});\r\n\t});\r\n};\r\n"]}