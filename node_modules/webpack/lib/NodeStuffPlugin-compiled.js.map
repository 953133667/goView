{"version":3,"sources":["NodeStuffPlugin.js"],"names":[],"mappings":"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","file":"NodeStuffPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar path = require(\"path\");\r\nvar ModuleParserHelpers = require(\"./ModuleParserHelpers\");\r\nvar ConstDependency = require(\"./dependencies/ConstDependency\");\r\nvar BasicEvaluatedExpression = require(\"./BasicEvaluatedExpression\");\r\nvar UnsupportedFeatureWarning = require(\"./UnsupportedFeatureWarning\");\r\n\r\nvar NullFactory = require(\"./NullFactory\");\r\n\r\nfunction NodeStuffPlugin(options) {\r\n\tthis.options = options;\r\n}\r\nmodule.exports = NodeStuffPlugin;\r\nNodeStuffPlugin.prototype.apply = function(compiler) {\r\n\tcompiler.plugin(\"compilation\", function(compilation) {\r\n\t\tcompilation.dependencyFactories.set(ConstDependency, new NullFactory());\r\n\t\tcompilation.dependencyTemplates.set(ConstDependency, new ConstDependency.Template());\r\n\t});\r\n\r\n\tfunction ignore() {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction setConstant(expressionName, value) {\r\n\t\tcompiler.parser.plugin(\"expression \" + expressionName, function() {\r\n\t\t\tthis.state.current.addVariable(expressionName, JSON.stringify(value));\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction setModuleConstant(expressionName, fn) {\r\n\t\tcompiler.parser.plugin(\"expression \" + expressionName, function() {\r\n\t\t\tthis.state.current.addVariable(expressionName, JSON.stringify(fn(this.state.module)));\r\n\t\t\treturn true;\r\n\t\t});\r\n\t}\r\n\tvar context = compiler.context;\r\n\tif(this.options.__filename === \"mock\") {\r\n\t\tsetConstant(\"__filename\", \"/index.js\");\r\n\t} else if(this.options.__filename) {\r\n\t\tsetModuleConstant(\"__filename\", function(module) {\r\n\t\t\treturn path.relative(context, module.resource);\r\n\t\t});\r\n\t}\r\n\tcompiler.parser.plugin(\"evaluate Identifier __filename\", function(expr) {\r\n\t\tif(!this.state.module) return;\r\n\t\tvar res = new BasicEvaluatedExpression();\r\n\t\tres.setString(this.state.module.splitQuery(this.state.module.resource)[0]);\r\n\t\tres.setRange(expr.range);\r\n\t\treturn res;\r\n\t});\r\n\tif(this.options.__dirname === \"mock\") {\r\n\t\tsetConstant(\"__dirname\", \"/\");\r\n\t} else if(this.options.__dirname) {\r\n\t\tsetModuleConstant(\"__dirname\", function(module) {\r\n\t\t\treturn path.relative(context, module.context);\r\n\t\t});\r\n\t}\r\n\tcompiler.parser.plugin(\"evaluate Identifier __dirname\", function(expr) {\r\n\t\tif(!this.state.module) return;\r\n\t\tvar res = new BasicEvaluatedExpression();\r\n\t\tres.setString(this.state.module.context);\r\n\t\tres.setRange(expr.range);\r\n\t\treturn res;\r\n\t});\r\n\tcompiler.parser.plugin(\"expression require.main\", function(expr) {\r\n\t\tvar dep = new ConstDependency(\"__webpack_require__.c[0]\", expr.range);\r\n\t\tdep.loc = expr.loc;\r\n\t\tthis.state.current.addDependency(dep);\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"expression require.extensions\", function(expr) {\r\n\t\tvar dep = new ConstDependency(\"(void 0)\", expr.range);\r\n\t\tdep.loc = expr.loc;\r\n\t\tthis.state.current.addDependency(dep);\r\n\t\tif(!this.state.module) return;\r\n\t\tthis.state.module.warnings.push(new UnsupportedFeatureWarning(this.state.module, \"require.extensions is not supported by webpack. Use a loader instead.\"));\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"expression module.exports\", ignore);\r\n\tcompiler.parser.plugin(\"expression module.loaded\", ignore);\r\n\tcompiler.parser.plugin(\"expression module.id\", ignore);\r\n\tcompiler.parser.plugin(\"evaluate Identifier module.hot\", function(expr) {\r\n\t\treturn new BasicEvaluatedExpression().setBoolean(false).setRange(expr.range);\r\n\t});\r\n\tcompiler.parser.plugin(\"expression module\", function() {\r\n\t\tvar moduleJsPath = path.join(__dirname, \"..\", \"buildin\", \"module.js\");\r\n\t\tif(this.state.module.context) {\r\n\t\t\tmoduleJsPath = path.relative(this.state.module.context, moduleJsPath);\r\n\t\t\tif(!/^[A-Z]:/i.test(moduleJsPath)) {\r\n\t\t\t\tmoduleJsPath = \"./\" + moduleJsPath.replace(/\\\\/g, \"/\");\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn ModuleParserHelpers.addParsedVariable(this, \"module\", \"require(\" + JSON.stringify(moduleJsPath) + \")(module)\");\r\n\t});\r\n};\r\n"]}