{"version":3,"sources":["HotModuleReplacementPlugin.js"],"names":[],"mappings":"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","file":"HotModuleReplacementPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Template = require(\"./Template\");\r\nvar BasicEvaluatedExpression = require(\"./BasicEvaluatedExpression\");\r\nvar ModuleHotAcceptDependency = require(\"./dependencies/ModuleHotAcceptDependency\");\r\nvar ModuleHotDeclineDependency = require(\"./dependencies/ModuleHotDeclineDependency\");\r\nvar RawSource = require(\"webpack-core/lib/RawSource\");\r\nvar ConstDependency = require(\"./dependencies/ConstDependency\");\r\nvar NullFactory = require(\"./NullFactory\");\r\n\r\nfunction HotModuleReplacementPlugin() {}\r\nmodule.exports = HotModuleReplacementPlugin;\r\n\r\nHotModuleReplacementPlugin.prototype.apply = function(compiler) {\r\n\tvar hotUpdateChunkFilename = compiler.options.output.hotUpdateChunkFilename;\r\n\tvar hotUpdateMainFilename = compiler.options.output.hotUpdateMainFilename;\r\n\tcompiler.plugin(\"compilation\", function(compilation, params) {\r\n\t\tvar hotUpdateChunkTemplate = compilation.hotUpdateChunkTemplate;\r\n\t\tif(!hotUpdateChunkTemplate) return;\r\n\r\n\t\tvar normalModuleFactory = params.normalModuleFactory;\r\n\r\n\t\tcompilation.dependencyFactories.set(ConstDependency, new NullFactory());\r\n\t\tcompilation.dependencyTemplates.set(ConstDependency, new ConstDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(ModuleHotAcceptDependency, normalModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(ModuleHotAcceptDependency, new ModuleHotAcceptDependency.Template());\r\n\r\n\t\tcompilation.dependencyFactories.set(ModuleHotDeclineDependency, normalModuleFactory);\r\n\t\tcompilation.dependencyTemplates.set(ModuleHotDeclineDependency, new ModuleHotDeclineDependency.Template());\r\n\r\n\t\tcompilation.plugin(\"record\", function(compilation, records) {\r\n\t\t\tif(records.hash === this.hash) return;\r\n\t\t\trecords.hash = compilation.hash;\r\n\t\t\trecords.moduleHashs = {};\r\n\t\t\tthis.modules.forEach(function(module) {\r\n\t\t\t\tvar identifier = module.identifier();\r\n\t\t\t\tvar hash = require(\"crypto\").createHash(\"md5\");\r\n\t\t\t\tmodule.updateHash(hash);\r\n\t\t\t\trecords.moduleHashs[identifier] = hash.digest(\"hex\");\r\n\t\t\t});\r\n\t\t\trecords.chunkHashs = {};\r\n\t\t\tthis.chunks.forEach(function(chunk) {\r\n\t\t\t\trecords.chunkHashs[chunk.id] = chunk.hash;\r\n\t\t\t});\r\n\t\t\trecords.chunkModuleIds = {};\r\n\t\t\tthis.chunks.forEach(function(chunk) {\r\n\t\t\t\trecords.chunkModuleIds[chunk.id] = chunk.modules.map(function(m) {\r\n\t\t\t\t\treturn m.id;\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\tcompilation.plugin(\"after-hash\", function() {\r\n\t\t\tvar records = this.records;\r\n\t\t\tif(!records) return;\r\n\t\t\tvar preHash = records.preHash || \"x\";\r\n\t\t\tvar prepreHash = records.prepreHash || \"x\";\r\n\t\t\tif(preHash === this.hash) {\r\n\t\t\t\tthis.modifyHash(prepreHash);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\trecords.prepreHash = records.hash || \"x\";\r\n\t\t\trecords.preHash = this.hash;\r\n\t\t\tthis.modifyHash(records.prepreHash);\r\n\t\t});\r\n\t\tcompilation.plugin(\"additional-chunk-assets\", function() {\r\n\t\t\tvar records = this.records;\r\n\t\t\tif(records.hash === this.hash) return;\r\n\t\t\tif(!records.moduleHashs || !records.chunkHashs || !records.chunkModuleIds) return;\r\n\t\t\tthis.modules.forEach(function(module) {\r\n\t\t\t\tvar identifier = module.identifier();\r\n\t\t\t\tvar hash = require(\"crypto\").createHash(\"md5\");\r\n\t\t\t\tmodule.updateHash(hash);\r\n\t\t\t\thash = hash.digest(\"hex\");\r\n\t\t\t\tmodule.hotUpdate = records.moduleHashs[identifier] !== hash;\r\n\t\t\t});\r\n\t\t\tvar hotUpdateMainContent = {\r\n\t\t\t\th: this.hash,\r\n\t\t\t\tc: []\r\n\t\t\t};\r\n\t\t\tObject.keys(records.chunkHashs).forEach(function(chunkId) {\r\n\t\t\t\tchunkId = +chunkId;\r\n\t\t\t\tvar currentChunk = this.chunks.filter(function(chunk) {\r\n\t\t\t\t\treturn chunk.id === chunkId;\r\n\t\t\t\t})[0];\r\n\t\t\t\tif(currentChunk) {\r\n\t\t\t\t\tvar newModules = currentChunk.modules.filter(function(module) {\r\n\t\t\t\t\t\treturn module.hotUpdate;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tif(newModules.length > 0) {\r\n\t\t\t\t\t\tvar source = hotUpdateChunkTemplate.render(chunkId, newModules, this.hash, this.moduleTemplate, this.dependencyTemplates);\r\n\t\t\t\t\t\tvar filename = this.getPath(hotUpdateChunkFilename, {\r\n\t\t\t\t\t\t\thash: records.hash,\r\n\t\t\t\t\t\t\tchunk: currentChunk\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tthis.additionalChunkAssets.push(filename);\r\n\t\t\t\t\t\tthis.assets[filename] = source;\r\n\t\t\t\t\t\thotUpdateMainContent.c.push(chunkId);\r\n\t\t\t\t\t\tcurrentChunk.files.push(filename);\r\n\t\t\t\t\t\tthis.applyPlugins(\"chunk-asset\", currentChunk, filename);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}, this);\r\n\t\t\tvar source = new RawSource(JSON.stringify(hotUpdateMainContent));\r\n\t\t\tvar filename = this.getPath(hotUpdateMainFilename, {\r\n\t\t\t\thash: records.hash\r\n\t\t\t});\r\n\t\t\tthis.assets[filename] = source;\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"hash\", function(hash) {\r\n\t\t\thash.update(\"HotMainTemplateDecorator\");\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"module-require\", function(_, chunk, hash, varModuleId) {\r\n\t\t\treturn \"hotCreateRequire(\" + varModuleId + \")\";\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"require-extensions\", function(source) {\r\n\t\t\tvar buf = [source];\r\n\t\t\tbuf.push(\"\");\r\n\t\t\tbuf.push(\"// __webpack_hash__\");\r\n\t\t\tbuf.push(this.requireFn + \".h = function() { return hotCurrentHash; };\");\r\n\t\t\treturn this.asString(buf);\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"bootstrap\", function(source, chunk, hash) {\r\n\t\t\tsource = this.applyPluginsWaterfall(\"hot-bootstrap\", source, chunk, hash);\r\n\t\t\treturn this.asString([\r\n\t\t\t\tsource,\r\n\t\t\t\t\"\",\r\n\t\t\t\thotInitCode\r\n\t\t\t\t.replace(/\\$require\\$/g, this.requireFn)\r\n\t\t\t\t.replace(/\\$hash\\$/g, JSON.stringify(hash))\r\n\t\t\t\t.replace(/\\/\\*foreachInstalledChunks\\*\\//g, chunk.chunks.length > 0 ? \"for(var chunkId in installedChunks)\" : \"var chunkId = \" + chunk.id + \";\")\r\n\t\t\t]);\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"global-hash\", function() {\r\n\t\t\treturn true;\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"current-hash\", function(_, length) {\r\n\t\t\tif(isFinite(length))\r\n\t\t\t\treturn \"hotCurrentHash.substr(0, \" + length + \")\";\r\n\t\t\telse\r\n\t\t\t\treturn \"hotCurrentHash\";\r\n\t\t});\r\n\r\n\t\tcompilation.mainTemplate.plugin(\"module-obj\", function(source, chunk, hash, varModuleId) {\r\n\t\t\treturn this.asString([\r\n\t\t\t\tsource + \",\",\r\n\t\t\t\t\"hot: hotCreateModule(\" + varModuleId + \"),\",\r\n\t\t\t\t\"parents: hotCurrentParents,\",\r\n\t\t\t\t\"children: []\"\r\n\t\t\t]);\r\n\t\t});\r\n\r\n\t});\r\n\tcompiler.parser.plugin(\"expression __webpack_hash__\", function(expr) {\r\n\t\tvar dep = new ConstDependency(\"__webpack_require__.h()\", expr.range);\r\n\t\tdep.loc = expr.loc;\r\n\t\tthis.state.current.addDependency(dep);\r\n\t\treturn true;\r\n\t});\r\n\tcompiler.parser.plugin(\"evaluate typeof __webpack_hash__\", function(expr) {\r\n\t\treturn new BasicEvaluatedExpression().setString(\"string\").setRange(expr.range);\r\n\t});\r\n\tcompiler.parser.plugin(\"evaluate Identifier module.hot\", function(expr) {\r\n\t\treturn new BasicEvaluatedExpression()\r\n\t\t\t.setBoolean(!!this.state.compilation.hotUpdateChunkTemplate)\r\n\t\t\t.setRange(expr.range);\r\n\t});\r\n\tcompiler.parser.plugin(\"call module.hot.accept\", function(expr) {\r\n\t\tif(!this.state.compilation.hotUpdateChunkTemplate) return false;\r\n\t\tif(expr.arguments.length > 1) {\r\n\t\t\tvar arg = this.evaluateExpression(expr.arguments[0]);\r\n\t\t\tvar params = [];\r\n\t\t\tif(arg.isString()) {\r\n\t\t\t\tparams = [arg];\r\n\t\t\t} else if(arg.isArray()) {\r\n\t\t\t\tparams = arg.items.filter(function(param) {\r\n\t\t\t\t\treturn param.isString();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tparams.forEach(function(param, idx) {\r\n\t\t\t\tvar dep = new ModuleHotAcceptDependency(param.string, param.range);\r\n\t\t\t\tdep.optional = true;\r\n\t\t\t\tdep.loc = Object.create(expr.loc);\r\n\t\t\t\tdep.loc.index = idx;\r\n\t\t\t\tthis.state.module.addDependency(dep);\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t});\r\n\tcompiler.parser.plugin(\"call module.hot.decline\", function(expr) {\r\n\t\tif(!this.state.compilation.hotUpdateChunkTemplate) return false;\r\n\t\tif(expr.arguments.length === 1) {\r\n\t\t\tvar arg = this.evaluateExpression(expr.arguments[0]);\r\n\t\t\tvar params = [];\r\n\t\t\tif(arg.isString()) {\r\n\t\t\t\tparams = [arg];\r\n\t\t\t} else if(arg.isArray()) {\r\n\t\t\t\tparams = arg.items.filter(function(param) {\r\n\t\t\t\t\treturn param.isString();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tparams.forEach(function(param, idx) {\r\n\t\t\t\tvar dep = new ModuleHotDeclineDependency(param.string, param.range);\r\n\t\t\t\tdep.optional = true;\r\n\t\t\t\tdep.loc = Object.create(expr.loc);\r\n\t\t\t\tdep.loc.index = idx;\r\n\t\t\t\tthis.state.module.addDependency(dep);\r\n\t\t\t}.bind(this));\r\n\t\t}\r\n\t});\r\n\tcompiler.parser.plugin(\"expression module.hot\", function() {\r\n\t\treturn true;\r\n\t});\r\n};\r\n\r\nvar hotInitCode = Template.getFunctionContent(require(\"./HotModuleReplacement.runtime.js\"));\r\n"]}