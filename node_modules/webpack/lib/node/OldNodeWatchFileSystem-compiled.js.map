{"version":3,"sources":["OldNodeWatchFileSystem.js"],"names":[],"mappings":"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","file":"OldNodeWatchFileSystem-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar fs = require(\"fs\");\r\nvar path = require(\"path\");\r\nvar async = require(\"async\");\r\n\r\nfunction OldNodeWatchFileSystem(inputFileSystem) {\r\n\tthis.inputFileSystem = inputFileSystem;\r\n}\r\nmodule.exports = OldNodeWatchFileSystem;\r\n\r\n/**\r\n *\r\n * @param files {String[]} a sorted array of paths to files\r\n * @param dirs {String[]} a sorted array of paths to directories\r\n * @param startTime {number} the virtual start time\r\n * @param delay {number} in ms, the time to wait to signal after the first change\r\n * @param callback {function(err, filesModified: String[], dirsModified: String[], fileTimestamps: Object, dirTimestamps: Object)] called once after change plus delay\r\n * @param callbackUndelayed {function()} called once after first change\r\n */\r\nOldNodeWatchFileSystem.prototype.watch = function(files, dirs, missing, startTime, delay, callback, callbackUndelayed) {\r\n\tvar inputFileSystem = this.inputFileSystem;\r\n\r\n\tif(!callbackUndelayed) callbackUndelayed = function() {};\r\n\tvar closed = false;\r\n\tvar fileTimestamps = {};\r\n\tvar dirTimestamps = {};\r\n\tvar filesModified = {};\r\n\tvar dirsModified = {};\r\n\r\n\tvar lastChangeTime;\r\n\r\n\tstartTime = Math.floor(startTime / 1000) * 1000; // only 1 second accuracy\r\n\r\n\tvar directories = {};\r\n\tdirs.forEach(function(dir) {\r\n\t\tdirectories[dir] = {\r\n\t\t\tcontext: dir,\r\n\t\t\tfiles: []\r\n\t\t};\r\n\t});\r\n\tfiles.forEach(function(file) {\r\n\t\tvar dir = path.dirname(file);\r\n\t\tif(!directories[dir]) directories[dir] = {\r\n\t\t\tfiles: []\r\n\t\t};\r\n\t\tdirectories[dir].files.push(file);\r\n\t});\r\n\r\n\tvar items = Object.keys(directories).map(function(dir) {\r\n\t\tdirectories[dir].path = dir;\r\n\t\treturn directories[dir];\r\n\t});\r\n\titems.sort(function(a, b) {\r\n\t\tif(a.path === b.path) return 0;\r\n\t\treturn a.path < b.path ? -1 : 1;\r\n\t});\r\n\titems.forEach(function(item) {\r\n\t\tif(item.files) {\r\n\t\t\titem.files.sort();\r\n\t\t}\r\n\t});\r\n\r\n\tvar initialChange = false;\r\n\tvar change = function() {\r\n\t\tinitialChange = true;\r\n\t};\r\n\r\n\tfunction readStat(item, callback) {\r\n\t\tif(item.context) {\r\n\t\t\tfs.readdir(item.path, function(err, files) {\r\n\t\t\t\tfunction onTimestamp(ts) {\r\n\t\t\t\t\tif(!dirTimestamps[item.context] || dirTimestamps[item.context] < ts)\r\n\t\t\t\t\t\tdirTimestamps[item.context] = ts;\r\n\t\t\t\t\tif(ts >= startTime) {\r\n\t\t\t\t\t\tdirsModified[item.context] = true;\r\n\t\t\t\t\t\tchange(item.path);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn callback();\r\n\t\t\t\t}\r\n\t\t\t\tif(err) return onTimestamp(Infinity);\r\n\t\t\t\tasync.map(files, function(file, callback) {\r\n\t\t\t\t\tfile = path.join(item.path, file);\r\n\t\t\t\t\tvar isFile = false;\r\n\t\t\t\t\tif(item.files) {\r\n\t\t\t\t\t\tif(binarySearch(item.files, function(path) {\r\n\t\t\t\t\t\t\t\tif(path === file) return 0;\r\n\t\t\t\t\t\t\t\treturn path < file ? -1 : 1;\r\n\t\t\t\t\t\t\t}) >= 0) {\r\n\t\t\t\t\t\t\tisFile = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfs.stat(file, function(err, stat) {\r\n\t\t\t\t\t\tvar ts = err ? Infinity : stat.mtime.getTime();\r\n\t\t\t\t\t\tif(isFile) {\r\n\t\t\t\t\t\t\tfileTimestamps[file] = ts;\r\n\t\t\t\t\t\t\tif(ts >= startTime) filesModified[file] = true;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn callback(null, ts);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, function(err, timestamps) {\r\n\t\t\t\t\tif(err) return onTimestamp(Infinity);\r\n\t\t\t\t\tvar ts = timestamps.reduce(function(max, ts) {\r\n\t\t\t\t\t\tif(ts > max)\r\n\t\t\t\t\t\t\treturn ts;\r\n\t\t\t\t\t\treturn max;\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t\tonTimestamp(ts);\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tasync.forEach(item.files, function(file, callback) {\r\n\t\t\t\tfs.stat(file, function(err, stat) {\r\n\t\t\t\t\tvar ts = err ? Infinity : stat.mtime.getTime();\r\n\t\t\t\t\tfileTimestamps[file] = ts;\r\n\t\t\t\t\tif(ts >= startTime) {\r\n\t\t\t\t\t\tfilesModified[file] = true;\r\n\t\t\t\t\t\tchange(file);\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn callback(null, ts);\r\n\t\t\t\t});\r\n\t\t\t}, callback);\r\n\t\t}\r\n\t}\r\n\tasync.forEach(items, function processItem(item, callback) {\r\n\t\tvar isRunning = false;\r\n\t\tvar isScheduled = false;\r\n\t\titem.watcher = fs.watch(item.path, function() {\r\n\t\t\tif(isRunning) {\r\n\t\t\t\tisScheduled = true;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tisRunning = true;\r\n\t\t\treadStat(item, done);\r\n\t\t});\r\n\t\tif(item.context) {\r\n\t\t\titem.children = [];\r\n\t\t\tfs.readdir(item.path, function(err, files) {\r\n\t\t\t\tif(err) {\r\n\t\t\t\t\tchange();\r\n\t\t\t\t\tonWatcherApplied();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tasync.forEach(files, function(file, callback) {\r\n\t\t\t\t\tfile = path.join(item.path, file);\r\n\t\t\t\t\tfs.stat(file, function(err, stat) {\r\n\t\t\t\t\t\tif(err) {\r\n\t\t\t\t\t\t\tchange(file);\r\n\t\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t\t\treturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif(!stat.isDirectory()) return callback();\r\n\t\t\t\t\t\tvar subitem = {\r\n\t\t\t\t\t\t\tpath: file,\r\n\t\t\t\t\t\t\tcontext: item.context\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\titem.children.push(subitem);\r\n\t\t\t\t\t\tprocessItem(subitem, callback);\r\n\t\t\t\t\t});\r\n\t\t\t\t}, onWatcherApplied);\r\n\t\t\t});\r\n\t\t} else onWatcherApplied();\r\n\r\n\t\tfunction onWatcherApplied() {\r\n\t\t\treadStat(item, function() {\r\n\t\t\t\tcallback();\r\n\t\t\t\tdone();\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tfunction done() {\r\n\t\t\tif(closed) return;\r\n\t\t\tif(isScheduled) {\r\n\t\t\t\tisScheduled = false;\r\n\t\t\t\treadStat(item, done);\r\n\t\t\t} else {\r\n\t\t\t\tisRunning = false;\r\n\t\t\t}\r\n\t\t}\r\n\t}, function() {\r\n\t\tvar timeout;\r\n\t\tif(initialChange) {\r\n\r\n\t\t\tcallbackUndelayed();\r\n\t\t\tif(delay) {\r\n\t\t\t\tlastChangeTime = Date.now();\r\n\t\t\t\tchange = restartDelay;\r\n\t\t\t\ttimeout = setTimeout(onTimeout, delay);\r\n\t\t\t} else onTimeout();\r\n\r\n\t\t} else {\r\n\r\n\t\t\tchange = function() {\r\n\r\n\t\t\t\tcallbackUndelayed();\r\n\t\t\t\tif(delay) {\r\n\t\t\t\t\tlastChangeTime = Date.now();\r\n\t\t\t\t\tchange = restartDelay;\r\n\t\t\t\t\ttimeout = setTimeout(onTimeout, delay);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchange = function() {};\r\n\t\t\t\t\tonTimeout();\r\n\t\t\t\t}\r\n\t\t\t};\r\n\r\n\t\t}\r\n\r\n\t\tfunction restartDelay() {\r\n\t\t\tlastChangeTime = Date.now();\r\n\t\t\tclearTimeout(timeout);\r\n\t\t\ttimeout = setTimeout(onTimeout, delay);\r\n\t\t}\r\n\r\n\t});\r\n\r\n\t// 7.\r\n\tfunction onTimeout() {\r\n\t\tvar nextSecond = Math.ceil(lastChangeTime / 1000) * 1000;\r\n\t\tvar timeToNextSecond = nextSecond - Date.now();\r\n\t\tif(timeToNextSecond > 0) {\r\n\t\t\tsetTimeout(onTimeout, timeToNextSecond);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tchange = function() {};\r\n\t\tif(closed) return;\r\n\t\tvar outdatedFiles = Object.keys(filesModified).sort();\r\n\t\tvar outdatedDirs = Object.keys(dirsModified).sort();\r\n\t\tif(inputFileSystem && inputFileSystem.purge) {\r\n\t\t\tinputFileSystem.purge(outdatedFiles);\r\n\t\t\tinputFileSystem.purge(outdatedDirs);\r\n\t\t}\r\n\t\tcallback(null, outdatedFiles, outdatedDirs, [], fileTimestamps, dirTimestamps);\r\n\r\n\t\tclose();\r\n\t}\r\n\r\n\tfunction close() {\r\n\t\tclosed = true;\r\n\t\titems.forEach(function closeItem(item) {\r\n\t\t\titem.watcher.close();\r\n\t\t\tif(item.children) item.children.forEach(closeItem);\r\n\t\t});\r\n\t}\r\n\r\n\treturn {\r\n\t\tclose: close,\r\n\t\tpause: close\r\n\t};\r\n};\r\n\r\nfunction binarySearch(array, comparator) {\r\n\tvar left = 0;\r\n\tvar right = array.length - 1;\r\n\r\n\twhile(left <= right) {\r\n\t\tvar middle = ((left + right) / 2) | 0;\r\n\t\tvar comp = comparator(array[middle]);\r\n\t\tif(comp === 0) return middle;\r\n\t\tif(comp > 0) right = middle - 1;\r\n\t\tif(comp < 0) left = middle + 1;\r\n\t}\r\n\treturn -1;\r\n}\r\n"]}