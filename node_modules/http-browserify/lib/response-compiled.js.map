{"version":3,"sources":["response.js"],"names":[],"mappings":"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","file":"response-compiled.js","sourcesContent":["var Stream = require('stream');\nvar util = require('util');\n\nvar Response = module.exports = function (res) {\n    this.offset = 0;\n    this.readable = true;\n};\n\nutil.inherits(Response, Stream);\n\nvar capable = {\n    streaming : true,\n    status2 : true\n};\n\nfunction parseHeaders (res) {\n    var lines = res.getAllResponseHeaders().split(/\\r?\\n/);\n    var headers = {};\n    for (var i = 0; i < lines.length; i++) {\n        var line = lines[i];\n        if (line === '') continue;\n        \n        var m = line.match(/^([^:]+):\\s*(.*)/);\n        if (m) {\n            var key = m[1].toLowerCase(), value = m[2];\n            \n            if (headers[key] !== undefined) {\n            \n                if (isArray(headers[key])) {\n                    headers[key].push(value);\n                }\n                else {\n                    headers[key] = [ headers[key], value ];\n                }\n            }\n            else {\n                headers[key] = value;\n            }\n        }\n        else {\n            headers[line] = true;\n        }\n    }\n    return headers;\n}\n\nResponse.prototype.getResponse = function (xhr) {\n    var respType = String(xhr.responseType).toLowerCase();\n    if (respType === 'blob') return xhr.responseBlob || xhr.response;\n    if (respType === 'arraybuffer') return xhr.response;\n    return xhr.responseText;\n}\n\nResponse.prototype.getHeader = function (key) {\n    return this.headers[key.toLowerCase()];\n};\n\nResponse.prototype.handle = function (res) {\n    if (res.readyState === 2 && capable.status2) {\n        try {\n            this.statusCode = res.status;\n            this.headers = parseHeaders(res);\n        }\n        catch (err) {\n            capable.status2 = false;\n        }\n        \n        if (capable.status2) {\n            this.emit('ready');\n        }\n    }\n    else if (capable.streaming && res.readyState === 3) {\n        try {\n            if (!this.statusCode) {\n                this.statusCode = res.status;\n                this.headers = parseHeaders(res);\n                this.emit('ready');\n            }\n        }\n        catch (err) {}\n        \n        try {\n            this._emitData(res);\n        }\n        catch (err) {\n            capable.streaming = false;\n        }\n    }\n    else if (res.readyState === 4) {\n        if (!this.statusCode) {\n            this.statusCode = res.status;\n            this.emit('ready');\n        }\n        this._emitData(res);\n        \n        if (res.error) {\n            this.emit('error', this.getResponse(res));\n        }\n        else this.emit('end');\n        \n        this.emit('close');\n    }\n};\n\nResponse.prototype._emitData = function (res) {\n    var respBody = this.getResponse(res);\n    if (respBody.toString().match(/ArrayBuffer/)) {\n        this.emit('data', new Uint8Array(respBody, this.offset));\n        this.offset = respBody.byteLength;\n        return;\n    }\n    if (respBody.length > this.offset) {\n        this.emit('data', respBody.slice(this.offset));\n        this.offset = respBody.length;\n    }\n};\n\nvar isArray = Array.isArray || function (xs) {\n    return Object.prototype.toString.call(xs) === '[object Array]';\n};\n"]}