{"version":3,"sources":["color-blending.js"],"names":[],"mappings":"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","file":"color-blending-compiled.js","sourcesContent":["var Color = require(\"../tree/color\"),\n    functionRegistry = require(\"./function-registry\");\n\n// Color Blending\n// ref: http://www.w3.org/TR/compositing-1\n\nfunction colorBlend(mode, color1, color2) {\n    var ab = color1.alpha, cb, // backdrop\n        as = color2.alpha, cs, // source\n        ar, cr, r = [];        // result\n\n    ar = as + ab * (1 - as);\n    for (var i = 0; i < 3; i++) {\n        cb = color1.rgb[i] / 255;\n        cs = color2.rgb[i] / 255;\n        cr = mode(cb, cs);\n        if (ar) {\n            cr = (as * cs + ab * (cb -\n                  as * (cb + cs - cr))) / ar;\n        }\n        r[i] = cr * 255;\n    }\n\n    return new Color(r, ar);\n}\n\nvar colorBlendModeFunctions = {\n    multiply: function(cb, cs) {\n        return cb * cs;\n    },\n    screen: function(cb, cs) {\n        return cb + cs - cb * cs;\n    },\n    overlay: function(cb, cs) {\n        cb *= 2;\n        return (cb <= 1) ?\n            colorBlendModeFunctions.multiply(cb, cs) :\n            colorBlendModeFunctions.screen(cb - 1, cs);\n    },\n    softlight: function(cb, cs) {\n        var d = 1, e = cb;\n        if (cs > 0.5) {\n            e = 1;\n            d = (cb > 0.25) ? Math.sqrt(cb)\n                : ((16 * cb - 12) * cb + 4) * cb;\n        }\n        return cb - (1 - 2 * cs) * e * (d - cb);\n    },\n    hardlight: function(cb, cs) {\n        return colorBlendModeFunctions.overlay(cs, cb);\n    },\n    difference: function(cb, cs) {\n        return Math.abs(cb - cs);\n    },\n    exclusion: function(cb, cs) {\n        return cb + cs - 2 * cb * cs;\n    },\n\n    // non-w3c functions:\n    average: function(cb, cs) {\n        return (cb + cs) / 2;\n    },\n    negation: function(cb, cs) {\n        return 1 - Math.abs(cb + cs - 1);\n    }\n};\n\nfor (var f in colorBlendModeFunctions) {\n    if (colorBlendModeFunctions.hasOwnProperty(f)) {\n        colorBlend[f] = colorBlend.bind(null, colorBlendModeFunctions[f]);\n    }\n}\n\nfunctionRegistry.addMultiple(colorBlend);\n"]}