{"version":3,"sources":["dimension.js"],"names":[],"mappings":"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","file":"dimension-compiled.js","sourcesContent":["var Node = require(\"./node\"),\n    unitConversions = require(\"../data/unit-conversions\"),\n    Unit = require(\"./unit\"),\n    Color = require(\"./color\");\n\n//\n// A number with a unit\n//\nvar Dimension = function (value, unit) {\n    this.value = parseFloat(value);\n    this.unit = (unit && unit instanceof Unit) ? unit :\n      new Unit(unit ? [unit] : undefined);\n};\n\nDimension.prototype = new Node();\nDimension.prototype.type = \"Dimension\";\nDimension.prototype.accept = function (visitor) {\n    this.unit = visitor.visit(this.unit);\n};\nDimension.prototype.eval = function (context) {\n    return this;\n};\nDimension.prototype.toColor = function () {\n    return new Color([this.value, this.value, this.value]);\n};\nDimension.prototype.genCSS = function (context, output) {\n    if ((context && context.strictUnits) && !this.unit.isSingular()) {\n        throw new Error(\"Multiple units in dimension. Correct the units or use the unit function. Bad unit: \" + this.unit.toString());\n    }\n\n    var value = this.fround(context, this.value),\n        strValue = String(value);\n\n    if (value !== 0 && value < 0.000001 && value > -0.000001) {\n        // would be output 1e-6 etc.\n        strValue = value.toFixed(20).replace(/0+$/, \"\");\n    }\n\n    if (context && context.compress) {\n        // Zero values doesn't need a unit\n        if (value === 0 && this.unit.isLength()) {\n            output.add(strValue);\n            return;\n        }\n\n        // Float values doesn't need a leading zero\n        if (value > 0 && value < 1) {\n            strValue = (strValue).substr(1);\n        }\n    }\n\n    output.add(strValue);\n    this.unit.genCSS(context, output);\n};\n\n// In an operation between two Dimensions,\n// we default to the first Dimension's unit,\n// so `1px + 2` will yield `3px`.\nDimension.prototype.operate = function (context, op, other) {\n    /*jshint noempty:false */\n    var value = this._operate(context, op, this.value, other.value),\n        unit = this.unit.clone();\n\n    if (op === '+' || op === '-') {\n        if (unit.numerator.length === 0 && unit.denominator.length === 0) {\n            unit = other.unit.clone();\n            if (this.unit.backupUnit) {\n                unit.backupUnit = this.unit.backupUnit;\n            }\n        } else if (other.unit.numerator.length === 0 && unit.denominator.length === 0) {\n            // do nothing\n        } else {\n            other = other.convertTo(this.unit.usedUnits());\n\n            if (context.strictUnits && other.unit.toString() !== unit.toString()) {\n                throw new Error(\"Incompatible units. Change the units or use the unit function. Bad units: '\" + unit.toString() +\n                    \"' and '\" + other.unit.toString() + \"'.\");\n            }\n\n            value = this._operate(context, op, this.value, other.value);\n        }\n    } else if (op === '*') {\n        unit.numerator = unit.numerator.concat(other.unit.numerator).sort();\n        unit.denominator = unit.denominator.concat(other.unit.denominator).sort();\n        unit.cancel();\n    } else if (op === '/') {\n        unit.numerator = unit.numerator.concat(other.unit.denominator).sort();\n        unit.denominator = unit.denominator.concat(other.unit.numerator).sort();\n        unit.cancel();\n    }\n    return new Dimension(value, unit);\n};\nDimension.prototype.compare = function (other) {\n    var a, b;\n\n    if (!(other instanceof Dimension)) {\n        return undefined;\n    }\n\n    if (this.unit.isEmpty() || other.unit.isEmpty()) {\n        a = this;\n        b = other;\n    } else {\n        a = this.unify();\n        b = other.unify();\n        if (a.unit.compare(b.unit) !== 0) {\n            return undefined;\n        }\n    }\n\n    return Node.numericCompare(a.value, b.value);\n};\nDimension.prototype.unify = function () {\n    return this.convertTo({ length: 'px', duration: 's', angle: 'rad' });\n};\nDimension.prototype.convertTo = function (conversions) {\n    var value = this.value, unit = this.unit.clone(),\n        i, groupName, group, targetUnit, derivedConversions = {}, applyUnit;\n\n    if (typeof conversions === 'string') {\n        for (i in unitConversions) {\n            if (unitConversions[i].hasOwnProperty(conversions)) {\n                derivedConversions = {};\n                derivedConversions[i] = conversions;\n            }\n        }\n        conversions = derivedConversions;\n    }\n    applyUnit = function (atomicUnit, denominator) {\n        /* jshint loopfunc:true */\n        if (group.hasOwnProperty(atomicUnit)) {\n            if (denominator) {\n                value = value / (group[atomicUnit] / group[targetUnit]);\n            } else {\n                value = value * (group[atomicUnit] / group[targetUnit]);\n            }\n\n            return targetUnit;\n        }\n\n        return atomicUnit;\n    };\n\n    for (groupName in conversions) {\n        if (conversions.hasOwnProperty(groupName)) {\n            targetUnit = conversions[groupName];\n            group = unitConversions[groupName];\n\n            unit.map(applyUnit);\n        }\n    }\n\n    unit.cancel();\n\n    return new Dimension(value, unit);\n};\nmodule.exports = Dimension;\n"]}