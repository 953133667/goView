{"version":3,"sources":["media.js"],"names":[],"mappings":"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","file":"media-compiled.js","sourcesContent":["var Ruleset = require(\"./ruleset\"),\n    Value = require(\"./value\"),\n    Selector = require(\"./selector\"),\n    Anonymous = require(\"./anonymous\"),\n    Expression = require(\"./expression\"),\n    Directive = require(\"./directive\");\n\nvar Media = function (value, features, index, currentFileInfo, visibilityInfo) {\n    this.index = index;\n    this.currentFileInfo = currentFileInfo;\n\n    var selectors = (new Selector([], null, null, this.index, this.currentFileInfo)).createEmptySelectors();\n\n    this.features = new Value(features);\n    this.rules = [new Ruleset(selectors, value)];\n    this.rules[0].allowImports = true;\n    this.copyVisibilityInfo(visibilityInfo);\n    this.allowRoot = true;\n};\nMedia.prototype = new Directive();\nMedia.prototype.type = \"Media\";\nMedia.prototype.isRulesetLike = true;\nMedia.prototype.accept = function (visitor) {\n    if (this.features) {\n        this.features = visitor.visit(this.features);\n    }\n    if (this.rules) {\n        this.rules = visitor.visitArray(this.rules);\n    }\n};\nMedia.prototype.genCSS = function (context, output) {\n    output.add('@media ', this.currentFileInfo, this.index);\n    this.features.genCSS(context, output);\n    this.outputRuleset(context, output, this.rules);\n};\nMedia.prototype.eval = function (context) {\n    if (!context.mediaBlocks) {\n        context.mediaBlocks = [];\n        context.mediaPath = [];\n    }\n\n    var media = new Media(null, [], this.index, this.currentFileInfo, this.visibilityInfo());\n    if (this.debugInfo) {\n        this.rules[0].debugInfo = this.debugInfo;\n        media.debugInfo = this.debugInfo;\n    }\n    var strictMathBypass = false;\n    if (!context.strictMath) {\n        strictMathBypass = true;\n        context.strictMath = true;\n    }\n    try {\n        media.features = this.features.eval(context);\n    }\n    finally {\n        if (strictMathBypass) {\n            context.strictMath = false;\n        }\n    }\n\n    context.mediaPath.push(media);\n    context.mediaBlocks.push(media);\n\n    this.rules[0].functionRegistry = context.frames[0].functionRegistry.inherit();\n    context.frames.unshift(this.rules[0]);\n    media.rules = [this.rules[0].eval(context)];\n    context.frames.shift();\n\n    context.mediaPath.pop();\n\n    return context.mediaPath.length === 0 ? media.evalTop(context) :\n                media.evalNested(context);\n};\nMedia.prototype.evalTop = function (context) {\n    var result = this;\n\n    // Render all dependent Media blocks.\n    if (context.mediaBlocks.length > 1) {\n        var selectors = (new Selector([], null, null, this.index, this.currentFileInfo)).createEmptySelectors();\n        result = new Ruleset(selectors, context.mediaBlocks);\n        result.multiMedia = true;\n        result.copyVisibilityInfo(this.visibilityInfo());\n    }\n\n    delete context.mediaBlocks;\n    delete context.mediaPath;\n\n    return result;\n};\nMedia.prototype.evalNested = function (context) {\n    var i, value,\n        path = context.mediaPath.concat([this]);\n\n    // Extract the media-query conditions separated with `,` (OR).\n    for (i = 0; i < path.length; i++) {\n        value = path[i].features instanceof Value ?\n                    path[i].features.value : path[i].features;\n        path[i] = Array.isArray(value) ? value : [value];\n    }\n\n    // Trace all permutations to generate the resulting media-query.\n    //\n    // (a, b and c) with nested (d, e) ->\n    //    a and d\n    //    a and e\n    //    b and c and d\n    //    b and c and e\n    this.features = new Value(this.permute(path).map(function (path) {\n        path = path.map(function (fragment) {\n            return fragment.toCSS ? fragment : new Anonymous(fragment);\n        });\n\n        for (i = path.length - 1; i > 0; i--) {\n            path.splice(i, 0, new Anonymous(\"and\"));\n        }\n\n        return new Expression(path);\n    }));\n\n    // Fake a tree-node that doesn't output anything.\n    return new Ruleset([], []);\n};\nMedia.prototype.permute = function (arr) {\n    if (arr.length === 0) {\n        return [];\n    } else if (arr.length === 1) {\n        return arr[0];\n    } else {\n        var result = [];\n        var rest = this.permute(arr.slice(1));\n        for (var i = 0; i < rest.length; i++) {\n            for (var j = 0; j < arr[0].length; j++) {\n                result.push([arr[0][j]].concat(rest[i]));\n            }\n        }\n        return result;\n    }\n};\nMedia.prototype.bubbleSelectors = function (selectors) {\n    if (!selectors) {\n        return;\n    }\n    this.rules = [new Ruleset(selectors.slice(0), [this.rules[0]])];\n};\nmodule.exports = Media;\n"]}