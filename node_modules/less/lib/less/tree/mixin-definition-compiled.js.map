{"version":3,"sources":["mixin-definition.js"],"names":[],"mappings":"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","file":"mixin-definition-compiled.js","sourcesContent":["var Selector = require(\"./selector\"),\n    Element = require(\"./element\"),\n    Ruleset = require(\"./ruleset\"),\n    Rule = require(\"./rule\"),\n    Expression = require(\"./expression\"),\n    contexts = require(\"../contexts\");\n\nvar Definition = function (name, params, rules, condition, variadic, frames, visibilityInfo) {\n    this.name = name;\n    this.selectors = [new Selector([new Element(null, name, this.index, this.currentFileInfo)])];\n    this.params = params;\n    this.condition = condition;\n    this.variadic = variadic;\n    this.arity = params.length;\n    this.rules = rules;\n    this._lookups = {};\n    var optionalParameters = [];\n    this.required = params.reduce(function (count, p) {\n        if (!p.name || (p.name && !p.value)) {\n            return count + 1;\n        }\n        else {\n            optionalParameters.push(p.name);\n            return count;\n        }\n    }, 0);\n    this.optionalParameters = optionalParameters;\n    this.frames = frames;\n    this.copyVisibilityInfo(visibilityInfo);\n    this.allowRoot = true;\n};\nDefinition.prototype = new Ruleset();\nDefinition.prototype.type = \"MixinDefinition\";\nDefinition.prototype.evalFirst = true;\nDefinition.prototype.accept = function (visitor) {\n    if (this.params && this.params.length) {\n        this.params = visitor.visitArray(this.params);\n    }\n    this.rules = visitor.visitArray(this.rules);\n    if (this.condition) {\n        this.condition = visitor.visit(this.condition);\n    }\n};\nDefinition.prototype.evalParams = function (context, mixinEnv, args, evaldArguments) {\n    /*jshint boss:true */\n    var frame = new Ruleset(null, null),\n        varargs, arg,\n        params = this.params.slice(0),\n        i, j, val, name, isNamedFound, argIndex, argsLength = 0;\n\n    if (mixinEnv.frames && mixinEnv.frames[0] && mixinEnv.frames[0].functionRegistry) {\n        frame.functionRegistry = mixinEnv.frames[0].functionRegistry.inherit();\n    }\n    mixinEnv = new contexts.Eval(mixinEnv, [frame].concat(mixinEnv.frames));\n\n    if (args) {\n        args = args.slice(0);\n        argsLength = args.length;\n\n        for (i = 0; i < argsLength; i++) {\n            arg = args[i];\n            if (name = (arg && arg.name)) {\n                isNamedFound = false;\n                for (j = 0; j < params.length; j++) {\n                    if (!evaldArguments[j] && name === params[j].name) {\n                        evaldArguments[j] = arg.value.eval(context);\n                        frame.prependRule(new Rule(name, arg.value.eval(context)));\n                        isNamedFound = true;\n                        break;\n                    }\n                }\n                if (isNamedFound) {\n                    args.splice(i, 1);\n                    i--;\n                    continue;\n                } else {\n                    throw { type: 'Runtime', message: \"Named argument for \" + this.name +\n                        ' ' + args[i].name + ' not found' };\n                }\n            }\n        }\n    }\n    argIndex = 0;\n    for (i = 0; i < params.length; i++) {\n        if (evaldArguments[i]) { continue; }\n\n        arg = args && args[argIndex];\n\n        if (name = params[i].name) {\n            if (params[i].variadic) {\n                varargs = [];\n                for (j = argIndex; j < argsLength; j++) {\n                    varargs.push(args[j].value.eval(context));\n                }\n                frame.prependRule(new Rule(name, new Expression(varargs).eval(context)));\n            } else {\n                val = arg && arg.value;\n                if (val) {\n                    val = val.eval(context);\n                } else if (params[i].value) {\n                    val = params[i].value.eval(mixinEnv);\n                    frame.resetCache();\n                } else {\n                    throw { type: 'Runtime', message: \"wrong number of arguments for \" + this.name +\n                        ' (' + argsLength + ' for ' + this.arity + ')' };\n                }\n\n                frame.prependRule(new Rule(name, val));\n                evaldArguments[i] = val;\n            }\n        }\n\n        if (params[i].variadic && args) {\n            for (j = argIndex; j < argsLength; j++) {\n                evaldArguments[j] = args[j].value.eval(context);\n            }\n        }\n        argIndex++;\n    }\n\n    return frame;\n};\nDefinition.prototype.makeImportant = function() {\n    var rules = !this.rules ? this.rules : this.rules.map(function (r) {\n        if (r.makeImportant) {\n            return r.makeImportant(true);\n        } else {\n            return r;\n        }\n    });\n    var result = new Definition(this.name, this.params, rules, this.condition, this.variadic, this.frames);\n    return result;\n};\nDefinition.prototype.eval = function (context) {\n    return new Definition(this.name, this.params, this.rules, this.condition, this.variadic, this.frames || context.frames.slice(0));\n};\nDefinition.prototype.evalCall = function (context, args, important) {\n    var _arguments = [],\n        mixinFrames = this.frames ? this.frames.concat(context.frames) : context.frames,\n        frame = this.evalParams(context, new contexts.Eval(context, mixinFrames), args, _arguments),\n        rules, ruleset;\n\n    frame.prependRule(new Rule('@arguments', new Expression(_arguments).eval(context)));\n\n    rules = this.rules.slice(0);\n\n    ruleset = new Ruleset(null, rules);\n    ruleset.originalRuleset = this;\n    ruleset = ruleset.eval(new contexts.Eval(context, [this, frame].concat(mixinFrames)));\n    if (important) {\n        ruleset = ruleset.makeImportant();\n    }\n    return ruleset;\n};\nDefinition.prototype.matchCondition = function (args, context) {\n    if (this.condition && !this.condition.eval(\n        new contexts.Eval(context,\n            [this.evalParams(context, /* the parameter variables*/\n                new contexts.Eval(context, this.frames ? this.frames.concat(context.frames) : context.frames), args, [])]\n            .concat(this.frames || []) // the parent namespace/mixin frames\n            .concat(context.frames)))) { // the current environment frames\n        return false;\n    }\n    return true;\n};\nDefinition.prototype.matchArgs = function (args, context) {\n    var allArgsCnt = (args && args.length) || 0, len, optionalParameters = this.optionalParameters;\n    var requiredArgsCnt = !args ? 0 : args.reduce(function (count, p) {\n        if (optionalParameters.indexOf(p.name) < 0) {\n            return count + 1;\n        } else {\n            return count;\n        }\n    }, 0);\n\n    if (! this.variadic) {\n        if (requiredArgsCnt < this.required) {\n            return false;\n        }\n        if (allArgsCnt > this.params.length) {\n            return false;\n        }\n    } else {\n        if (requiredArgsCnt < (this.required - 1)) {\n            return false;\n        }\n    }\n\n    // check patterns\n    len = Math.min(requiredArgsCnt, this.arity);\n\n    for (var i = 0; i < len; i++) {\n        if (!this.params[i].name && !this.params[i].variadic) {\n            if (args[i].value.eval(context).toCSS() != this.params[i].value.eval(context).toCSS()) {\n                return false;\n            }\n        }\n    }\n    return true;\n};\nmodule.exports = Definition;\n"]}