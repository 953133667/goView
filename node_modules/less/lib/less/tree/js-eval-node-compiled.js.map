{"version":3,"sources":["js-eval-node.js"],"names":[],"mappings":"AAAA,IAAI,OAAO,QAAQ,QAAR,CAAX;AAAA,IACI,WAAW,QAAQ,YAAR,CADf;;AAGA,IAAI,aAAa,YAAW,CAC3B,CADD;AAEA,WAAW,SAAX,GAAuB,IAAI,IAAJ,EAAvB;;AAEA,WAAW,SAAX,CAAqB,kBAArB,GAA0C,UAAU,UAAV,EAAsB,OAAtB,EAA+B;AACrE,QAAI,MAAJ;AAAA,QACI,OAAO,IADX;AAAA,QAEI,cAAc,EAFlB;;AAIA,QAAI,QAAQ,iBAAR,KAA8B,SAA9B,IAA2C,CAAC,QAAQ,iBAAxD,EAA2E;AACvE,cAAM,EAAE,SAAS,oDAAX;AACF,sBAAU,KAAK,eAAL,CAAqB,QAD7B;AAEF,mBAAO,KAAK,KAFV,EAAN;AAGH;;AAED,iBAAa,WAAW,OAAX,CAAmB,gBAAnB,EAAqC,UAAU,CAAV,EAAa,IAAb,EAAmB;AACjE,eAAO,KAAK,KAAL,CAAW,IAAI,QAAJ,CAAa,MAAM,IAAnB,EAAyB,KAAK,KAA9B,EAAqC,KAAK,eAA1C,EAA2D,IAA3D,CAAgE,OAAhE,CAAX,CAAP;AACH,KAFY,CAAb;;AAIA,QAAI;AACA,qBAAa,IAAI,QAAJ,CAAa,aAAa,UAAb,GAA0B,GAAvC,CAAb;AACH,KAFD,CAEE,OAAO,CAAP,EAAU;AACR,cAAM,EAAE,SAAS,kCAAkC,EAAE,OAApC,GAA8C,SAA9C,GAA0D,UAA1D,GAAuE,GAAlF;AACF,sBAAU,KAAK,eAAL,CAAqB,QAD7B;AAEF,mBAAO,KAAK,KAFV,EAAN;AAGH;;AAED,QAAI,YAAY,QAAQ,MAAR,CAAe,CAAf,EAAkB,SAAlB,EAAhB;AACA,SAAK,IAAI,CAAT,IAAc,SAAd,EAAyB;AACrB,YAAI,UAAU,cAAV,CAAyB,CAAzB,CAAJ,EAAiC;AAC7B;AACA,wBAAY,EAAE,KAAF,CAAQ,CAAR,CAAZ,IAA0B;AACtB,uBAAO,UAAU,CAAV,EAAa,KADE;AAEtB,sBAAM,YAAY;AACd,2BAAO,KAAK,KAAL,CAAW,IAAX,CAAgB,OAAhB,EAAyB,KAAzB,EAAP;AACH;AAJqB,aAA1B;AAMH;AACJ;;AAED,QAAI;AACA,iBAAS,WAAW,IAAX,CAAgB,WAAhB,CAAT;AACH,KAFD,CAEE,OAAO,CAAP,EAAU;AACR,cAAM,EAAE,SAAS,mCAAmC,EAAE,IAArC,GAA4C,IAA5C,GAAmD,EAAE,OAAF,CAAU,OAAV,CAAkB,MAAlB,EAA0B,GAA1B,CAAnD,GAAoF,GAA/F;AACF,sBAAU,KAAK,eAAL,CAAqB,QAD7B;AAEF,mBAAO,KAAK,KAFV,EAAN;AAGH;AACD,WAAO,MAAP;AACH,CA5CD;AA6CA,WAAW,SAAX,CAAqB,KAArB,GAA6B,UAAU,GAAV,EAAe;AACxC,QAAI,MAAM,OAAN,CAAc,IAAI,KAAlB,KAA6B,IAAI,KAAJ,CAAU,MAAV,GAAmB,CAApD,EAAwD;AACpD,eAAO,MAAM,IAAI,KAAJ,CAAU,GAAV,CAAc,UAAU,CAAV,EAAa;AAAE,mBAAO,EAAE,KAAF,EAAP;AAAmB,SAAhD,EAAkD,IAAlD,CAAuD,IAAvD,CAAN,GAAqE,GAA5E;AACH,KAFD,MAEO;AACH,eAAO,IAAI,KAAJ,EAAP;AACH;AACJ,CAND;;AAQA,OAAO,OAAP,GAAiB,UAAjB","file":"js-eval-node-compiled.js","sourcesContent":["var Node = require(\"./node\"),\n    Variable = require(\"./variable\");\n\nvar JsEvalNode = function() {\n};\nJsEvalNode.prototype = new Node();\n\nJsEvalNode.prototype.evaluateJavaScript = function (expression, context) {\n    var result,\n        that = this,\n        evalContext = {};\n\n    if (context.javascriptEnabled !== undefined && !context.javascriptEnabled) {\n        throw { message: \"You are using JavaScript, which has been disabled.\",\n            filename: this.currentFileInfo.filename,\n            index: this.index };\n    }\n\n    expression = expression.replace(/@\\{([\\w-]+)\\}/g, function (_, name) {\n        return that.jsify(new Variable('@' + name, that.index, that.currentFileInfo).eval(context));\n    });\n\n    try {\n        expression = new Function('return (' + expression + ')');\n    } catch (e) {\n        throw { message: \"JavaScript evaluation error: \" + e.message + \" from `\" + expression + \"`\" ,\n            filename: this.currentFileInfo.filename,\n            index: this.index };\n    }\n\n    var variables = context.frames[0].variables();\n    for (var k in variables) {\n        if (variables.hasOwnProperty(k)) {\n            /*jshint loopfunc:true */\n            evalContext[k.slice(1)] = {\n                value: variables[k].value,\n                toJS: function () {\n                    return this.value.eval(context).toCSS();\n                }\n            };\n        }\n    }\n\n    try {\n        result = expression.call(evalContext);\n    } catch (e) {\n        throw { message: \"JavaScript evaluation error: '\" + e.name + ': ' + e.message.replace(/[\"]/g, \"'\") + \"'\" ,\n            filename: this.currentFileInfo.filename,\n            index: this.index };\n    }\n    return result;\n};\nJsEvalNode.prototype.jsify = function (obj) {\n    if (Array.isArray(obj.value) && (obj.value.length > 1)) {\n        return '[' + obj.value.map(function (v) { return v.toCSS(); }).join(', ') + ']';\n    } else {\n        return obj.toCSS();\n    }\n};\n\nmodule.exports = JsEvalNode;\n"]}