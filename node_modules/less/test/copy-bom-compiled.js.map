{"version":3,"sources":["copy-bom.js"],"names":[],"mappings":"AAAA;;AAEA;AACA;;AAEA,OAAO,OAAP,GAAiB,YAAW;AACxB,QAAI,OAAO,QAAQ,MAAR,CAAX;AAAA,QACI,KAAK,QAAQ,IAAR,CADT;;AAGA,QAAI,aAAa,KAAK,IAAtB;AACA,QAAI,QAAQ,IAAI,MAAJ,CAAW,UAAX,CAAZ;;AAEA,aAAS,iBAAT,CAA2B,GAA3B,EAAgC,IAAhC,EAAsC;AAClC,YAAI,QAAQ,GAAG,SAAH,CAAa,GAAb,CAAZ;AACA,YAAI,aAAa,KAAK,OAAL,CAAa,IAAb,CAAjB;AACA,YAAI,mBAAmB,GAAG,UAAH,CAAc,UAAd,CAAvB;AACA,YAAI,cAAc,KAAlB;;AAEA,YAAI,MAAM,MAAN,EAAJ,EAAoB;AAChB,gBAAI,CAAC,gBAAL,EAAuB;AACnB,mBAAG,SAAH,CAAa,UAAb;AACH;AACD,gBAAI,IAAI,KAAJ,CAAU,eAAV,CAAJ,EAAgC;AAC5B,sCAAsB,GAAtB,EAA2B,IAA3B;AACH,aAFD,MAEO;AACH,6BAAa,GAAb,EAAkB,IAAlB;AACH;AACJ,SATD,MAUK,IAAI,MAAM,WAAN,EAAJ,EAAyB;AAC1B,gBAAI,CAAC,GAAG,UAAH,CAAc,UAAd,CAAL,EAAgC;AAC5B,mBAAG,SAAH,CAAa,UAAb;AACH;AACD,gBAAI,CAAC,GAAG,UAAH,CAAc,IAAd,CAAL,EAA0B;AACtB,mBAAG,SAAH,CAAa,IAAb;AACH;AACD,eAAG,WAAH,CAAe,GAAf,EAAoB,OAApB,CAA4B,UAAS,CAAT,EAAY;AACpC,oBAAI,MAAM,KAAV,EAAiB;AACb,sCAAkB,KAAK,IAAL,CAAU,GAAV,EAAe,CAAf,CAAlB,EAAqC,KAAK,IAAL,CAAU,IAAV,EAAgB,CAAhB,CAArC;AACH;AACJ,aAJD;AAKH;AACJ;;AAED,aAAS,qBAAT,CAA+B,OAA/B,EAAwC,QAAxC,EAAkD;AAC9C,YAAI,WAAW,GAAG,YAAH,CAAgB,OAAhB,EAAyB,EAAE,UAAU,MAAZ,EAAzB,CAAf;AACA,YAAI,CAAC,SAAS,MAAV,IAAoB,SAAS,UAAT,CAAoB,CAApB,MAA2B,MAAnD,EAA2D;AACvD,uBAAW,WAAW,QAAtB;AACH;AACD,WAAG,aAAH,CAAiB,QAAjB,EAA2B,QAA3B,EAAqC,EAAE,UAAU,MAAZ,EAArC;AACH;;AAED,aAAS,YAAT,CAAsB,OAAtB,EAA+B,QAA/B,EAAyC;AACrC,YAAI,MAAM,GAAG,QAAH,CAAY,OAAZ,EAAqB,GAArB,CAAV;AACA,YAAI,OAAO,GAAG,SAAH,CAAa,GAAb,CAAX;AACA,YAAI,MAAM,GAAG,QAAH,CAAY,QAAZ,EAAsB,GAAtB,EAA2B,KAAK,IAAhC,CAAV;AACA,YAAI,YAAY,CAAhB;AACA,YAAI,MAAM,CAAV;;AAEA,eAAO,YAAY,CAAnB,EAAsB;AAClB,wBAAY,GAAG,QAAH,CAAY,GAAZ,EAAiB,KAAjB,EAAwB,CAAxB,EAA2B,UAA3B,EAAuC,GAAvC,CAAZ;AACA,eAAG,SAAH,CAAa,GAAb,EAAkB,KAAlB,EAAyB,CAAzB,EAA4B,SAA5B;AACA,mBAAO,SAAP;AACH;;AAED,WAAG,SAAH,CAAa,GAAb;AACA,WAAG,SAAH,CAAa,GAAb;AACH;;AAED,WAAO;AACH,2BAAmB;AADhB,KAAP;AAGH,CAlED","file":"copy-bom-compiled.js","sourcesContent":["/*jshint latedef: nofunc */\n\n// This is used to copy a folder (the test/less/* files & sub-folders), adding a BOM to the start of each LESS and CSS file.\n// This is a based on the copySync method from fs-extra (https://github.com/jprichardson/node-fs-extra/).\n\nmodule.exports = function() {\n    var path = require('path'),\n        fs = require('fs');\n\n    var BUF_LENGTH = 64 * 1024;\n    var _buff = new Buffer(BUF_LENGTH);\n\n    function copyFolderWithBom(src, dest) {\n        var stats = fs.lstatSync(src);\n        var destFolder = path.dirname(dest);\n        var destFolderExists = fs.existsSync(destFolder);\n        var performCopy = false;\n\n        if (stats.isFile()) {\n            if (!destFolderExists) {\n                fs.mkdirSync(destFolder);\n            }\n            if (src.match(/\\.(css|less)$/)) {\n                copyFileAddingBomSync(src, dest);\n            } else {\n                copyFileSync(src, dest);\n            }\n        }\n        else if (stats.isDirectory()) {\n            if (!fs.existsSync(destFolder)) {\n                fs.mkdirSync(destFolder);\n            }\n            if (!fs.existsSync(dest)) {\n                fs.mkdirSync(dest);\n            }\n            fs.readdirSync(src).forEach(function(d) {\n                if (d !== 'bom') {\n                    copyFolderWithBom(path.join(src, d), path.join(dest, d));\n                }\n            });\n        }\n    }\n\n    function copyFileAddingBomSync(srcFile, destFile) {\n        var contents = fs.readFileSync(srcFile, { encoding: 'utf8' });\n        if (!contents.length || contents.charCodeAt(0) !== 0xFEFF) {\n            contents = '\\ufeff' + contents;\n        }\n        fs.writeFileSync(destFile, contents, { encoding: 'utf8' });\n    }\n\n    function copyFileSync(srcFile, destFile) {\n        var fdr = fs.openSync(srcFile, 'r');\n        var stat = fs.fstatSync(fdr);\n        var fdw = fs.openSync(destFile, 'w', stat.mode);\n        var bytesRead = 1;\n        var pos = 0;\n\n        while (bytesRead > 0) {\n            bytesRead = fs.readSync(fdr, _buff, 0, BUF_LENGTH, pos)\n            fs.writeSync(fdw, _buff, 0, bytesRead);\n            pos += bytesRead;\n        }\n\n        fs.closeSync(fdr);\n        fs.closeSync(fdw);\n    }\n\n    return {\n        copyFolderWithBom: copyFolderWithBom\n    };\n};\n"]}