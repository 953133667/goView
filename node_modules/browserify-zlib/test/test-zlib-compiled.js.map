{"version":3,"sources":["test-zlib.js"],"names":[],"mappings":"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","file":"test-zlib-compiled.js","sourcesContent":["// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar assert = require('assert');\nvar zlib = require('../');\nvar path = require('path');\n\nvar zlibPairs =\n    [[zlib.Deflate, zlib.Inflate],\n     [zlib.Gzip, zlib.Gunzip],\n     [zlib.Deflate, zlib.Unzip],\n     [zlib.Gzip, zlib.Unzip],\n     [zlib.DeflateRaw, zlib.InflateRaw]];\n\n// how fast to trickle through the slowstream\nvar trickle = [128, 1024, 1024 * 1024];\n\n// tunable options for zlib classes.\n\n// several different chunk sizes\nvar chunkSize = [128, 1024, 1024 * 16, 1024 * 1024];\n\n// this is every possible value.\nvar level = [-1, 0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\nvar windowBits = [8, 9, 10, 11, 12, 13, 14, 15];\nvar memLevel = [1, 2, 3, 4, 5, 6, 7, 8, 9];\nvar strategy = [0, 1, 2, 3, 4];\n\n// it's nice in theory to test every combination, but it\n// takes WAY too long.  Maybe a pummel test could do this?\nif (!process.env.PUMMEL) {\n  trickle = [1024];\n  chunkSize = [1024 * 16];\n  level = [6];\n  memLevel = [8];\n  windowBits = [15];\n  strategy = [0];\n}\n\nvar fs = require('fs');\n\nif (process.env.FAST) {\n  zlibPairs = [[zlib.Gzip, zlib.Unzip]];\n}\n\nvar tests = {\n  'person.jpg': fs.readFileSync(__dirname + '/fixtures/person.jpg'),\n  'elipses.txt': fs.readFileSync(__dirname + '/fixtures/elipses.txt'),\n  'empty.txt': fs.readFileSync(__dirname + '/fixtures/empty.txt')\n};\n\nvar util = require('util');\nvar stream = require('stream');\n\n\n// stream that saves everything\nfunction BufferStream() {\n  this.chunks = [];\n  this.length = 0;\n  this.writable = true;\n  this.readable = true;\n}\n\nutil.inherits(BufferStream, stream.Stream);\n\nBufferStream.prototype.write = function(c) {\n  this.chunks.push(c);\n  this.length += c.length;\n  return true;\n};\n\nBufferStream.prototype.end = function(c) {\n  if (c) this.write(c);\n  // flatten\n  var buf = new Buffer(this.length);\n  var i = 0;\n  this.chunks.forEach(function(c) {\n    c.copy(buf, i);\n    i += c.length;\n  });\n  this.emit('data', buf);\n  this.emit('end');\n  return true;\n};\n\n\nfunction SlowStream(trickle) {\n  this.trickle = trickle;\n  this.offset = 0;\n  this.readable = this.writable = true;\n}\n\nutil.inherits(SlowStream, stream.Stream);\n\nSlowStream.prototype.write = function() {\n  throw new Error('not implemented, just call ss.end(chunk)');\n};\n\nSlowStream.prototype.pause = function() {\n  this.paused = true;\n  this.emit('pause');\n};\n\nSlowStream.prototype.resume = function() {\n  var self = this;\n  if (self.ended) return;\n  self.emit('resume');\n  if (!self.chunk) return;\n  self.paused = false;\n  emit();\n  function emit() {\n    if (self.paused) return;\n    if (self.offset >= self.length) {\n      self.ended = true;\n      return self.emit('end');\n    }\n    var end = Math.min(self.offset + self.trickle, self.length);\n    var c = self.chunk.slice(self.offset, end);\n    self.offset += c.length;\n    self.emit('data', c);\n    process.nextTick(emit);\n  }\n};\n\nSlowStream.prototype.end = function(chunk) {\n  // walk over the chunk in blocks.\n  var self = this;\n  self.chunk = chunk;\n  self.length = chunk.length;\n  self.resume();\n  return self.ended;\n};\n\n\n\n// for each of the files, make sure that compressing and\n// decompressing results in the same data, for every combination\n// of the options set above.\nvar tape = require('tape');\n\nObject.keys(tests).forEach(function(file) {\n  var test = tests[file];\n  chunkSize.forEach(function(chunkSize) {\n    trickle.forEach(function(trickle) {\n      windowBits.forEach(function(windowBits) {\n        level.forEach(function(level) {\n          memLevel.forEach(function(memLevel) {\n            strategy.forEach(function(strategy) {\n              zlibPairs.forEach(function(pair) {\n                var Def = pair[0];\n                var Inf = pair[1];\n                var opts = { \n                  level: level,\n                  windowBits: windowBits,\n                  memLevel: memLevel,\n                  strategy: strategy\n                };\n                \n                var msg = file + ' ' +\n                    chunkSize + ' ' +\n                    JSON.stringify(opts) + ' ' +\n                    Def.name + ' -> ' + Inf.name;\n                \n                tape('zlib ' + msg, function(t) {\n                  t.plan(1);\n                  \n                  var def = new Def(opts);\n                  var inf = new Inf(opts);\n                  var ss = new SlowStream(trickle);\n                  var buf = new BufferStream();\n\n                  // verify that the same exact buffer comes out the other end.\n                  buf.on('data', function(c) {\n                    t.deepEqual(c, test);\n                  });\n\n                  // the magic happens here.\n                  ss.pipe(def).pipe(inf).pipe(buf);\n                  ss.end(test);\n                });\n              });\n            });\n          });\n        });\n      });\n    }); \n  });\n});\n"]}