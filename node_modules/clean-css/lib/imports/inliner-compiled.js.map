{"version":3,"sources":["inliner.js"],"names":[],"mappings":"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","file":"inliner-compiled.js","sourcesContent":["var fs = require('fs');\nvar path = require('path');\nvar http = require('http');\nvar https = require('https');\nvar url = require('url');\n\nvar rewriteUrls = require('../urls/rewrite');\nvar split = require('../utils/split');\nvar override = require('../utils/object.js').override;\n\nvar MAP_MARKER = /\\/\\*# sourceMappingURL=(\\S+) \\*\\//;\nvar REMOTE_RESOURCE = /^(https?:)?\\/\\//;\nvar NO_PROTOCOL_RESOURCE = /^\\/\\//;\n\nfunction ImportInliner (context) {\n  this.outerContext = context;\n}\n\nImportInliner.prototype.process = function (data, context) {\n  var root = this.outerContext.options.root;\n\n  context = override(context, {\n    baseRelativeTo: this.outerContext.options.relativeTo || root,\n    debug: this.outerContext.options.debug,\n    done: [],\n    errors: this.outerContext.errors,\n    left: [],\n    inliner: this.outerContext.options.inliner,\n    rebase: this.outerContext.options.rebase,\n    relativeTo: this.outerContext.options.relativeTo || root,\n    root: root,\n    sourceReader: this.outerContext.sourceReader,\n    sourceTracker: this.outerContext.sourceTracker,\n    warnings: this.outerContext.warnings,\n    visited: []\n  });\n\n  return importFrom(data, context);\n};\n\nfunction importFrom(data, context) {\n  if (context.shallow) {\n    context.shallow = false;\n    context.done.push(data);\n    return processNext(context);\n  }\n\n  var nextStart = 0;\n  var nextEnd = 0;\n  var cursor = 0;\n  var isComment = commentScanner(data);\n\n  for (; nextEnd < data.length;) {\n    nextStart = nextImportAt(data, cursor);\n    if (nextStart == -1)\n      break;\n\n    if (isComment(nextStart)) {\n      cursor = nextStart + 1;\n      continue;\n    }\n\n    nextEnd = data.indexOf(';', nextStart);\n    if (nextEnd == -1) {\n      cursor = data.length;\n      data = '';\n      break;\n    }\n\n    var noImportPart = data.substring(0, nextStart);\n    context.done.push(noImportPart);\n    context.left.unshift([data.substring(nextEnd + 1), context]);\n    context.afterContent = hasContent(noImportPart);\n    return inline(data, nextStart, nextEnd, context);\n  }\n\n  // no @import matched in current data\n  context.done.push(data);\n  return processNext(context);\n}\n\nfunction rebaseMap(data, source) {\n  return data.replace(MAP_MARKER, function (match, sourceMapUrl) {\n    return REMOTE_RESOURCE.test(sourceMapUrl) ?\n      match :\n      match.replace(sourceMapUrl, url.resolve(source, sourceMapUrl));\n  });\n}\n\nfunction nextImportAt(data, cursor) {\n  var nextLowerCase = data.indexOf('@import', cursor);\n  var nextUpperCase = data.indexOf('@IMPORT', cursor);\n\n  if (nextLowerCase > -1 && nextUpperCase == -1)\n    return nextLowerCase;\n  else if (nextLowerCase == -1 && nextUpperCase > -1)\n    return nextUpperCase;\n  else\n    return Math.min(nextLowerCase, nextUpperCase);\n}\n\nfunction processNext(context) {\n  return context.left.length > 0 ?\n    importFrom.apply(null, context.left.shift()) :\n    context.whenDone(context.done.join(''));\n}\n\nfunction commentScanner(data) {\n  var commentRegex = /(\\/\\*(?!\\*\\/)[\\s\\S]*?\\*\\/)/;\n  var lastStartIndex = 0;\n  var lastEndIndex = 0;\n  var noComments = false;\n\n  // test whether an index is located within a comment\n  return function scanner(idx) {\n    var comment;\n    var localStartIndex = 0;\n    var localEndIndex = 0;\n    var globalStartIndex = 0;\n    var globalEndIndex = 0;\n\n    // return if we know there are no more comments\n    if (noComments)\n      return false;\n\n    do {\n      // idx can be still within last matched comment (many @import statements inside one comment)\n      if (idx > lastStartIndex && idx < lastEndIndex)\n        return true;\n\n      comment = data.match(commentRegex);\n\n      if (!comment) {\n        noComments = true;\n        return false;\n      }\n\n      // get the indexes relative to the current data chunk\n      lastStartIndex = localStartIndex = comment.index;\n      localEndIndex = localStartIndex + comment[0].length;\n\n      // calculate the indexes relative to the full original data\n      globalEndIndex = localEndIndex + lastEndIndex;\n      globalStartIndex = globalEndIndex - comment[0].length;\n\n      // chop off data up to and including current comment block\n      data = data.substring(localEndIndex);\n      lastEndIndex = globalEndIndex;\n    } while (globalEndIndex < idx);\n\n    return globalEndIndex > idx && idx > globalStartIndex;\n  };\n}\n\nfunction hasContent(data) {\n  var isComment = commentScanner(data);\n  var firstContentIdx = -1;\n  while (true) {\n    firstContentIdx = data.indexOf('{', firstContentIdx + 1);\n    if (firstContentIdx == -1 || !isComment(firstContentIdx))\n      break;\n  }\n\n  return firstContentIdx > -1;\n}\n\nfunction inline(data, nextStart, nextEnd, context) {\n  context.shallow = data.indexOf('@shallow') > 0;\n\n  var importDeclaration = data\n    .substring(nextImportAt(data, nextStart) + '@import'.length + 1, nextEnd)\n    .replace(/@shallow\\)$/, ')')\n    .trim();\n\n  var viaUrl = importDeclaration.indexOf('url(') === 0;\n  var urlStartsAt = viaUrl ? 4 : 0;\n  var isQuoted = /^['\"]/.exec(importDeclaration.substring(urlStartsAt, urlStartsAt + 2));\n  var urlEndsAt = isQuoted ?\n    importDeclaration.indexOf(isQuoted[0], urlStartsAt + 1) :\n    split(importDeclaration, ' ')[0].length - (viaUrl ? 1 : 0);\n\n  var importedFile = importDeclaration\n    .substring(urlStartsAt, urlEndsAt)\n    .replace(/['\"]/g, '')\n    .replace(/\\)$/, '')\n    .trim();\n\n  var mediaQuery = importDeclaration\n    .substring(urlEndsAt + 1)\n    .replace(/^\\)/, '')\n    .trim();\n\n  var isRemote = context.isRemote || REMOTE_RESOURCE.test(importedFile);\n\n  if (isRemote && (context.localOnly || !allowedResource(importedFile, true, context.imports))) {\n    if (context.afterContent || hasContent(context.done.join('')))\n      context.warnings.push('Ignoring remote @import of \"' + importedFile + '\" as no callback given.');\n    else\n      restoreImport(importedFile, mediaQuery, context);\n\n    return processNext(context);\n  }\n\n  if (!isRemote && !allowedResource(importedFile, false, context.imports)) {\n    if (context.afterImport)\n      context.warnings.push('Ignoring local @import of \"' + importedFile + '\" as after other inlined content.');\n    else\n      restoreImport(importedFile, mediaQuery, context);\n    return processNext(context);\n  }\n\n  if (!isRemote && context.afterContent) {\n    context.warnings.push('Ignoring local @import of \"' + importedFile + '\" as after other CSS content.');\n    return processNext(context);\n  }\n\n  var method = isRemote ? inlineRemoteResource : inlineLocalResource;\n  return method(importedFile, mediaQuery, context);\n}\n\nfunction allowedResource(importedFile, isRemote, rules) {\n  if (rules.length === 0)\n    return false;\n\n  if (isRemote && NO_PROTOCOL_RESOURCE.test(importedFile))\n    importedFile = 'http:' + importedFile;\n\n  var match = isRemote ?\n    url.parse(importedFile).host :\n    importedFile;\n  var allowed = true;\n\n  for (var i = 0; i < rules.length; i++) {\n    var rule = rules[i];\n\n    if (rule == 'all')\n      allowed = true;\n    else if (isRemote && rule == 'local')\n      allowed = false;\n    else if (isRemote && rule == 'remote')\n      allowed = true;\n    else if (!isRemote && rule == 'remote')\n      allowed = false;\n    else if (!isRemote && rule == 'local')\n      allowed = true;\n    else if (rule[0] == '!' && rule.substring(1) === match)\n      allowed = false;\n  }\n\n  return allowed;\n}\n\nfunction inlineRemoteResource(importedFile, mediaQuery, context) {\n  var importedUrl = REMOTE_RESOURCE.test(importedFile) ?\n    importedFile :\n    url.resolve(context.relativeTo, importedFile);\n  var originalUrl = importedUrl;\n\n  if (NO_PROTOCOL_RESOURCE.test(importedUrl))\n    importedUrl = 'http:' + importedUrl;\n\n  if (context.visited.indexOf(importedUrl) > -1)\n    return processNext(context);\n\n\n  if (context.debug)\n    console.error('Inlining remote stylesheet: ' + importedUrl);\n\n  context.visited.push(importedUrl);\n\n  var proxyProtocol = context.inliner.request.protocol || context.inliner.request.hostname;\n  var get =\n    ((proxyProtocol && proxyProtocol.indexOf('https://') !== 0 ) ||\n     importedUrl.indexOf('http://') === 0) ?\n    http.get :\n    https.get;\n\n  var errorHandled = false;\n  function handleError(message) {\n    if (errorHandled)\n      return;\n\n    errorHandled = true;\n    context.errors.push('Broken @import declaration of \"' + importedUrl + '\" - ' + message);\n    restoreImport(importedUrl, mediaQuery, context);\n\n    process.nextTick(function () {\n      processNext(context);\n    });\n  }\n\n  var requestOptions = override(url.parse(importedUrl), context.inliner.request);\n  if (context.inliner.request.hostname !== undefined) {\n\n    //overwrite as we always expect a http proxy currently\n    requestOptions.protocol = context.inliner.request.protocol || 'http:';\n    requestOptions.path = requestOptions.href;\n  }\n\n\n  get(requestOptions, function (res) {\n    if (res.statusCode < 200 || res.statusCode > 399) {\n      return handleError('error ' + res.statusCode);\n    } else if (res.statusCode > 299) {\n      var movedUrl = url.resolve(importedUrl, res.headers.location);\n      return inlineRemoteResource(movedUrl, mediaQuery, context);\n    }\n\n    var chunks = [];\n    var parsedUrl = url.parse(importedUrl);\n    res.on('data', function (chunk) {\n      chunks.push(chunk.toString());\n    });\n    res.on('end', function () {\n      var importedData = chunks.join('');\n      if (context.rebase)\n        importedData = rewriteUrls(importedData, { toBase: originalUrl }, context);\n      context.sourceReader.trackSource(importedUrl, importedData);\n      importedData = context.sourceTracker.store(importedUrl, importedData);\n      importedData = rebaseMap(importedData, importedUrl);\n\n      if (mediaQuery.length > 0)\n        importedData = '@media ' + mediaQuery + '{' + importedData + '}';\n\n      context.afterImport = true;\n\n      var newContext = override(context, {\n        isRemote: true,\n        relativeTo: parsedUrl.protocol + '//' + parsedUrl.host + parsedUrl.pathname\n      });\n\n      process.nextTick(function () {\n        importFrom(importedData, newContext);\n      });\n    });\n  })\n  .on('error', function (res) {\n    handleError(res.message);\n  })\n  .on('timeout', function () {\n    handleError('timeout');\n  })\n  .setTimeout(context.inliner.timeout);\n}\n\nfunction inlineLocalResource(importedFile, mediaQuery, context) {\n  var relativeTo = importedFile[0] == '/' ?\n    context.root :\n    context.relativeTo;\n\n  var fullPath = path.resolve(path.join(relativeTo, importedFile));\n\n  if (!fs.existsSync(fullPath) || !fs.statSync(fullPath).isFile()) {\n    context.errors.push('Broken @import declaration of \"' + importedFile + '\"');\n    return processNext(context);\n  }\n\n  if (context.visited.indexOf(fullPath) > -1)\n    return processNext(context);\n\n\n  if (context.debug)\n    console.error('Inlining local stylesheet: ' + fullPath);\n\n  context.visited.push(fullPath);\n\n  var importRelativeTo = path.dirname(fullPath);\n  var importedData = fs.readFileSync(fullPath, 'utf8');\n  if (context.rebase) {\n    var rewriteOptions = {\n      relative: true,\n      fromBase: importRelativeTo,\n      toBase: context.baseRelativeTo\n    };\n    importedData = rewriteUrls(importedData, rewriteOptions, context);\n  }\n\n  var relativePath = path.relative(context.root, fullPath);\n  context.sourceReader.trackSource(relativePath, importedData);\n  importedData = context.sourceTracker.store(relativePath, importedData);\n\n  if (mediaQuery.length > 0)\n    importedData = '@media ' + mediaQuery + '{' + importedData + '}';\n\n  context.afterImport = true;\n\n  var newContext = override(context, {\n    relativeTo: importRelativeTo\n  });\n\n  return importFrom(importedData, newContext);\n}\n\nfunction restoreImport(importedUrl, mediaQuery, context) {\n  var restoredImport = '@import url(' + importedUrl + ')' + (mediaQuery.length > 0 ? ' ' + mediaQuery : '') + ';';\n  context.done.push(restoredImport);\n}\n\nmodule.exports = ImportInliner;\n"]}