{"version":3,"sources":["merge-non-adjacent-by-selector.js"],"names":[],"mappings":"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","file":"merge-non-adjacent-by-selector-compiled.js","sourcesContent":["var optimizeProperties = require('../properties/optimizer');\nvar stringifySelectors = require('../stringifier/one-time').selectors;\nvar extractProperties = require('./extractor');\nvar canReorder = require('./reorderable').canReorder;\n\nfunction mergeNonAdjacentBySelector(tokens, options, context) {\n  var allSelectors = {};\n  var repeatedSelectors = [];\n  var i;\n\n  for (i = tokens.length - 1; i >= 0; i--) {\n    if (tokens[i][0] != 'selector')\n      continue;\n    if (tokens[i][2].length === 0)\n      continue;\n\n    var selector = stringifySelectors(tokens[i][1]);\n    allSelectors[selector] = [i].concat(allSelectors[selector] || []);\n\n    if (allSelectors[selector].length == 2)\n      repeatedSelectors.push(selector);\n  }\n\n  for (i = repeatedSelectors.length - 1; i >= 0; i--) {\n    var positions = allSelectors[repeatedSelectors[i]];\n\n    selectorIterator:\n    for (var j = positions.length - 1; j > 0; j--) {\n      var positionOne = positions[j - 1];\n      var tokenOne = tokens[positionOne];\n      var positionTwo = positions[j];\n      var tokenTwo = tokens[positionTwo];\n\n      directionIterator:\n      for (var direction = 1; direction >= -1; direction -= 2) {\n        var topToBottom = direction == 1;\n        var from = topToBottom ? positionOne + 1 : positionTwo - 1;\n        var to = topToBottom ? positionTwo : positionOne;\n        var delta = topToBottom ? 1 : -1;\n        var moved = topToBottom ? tokenOne : tokenTwo;\n        var target = topToBottom ? tokenTwo : tokenOne;\n        var movedProperties = extractProperties(moved);\n        var joinAt;\n\n        while (from != to) {\n          var traversedProperties = extractProperties(tokens[from]);\n          from += delta;\n\n          // traversed then moved as we move selectors towards the start\n          var reorderable = topToBottom ?\n            canReorder(movedProperties, traversedProperties) :\n            canReorder(traversedProperties, movedProperties);\n\n          if (!reorderable && !topToBottom)\n            continue selectorIterator;\n          if (!reorderable && topToBottom)\n            continue directionIterator;\n        }\n\n        if (topToBottom) {\n          joinAt = [moved[2].length];\n          Array.prototype.push.apply(moved[2], target[2]);\n          target[2] = moved[2];\n        } else {\n          joinAt = [target[2].length];\n          Array.prototype.push.apply(target[2], moved[2]);\n        }\n\n        optimizeProperties(target[1], target[2], joinAt, true, options, context);\n        moved[2] = [];\n      }\n    }\n  }\n}\n\nmodule.exports = mergeNonAdjacentBySelector;\n"]}