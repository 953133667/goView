{"version":3,"sources":["merge-non-adjacent-by-body.js"],"names":[],"mappings":"AAAA,IAAI,gBAAgB,QAAQ,yBAAR,EAAmC,IAAvD;AACA,IAAI,qBAAqB,QAAQ,yBAAR,EAAmC,SAA5D;AACA,IAAI,mBAAmB,QAAQ,YAAR,EAAsB,SAA7C;AACA,IAAI,YAAY,QAAQ,cAAR,CAAhB;;AAEA,SAAS,cAAT,CAAwB,KAAxB,EAA+B;AAC7B,SAAO,YAAW,IAAX,CAAgB,KAAhB;AAAP;AACD;;AAED,SAAS,YAAT,CAAsB,KAAtB,EAA6B;AAC3B,MAAI,WAAW,mBAAmB,MAAM,CAAN,CAAnB,CAAf;AACA,SAAO,SAAS,OAAT,CAAiB,IAAjB,IAAyB,CAAC,CAA1B,IAA+B,SAAS,OAAT,CAAiB,IAAjB,IAAyB,CAAC,CAAhE;AACD;;AAED,SAAS,eAAT,CAAyB,QAAzB,EAAmC;AACjC,SAAO,SAAS,OAAT,CAAiB,gBAAjB,EAAmC,EAAnC,CAAP;AACD;;AAED,SAAS,uBAAT,CAAiC,IAAjC,EAAuC,UAAvC,EAAmD;AACjD,MAAI,eAAe,gBAAgB,mBAAmB,KAAK,CAAL,CAAnB,CAAhB,CAAnB;;AAEA,OAAK,IAAI,IAAT,IAAiB,UAAjB,EAA6B;AAC3B,QAAI,QAAQ,WAAW,IAAX,CAAZ;AACA,QAAI,gBAAgB,gBAAgB,mBAAmB,MAAM,CAAN,CAAnB,CAAhB,CAApB;;AAEA,QAAI,cAAc,OAAd,CAAsB,YAAtB,IAAsC,CAAC,CAAvC,IAA4C,aAAa,OAAb,CAAqB,aAArB,IAAsC,CAAC,CAAvF,EACE,OAAO,WAAW,IAAX,CAAP;AACH;AACF;;AAED,SAAS,sBAAT,CAAgC,MAAhC,EAAwC,OAAxC,EAAiD;AAC/C,MAAI,aAAa,EAAjB;AACA,MAAI,gBAAgB,QAAQ,aAAR,CAAsB,SAAtB,CAAgC,aAApD;;AAEA,OAAK,IAAI,IAAI,OAAO,MAAP,GAAgB,CAA7B,EAAgC,KAAK,CAArC,EAAwC,GAAxC,EAA6C;AAC3C,QAAI,QAAQ,OAAO,CAAP,CAAZ;AACA,QAAI,MAAM,CAAN,KAAY,UAAhB,EACE;;AAEF,QAAI,MAAM,CAAN,EAAS,MAAT,GAAkB,CAAlB,IAAwB,CAAC,QAAQ,eAAT,IAA4B,eAAe,mBAAmB,MAAM,CAAN,CAAnB,CAAf,CAAxD,EACE,aAAa,EAAb;;AAEF,QAAI,MAAM,CAAN,EAAS,MAAT,GAAkB,CAAlB,IAAuB,QAAQ,eAA/B,IAAkD,aAAa,KAAb,CAAtD,EACE,wBAAwB,KAAxB,EAA+B,UAA/B;;AAEF,QAAI,gBAAgB,cAAc,MAAM,CAAN,CAAd,CAApB;AACA,QAAI,WAAW,WAAW,aAAX,CAAf;AACA,QAAI,YAAY,CAAC,UAAU,OAAV,EAAmB,mBAAmB,MAAM,CAAN,CAAnB,CAAnB,CAAb,IAAiE,CAAC,UAAU,OAAV,EAAmB,mBAAmB,SAAS,CAAT,CAAnB,CAAnB,CAAtE,EAA2H;AACzH,YAAM,CAAN,IAAW,MAAM,CAAN,EAAS,MAAT,GAAkB,CAAlB,GACT,iBAAiB,SAAS,CAAT,EAAY,MAAZ,CAAmB,MAAM,CAAN,CAAnB,CAAjB,EAA+C,KAA/C,EAAsD,aAAtD,CADS,GAET,SAAS,CAAT,EAAY,MAAZ,CAAmB,MAAM,CAAN,CAAnB,CAFF;;AAIA,eAAS,CAAT,IAAc,EAAd;AACA,iBAAW,aAAX,IAA4B,IAA5B;AACD;;AAED,eAAW,cAAc,MAAM,CAAN,CAAd,CAAX,IAAsC,KAAtC;AACD;AACF;;AAED,OAAO,OAAP,GAAiB,sBAAjB","file":"merge-non-adjacent-by-body-compiled.js","sourcesContent":["var stringifyBody = require('../stringifier/one-time').body;\nvar stringifySelectors = require('../stringifier/one-time').selectors;\nvar cleanUpSelectors = require('./clean-up').selectors;\nvar isSpecial = require('./is-special');\n\nfunction unsafeSelector(value) {\n  return /\\.|\\*| :/.test(value);\n}\n\nfunction isBemElement(token) {\n  var asString = stringifySelectors(token[1]);\n  return asString.indexOf('__') > -1 || asString.indexOf('--') > -1;\n}\n\nfunction withoutModifier(selector) {\n  return selector.replace(/--[^ ,>\\+~:]+/g, '');\n}\n\nfunction removeAnyUnsafeElements(left, candidates) {\n  var leftSelector = withoutModifier(stringifySelectors(left[1]));\n\n  for (var body in candidates) {\n    var right = candidates[body];\n    var rightSelector = withoutModifier(stringifySelectors(right[1]));\n\n    if (rightSelector.indexOf(leftSelector) > -1 || leftSelector.indexOf(rightSelector) > -1)\n      delete candidates[body];\n  }\n}\n\nfunction mergeNonAdjacentByBody(tokens, options) {\n  var candidates = {};\n  var adjacentSpace = options.compatibility.selectors.adjacentSpace;\n\n  for (var i = tokens.length - 1; i >= 0; i--) {\n    var token = tokens[i];\n    if (token[0] != 'selector')\n      continue;\n\n    if (token[2].length > 0 && (!options.semanticMerging && unsafeSelector(stringifySelectors(token[1]))))\n      candidates = {};\n\n    if (token[2].length > 0 && options.semanticMerging && isBemElement(token))\n      removeAnyUnsafeElements(token, candidates);\n\n    var candidateBody = stringifyBody(token[2]);\n    var oldToken = candidates[candidateBody];\n    if (oldToken && !isSpecial(options, stringifySelectors(token[1])) && !isSpecial(options, stringifySelectors(oldToken[1]))) {\n      token[1] = token[2].length > 0 ?\n        cleanUpSelectors(oldToken[1].concat(token[1]), false, adjacentSpace) :\n        oldToken[1].concat(token[1]);\n\n      oldToken[2] = [];\n      candidates[candidateBody] = null;\n    }\n\n    candidates[stringifyBody(token[2])] = token;\n  }\n}\n\nmodule.exports = mergeNonAdjacentByBody;\n"]}