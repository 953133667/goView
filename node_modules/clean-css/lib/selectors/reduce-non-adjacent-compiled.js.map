{"version":3,"sources":["reduce-non-adjacent.js"],"names":[],"mappings":"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","file":"reduce-non-adjacent-compiled.js","sourcesContent":["var optimizeProperties = require('../properties/optimizer');\nvar stringifyBody = require('../stringifier/one-time').body;\nvar stringifySelectors = require('../stringifier/one-time').selectors;\nvar isSpecial = require('./is-special');\nvar cloneArray = require('../utils/clone-array');\n\nfunction reduceNonAdjacent(tokens, options, context) {\n  var candidates = {};\n  var repeated = [];\n\n  for (var i = tokens.length - 1; i >= 0; i--) {\n    var token = tokens[i];\n\n    if (token[0] != 'selector')\n      continue;\n    if (token[2].length === 0)\n      continue;\n\n    var selectorAsString = stringifySelectors(token[1]);\n    var isComplexAndNotSpecial = token[1].length > 1 && !isSpecial(options, selectorAsString);\n    var wrappedSelectors = options.sourceMap ? wrappedSelectorsFrom(token[1]) : token[1];\n    var selectors = isComplexAndNotSpecial ?\n      [selectorAsString].concat(wrappedSelectors) :\n      [selectorAsString];\n\n    for (var j = 0, m = selectors.length; j < m; j++) {\n      var selector = selectors[j];\n\n      if (!candidates[selector])\n        candidates[selector] = [];\n      else\n        repeated.push(selector);\n\n      candidates[selector].push({\n        where: i,\n        list: wrappedSelectors,\n        isPartial: isComplexAndNotSpecial && j > 0,\n        isComplex: isComplexAndNotSpecial && j === 0\n      });\n    }\n  }\n\n  reduceSimpleNonAdjacentCases(tokens, repeated, candidates, options, context);\n  reduceComplexNonAdjacentCases(tokens, candidates, options, context);\n}\n\nfunction wrappedSelectorsFrom(list) {\n  var wrapped = [];\n\n  for (var i = 0; i < list.length; i++) {\n    wrapped.push([list[i][0]]);\n  }\n\n  return wrapped;\n}\n\nfunction reduceSimpleNonAdjacentCases(tokens, repeated, candidates, options, context) {\n  function filterOut(idx, bodies) {\n    return data[idx].isPartial && bodies.length === 0;\n  }\n\n  function reduceBody(token, newBody, processedCount, tokenIdx) {\n    if (!data[processedCount - tokenIdx - 1].isPartial)\n      token[2] = newBody;\n  }\n\n  for (var i = 0, l = repeated.length; i < l; i++) {\n    var selector = repeated[i];\n    var data = candidates[selector];\n\n    reduceSelector(tokens, selector, data, {\n      filterOut: filterOut,\n      callback: reduceBody\n    }, options, context);\n  }\n}\n\nfunction reduceComplexNonAdjacentCases(tokens, candidates, options, context) {\n  var localContext = {};\n\n  function filterOut(idx) {\n    return localContext.data[idx].where < localContext.intoPosition;\n  }\n\n  function collectReducedBodies(token, newBody, processedCount, tokenIdx) {\n    if (tokenIdx === 0)\n      localContext.reducedBodies.push(newBody);\n  }\n\n  allSelectors:\n  for (var complexSelector in candidates) {\n    var into = candidates[complexSelector];\n    if (!into[0].isComplex)\n      continue;\n\n    var intoPosition = into[into.length - 1].where;\n    var intoToken = tokens[intoPosition];\n    var reducedBodies = [];\n\n    var selectors = isSpecial(options, complexSelector) ?\n      [complexSelector] :\n      into[0].list;\n\n    localContext.intoPosition = intoPosition;\n    localContext.reducedBodies = reducedBodies;\n\n    for (var j = 0, m = selectors.length; j < m; j++) {\n      var selector = selectors[j];\n      var data = candidates[selector];\n\n      if (data.length < 2)\n        continue allSelectors;\n\n      localContext.data = data;\n\n      reduceSelector(tokens, selector, data, {\n        filterOut: filterOut,\n        callback: collectReducedBodies\n      }, options, context);\n\n      if (stringifyBody(reducedBodies[reducedBodies.length - 1]) != stringifyBody(reducedBodies[0]))\n        continue allSelectors;\n    }\n\n    intoToken[2] = reducedBodies[0];\n  }\n}\n\nfunction reduceSelector(tokens, selector, data, context, options, outerContext) {\n  var bodies = [];\n  var bodiesAsList = [];\n  var joinsAt = [];\n  var processedTokens = [];\n\n  for (var j = data.length - 1, m = 0; j >= 0; j--) {\n    if (context.filterOut(j, bodies))\n      continue;\n\n    var where = data[j].where;\n    var token = tokens[where];\n    var clonedBody = cloneArray(token[2]);\n\n    bodies = bodies.concat(clonedBody);\n    bodiesAsList.push(clonedBody);\n    processedTokens.push(where);\n  }\n\n  for (j = 0, m = bodiesAsList.length; j < m; j++) {\n    if (bodiesAsList[j].length > 0)\n      joinsAt.push((joinsAt[j - 1] || 0) + bodiesAsList[j].length);\n  }\n\n  optimizeProperties(selector, bodies, joinsAt, false, options, outerContext);\n\n  var processedCount = processedTokens.length;\n  var propertyIdx = bodies.length - 1;\n  var tokenIdx = processedCount - 1;\n\n  while (tokenIdx >= 0) {\n     if ((tokenIdx === 0 || (bodies[propertyIdx] && bodiesAsList[tokenIdx].indexOf(bodies[propertyIdx]) > -1)) && propertyIdx > -1) {\n      propertyIdx--;\n      continue;\n    }\n\n    var newBody = bodies.splice(propertyIdx + 1);\n    context.callback(tokens[processedTokens[tokenIdx]], newBody, processedCount, tokenIdx);\n\n    tokenIdx--;\n  }\n}\n\nmodule.exports = reduceNonAdjacent;\n"]}