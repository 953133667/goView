{"version":3,"sources":["reduce.js"],"names":[],"mappings":"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","file":"reduce-compiled.js","sourcesContent":["var split = require('../utils/split');\n\nvar URL_PREFIX = 'url(';\nvar UPPERCASE_URL_PREFIX = 'URL(';\nvar URL_SUFFIX = ')';\nvar SINGLE_QUOTE_URL_SUFFIX = '\\')';\nvar DOUBLE_QUOTE_URL_SUFFIX = '\")';\n\nvar DATA_URI_PREFIX_PATTERN = /^\\s*['\"]?\\s*data:/;\nvar DATA_URI_TRAILER_PATTERN = /[\\s\\};,\\/!]/;\n\nvar IMPORT_URL_PREFIX = '@import';\nvar UPPERCASE_IMPORT_URL_PREFIX = '@IMPORT';\n\nvar COMMENT_END_MARKER = /\\*\\//;\n\nfunction byUrl(data, context, callback) {\n  var nextStart = 0;\n  var nextStartUpperCase = 0;\n  var nextEnd = 0;\n  var firstMatch;\n  var isDataURI = false;\n  var cursor = 0;\n  var tempData = [];\n  var hasUppercaseUrl = data.indexOf(UPPERCASE_URL_PREFIX) > -1;\n\n  for (; nextEnd < data.length;) {\n    nextStart = data.indexOf(URL_PREFIX, nextEnd);\n    nextStartUpperCase = hasUppercaseUrl ? data.indexOf(UPPERCASE_URL_PREFIX, nextEnd) : -1;\n    if (nextStart == -1 && nextStartUpperCase == -1)\n      break;\n\n    if (nextStart == -1 && nextStartUpperCase > -1)\n      nextStart = nextStartUpperCase;\n\n    if (data[nextStart + URL_PREFIX.length] == '\"') {\n      nextEnd = data.indexOf(DOUBLE_QUOTE_URL_SUFFIX, nextStart);\n    } else if (data[nextStart + URL_PREFIX.length] == '\\'') {\n      nextEnd = data.indexOf(SINGLE_QUOTE_URL_SUFFIX, nextStart);\n    } else {\n      isDataURI = DATA_URI_PREFIX_PATTERN.test(data.substring(nextStart + URL_PREFIX.length));\n\n      if (isDataURI) {\n        firstMatch = split(data.substring(nextStart), DATA_URI_TRAILER_PATTERN, false, '(', ')', true).pop();\n\n        if (firstMatch && firstMatch[firstMatch.length - 1] == URL_SUFFIX) {\n          nextEnd = nextStart + firstMatch.length - URL_SUFFIX.length;\n        } else {\n          nextEnd = -1;\n        }\n      } else {\n        nextEnd = data.indexOf(URL_SUFFIX, nextStart);\n      }\n    }\n\n\n    // Following lines are a safety mechanism to ensure\n    // incorrectly terminated urls are processed correctly.\n    if (nextEnd == -1) {\n      nextEnd = data.indexOf('}', nextStart);\n\n      if (nextEnd == -1)\n        nextEnd = data.length;\n      else\n        nextEnd--;\n\n      context.warnings.push('Broken URL declaration: \\'' + data.substring(nextStart, nextEnd + 1) + '\\'.');\n    } else {\n      if (data[nextEnd] != URL_SUFFIX)\n        nextEnd = data.indexOf(URL_SUFFIX, nextEnd);\n    }\n\n    tempData.push(data.substring(cursor, nextStart));\n\n    var url = data.substring(nextStart, nextEnd + 1);\n    callback(url, tempData);\n\n    cursor = nextEnd + 1;\n  }\n\n  return tempData.length > 0 ?\n    tempData.join('') + data.substring(cursor, data.length) :\n    data;\n}\n\nfunction byImport(data, context, callback) {\n  var nextImport = 0;\n  var nextImportUpperCase = 0;\n  var nextStart = 0;\n  var nextEnd = 0;\n  var cursor = 0;\n  var tempData = [];\n  var nextSingleQuote = 0;\n  var nextDoubleQuote = 0;\n  var untilNextQuote;\n  var withQuote;\n  var SINGLE_QUOTE = '\\'';\n  var DOUBLE_QUOTE = '\"';\n\n  for (; nextEnd < data.length;) {\n    nextImport = data.indexOf(IMPORT_URL_PREFIX, nextEnd);\n    nextImportUpperCase = data.indexOf(UPPERCASE_IMPORT_URL_PREFIX, nextEnd);\n    if (nextImport == -1 && nextImportUpperCase == -1)\n      break;\n\n    if (nextImport > -1 && nextImportUpperCase > -1 && nextImportUpperCase < nextImport)\n      nextImport = nextImportUpperCase;\n\n    nextSingleQuote = data.indexOf(SINGLE_QUOTE, nextImport);\n    nextDoubleQuote = data.indexOf(DOUBLE_QUOTE, nextImport);\n\n    if (nextSingleQuote > -1 && nextDoubleQuote > -1 && nextSingleQuote < nextDoubleQuote) {\n      nextStart = nextSingleQuote;\n      withQuote = SINGLE_QUOTE;\n    } else if (nextSingleQuote > -1 && nextDoubleQuote > -1 && nextSingleQuote > nextDoubleQuote) {\n      nextStart = nextDoubleQuote;\n      withQuote = DOUBLE_QUOTE;\n    } else if (nextSingleQuote > -1) {\n      nextStart = nextSingleQuote;\n      withQuote = SINGLE_QUOTE;\n    } else if (nextDoubleQuote > -1) {\n      nextStart = nextDoubleQuote;\n      withQuote = DOUBLE_QUOTE;\n    } else {\n      break;\n    }\n\n    tempData.push(data.substring(cursor, nextStart));\n    nextEnd = data.indexOf(withQuote, nextStart + 1);\n\n    untilNextQuote = data.substring(nextImport, nextEnd);\n    if (nextEnd == -1 || /^@import\\s+(url\\(|__ESCAPED)/i.test(untilNextQuote) || COMMENT_END_MARKER.test(untilNextQuote)) {\n      cursor = nextStart;\n      break;\n    }\n\n    var url = data.substring(nextStart, nextEnd + 1);\n    callback(url, tempData);\n\n    cursor = nextEnd + 1;\n  }\n\n  return tempData.length > 0 ?\n    tempData.join('') + data.substring(cursor, data.length) :\n    data;\n}\n\nfunction reduceAll(data, context, callback) {\n  data = byUrl(data, context, callback);\n  data = byImport(data, context, callback);\n  return data;\n}\n\nmodule.exports = reduceAll;\n"]}