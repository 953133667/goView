{"version":3,"sources":["quote-scanner.js"],"names":[],"mappings":"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","file":"quote-scanner-compiled.js","sourcesContent":["var COMMENT_START_MARK = '/*';\n\nfunction QuoteScanner(data) {\n  this.data = data;\n}\n\nvar findQuoteEnd = function (data, matched, cursor, oldCursor) {\n  var commentEndMark = '*/';\n  var escapeMark = '\\\\';\n  var blockEndMark = '}';\n  var dataPrefix = data.substring(oldCursor, cursor);\n  var commentEndedAt = dataPrefix.lastIndexOf(commentEndMark, cursor);\n  var commentStartedAt = findLastCommentStartedAt(dataPrefix, cursor);\n  var commentStarted = false;\n\n  if (commentEndedAt >= cursor && commentStartedAt > -1)\n    commentStarted = true;\n  if (commentStartedAt < cursor && commentStartedAt > commentEndedAt)\n    commentStarted = true;\n\n  if (commentStarted) {\n    var commentEndsAt = data.indexOf(commentEndMark, cursor);\n    if (commentEndsAt > -1)\n      return commentEndsAt;\n\n    commentEndsAt = data.indexOf(blockEndMark, cursor);\n    return commentEndsAt > -1 ? commentEndsAt - 1 : data.length;\n  }\n\n  while (true) {\n    if (data[cursor] === undefined)\n      break;\n    if (data[cursor] == matched && (data[cursor - 1] != escapeMark || data[cursor - 2] == escapeMark))\n      break;\n\n    cursor++;\n  }\n\n  return cursor;\n};\n\nfunction findLastCommentStartedAt(data, cursor) {\n  var position = cursor;\n\n  while (position > -1) {\n    position = data.lastIndexOf(COMMENT_START_MARK, position);\n\n    if (position > -1 && data[position - 1] != '*') {\n      break;\n    } else {\n      position--;\n    }\n  }\n\n  return position;\n}\n\nfunction findNext(data, mark, startAt) {\n  var escapeMark = '\\\\';\n  var candidate = startAt;\n\n  while (true) {\n    candidate = data.indexOf(mark, candidate + 1);\n    if (candidate == -1)\n      return -1;\n    if (data[candidate - 1] != escapeMark)\n      return candidate;\n  }\n}\n\nQuoteScanner.prototype.each = function (callback) {\n  var data = this.data;\n  var tempData = [];\n  var nextStart = 0;\n  var nextEnd = 0;\n  var cursor = 0;\n  var matchedMark = null;\n  var singleMark = '\\'';\n  var doubleMark = '\"';\n  var dataLength = data.length;\n\n  for (; nextEnd < data.length;) {\n    var nextStartSingle = findNext(data, singleMark, nextEnd);\n    var nextStartDouble = findNext(data, doubleMark, nextEnd);\n\n    if (nextStartSingle == -1)\n      nextStartSingle = dataLength;\n    if (nextStartDouble == -1)\n      nextStartDouble = dataLength;\n\n    if (nextStartSingle < nextStartDouble) {\n      nextStart = nextStartSingle;\n      matchedMark = singleMark;\n    } else {\n      nextStart = nextStartDouble;\n      matchedMark = doubleMark;\n    }\n\n    if (nextStart == -1)\n      break;\n\n    nextEnd = findQuoteEnd(data, matchedMark, nextStart + 1, cursor);\n    if (nextEnd == -1)\n      break;\n\n    var text = data.substring(nextStart, nextEnd + 1);\n    tempData.push(data.substring(cursor, nextStart));\n    if (text.length > 0)\n      callback(text, tempData, nextStart);\n\n    cursor = nextEnd + 1;\n  }\n\n  return tempData.length > 0 ?\n    tempData.join('') + data.substring(cursor, data.length) :\n    data;\n};\n\nmodule.exports = QuoteScanner;\n"]}