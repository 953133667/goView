{"version":3,"sources":["source-reader.js"],"names":[],"mappings":"AAAA,IAAI,OAAO,QAAQ,MAAR,CAAX;AACA,IAAI,cAAc,QAAQ,iBAAR,CAAlB;;AAEA,IAAI,kBAAkB,iBAAtB;;AAEA,SAAS,YAAT,CAAsB,OAAtB,EAA+B,IAA/B,EAAqC;AACnC,OAAK,YAAL,GAAoB,OAApB;AACA,OAAK,IAAL,GAAY,IAAZ;AACA,OAAK,OAAL,GAAe,EAAf;AACD;;AAED,aAAa,SAAb,CAAuB,QAAvB,GAAkC,UAAU,IAAV,EAAgB;AAChD,SAAO,KAAK,OAAL,CAAa,IAAb,CAAP;AACD,CAFD;;AAIA,aAAa,SAAb,CAAuB,WAAvB,GAAqC,UAAU,IAAV,EAAgB,MAAhB,EAAwB;AAC3D,OAAK,OAAL,CAAa,IAAb,IAAqB,EAArB;AACA,OAAK,OAAL,CAAa,IAAb,EAAmB,IAAnB,IAA2B,MAA3B;AACD,CAHD;;AAKA,aAAa,SAAb,CAAuB,QAAvB,GAAkC,YAAY;AAC5C,MAAI,OAAO,KAAK,IAAZ,IAAoB,QAAxB,EACE,OAAO,WAAW,IAAX,CAAP;AACF,MAAI,OAAO,QAAP,CAAgB,KAAK,IAArB,CAAJ,EACE,OAAO,WAAW,IAAX,CAAP;AACF,MAAI,MAAM,OAAN,CAAc,KAAK,IAAnB,CAAJ,EACE,OAAO,UAAU,IAAV,CAAP;;AAEF,SAAO,SAAS,IAAT,CAAP;AACD,CATD;;AAWA,SAAS,UAAT,CAAoB,IAApB,EAA0B;AACxB,MAAI,OAAO,KAAK,IAAhB;AACA,OAAK,WAAL,CAAiB,SAAjB,EAA4B,IAA5B;AACA,SAAO,IAAP;AACD;;AAED,SAAS,UAAT,CAAoB,IAApB,EAA0B;AACxB,MAAI,OAAO,KAAK,IAAL,CAAU,QAAV,EAAX;AACA,OAAK,WAAL,CAAiB,SAAjB,EAA4B,IAA5B;AACA,SAAO,IAAP;AACD;;AAED,SAAS,SAAT,CAAmB,IAAnB,EAAyB;AACvB,SAAO,KAAK,IAAL,CACJ,GADI,CACA,UAAU,MAAV,EAAkB;AACrB,WAAO,KAAK,YAAL,CAAkB,OAAlB,CAA0B,aAA1B,KAA4C,KAA5C,GACL,SAAS,UADJ,GAEL,MAFF;AAGD,GALI,EAMJ,GANI,CAMA,UAAU,MAAV,EAAkB;AACrB,WAAO,CAAC,KAAK,YAAL,CAAkB,OAAlB,CAA0B,UAA3B,IAAyC,eAAe,IAAf,CAAoB,MAApB,CAAzC,GACL,MADK,GAEL,KAAK,QAAL,CAAc,KAAK,YAAL,CAAkB,OAAlB,CAA0B,UAAxC,EAAoD,MAApD,CAFF;AAGD,GAVI,EAWJ,GAXI,CAWA,UAAU,MAAV,EAAkB;AAAE,WAAO,iBAAiB,MAAjB,GAA0B,IAAjC;AAAwC,GAX5D,EAYJ,IAZI,CAYC,EAZD,CAAP;AAaD;;AAED,SAAS,QAAT,CAAkB,IAAlB,EAAwB;AACtB,MAAI,OAAO,EAAX;AACA,MAAI,SAAS,KAAK,OAAL,CAAa,KAAK,YAAL,CAAkB,OAAlB,CAA0B,MAA1B,IAAoC,KAAK,YAAL,CAAkB,OAAlB,CAA0B,IAA3E,CAAb;;AAEA,OAAK,IAAI,MAAT,IAAmB,KAAK,IAAxB,EAA8B;AAC5B,QAAI,SAAS,KAAK,IAAL,CAAU,MAAV,EAAkB,MAA/B;AACA,QAAI,iBAAiB,KAAK,IAAL,CAAU,MAAV,EAAkB,SAAvC;AACA,QAAI,WAAW,gBAAgB,IAAhB,CAAqB,MAArB,CAAf;AACA,QAAI,iBAAiB,WAAW,MAAX,GAAoB,KAAK,OAAL,CAAa,MAAb,CAAzC;AACA,QAAI,qBAAqB,KAAK,OAAL,CAAa,cAAb,CAAzB;;AAEA,QAAI,iBAAiB;AACnB,gBAAU,KAAK,YAAL,CAAkB,OAAlB,CAA0B,YADjB;AAEnB,gBAAU,CAAC,KAAK,YAAL,CAAkB,OAAlB,CAA0B,YAFlB;AAGnB,eAAS,IAHU;AAInB,cAAQ,KAAK,YAAL,CAAkB,OAAlB,CAA0B,MAJf;AAKnB,gBAAU,kBALS;AAMnB,cAAQ,WAAW,kBAAX,GAAgC,MANrB;AAOnB,iBAAW,KAAK,YAAL,CAAkB,OAAlB,CAA0B,aAA1B,CAAwC,UAAxC,CAAmD;AAP3C,KAArB;AASA,aAAS,YAAY,MAAZ,EAAoB,cAApB,EAAoC,KAAK,YAAzC,CAAT;;AAEA,SAAK,WAAL,CAAiB,MAAjB,EAAyB,MAAzB;;AAEA,aAAS,KAAK,YAAL,CAAkB,aAAlB,CAAgC,KAAhC,CAAsC,MAAtC,EAA8C,MAA9C,CAAT;;AAEA;AACA,QAAI,KAAK,YAAL,CAAkB,OAAlB,CAA0B,SAA1B,IAAuC,cAA3C,EACE,KAAK,YAAL,CAAkB,qBAAlB,CAAwC,WAAxC,CAAoD,MAApD,EAA4D,MAA5D,EAAoE,cAApE;;AAEF,SAAK,IAAL,CAAU,MAAV;AACD;;AAED,SAAO,KAAK,IAAL,CAAU,EAAV,CAAP;AACD;;AAED,OAAO,OAAP,GAAiB,YAAjB","file":"source-reader-compiled.js","sourcesContent":["var path = require('path');\nvar rewriteUrls = require('../urls/rewrite');\n\nvar REMOTE_RESOURCE = /^(https?:)?\\/\\//;\n\nfunction SourceReader(context, data) {\n  this.outerContext = context;\n  this.data = data;\n  this.sources = {};\n}\n\nSourceReader.prototype.sourceAt = function (path) {\n  return this.sources[path];\n};\n\nSourceReader.prototype.trackSource = function (path, source) {\n  this.sources[path] = {};\n  this.sources[path][path] = source;\n};\n\nSourceReader.prototype.toString = function () {\n  if (typeof this.data == 'string')\n    return fromString(this);\n  if (Buffer.isBuffer(this.data))\n    return fromBuffer(this);\n  if (Array.isArray(this.data))\n    return fromArray(this);\n\n  return fromHash(this);\n};\n\nfunction fromString(self) {\n  var data = self.data;\n  self.trackSource(undefined, data);\n  return data;\n}\n\nfunction fromBuffer(self) {\n  var data = self.data.toString();\n  self.trackSource(undefined, data);\n  return data;\n}\n\nfunction fromArray(self) {\n  return self.data\n    .map(function (source) {\n      return self.outerContext.options.processImport === false ?\n        source + '@shallow' :\n        source;\n    })\n    .map(function (source) {\n      return !self.outerContext.options.relativeTo || /^https?:\\/\\//.test(source) ?\n        source :\n        path.relative(self.outerContext.options.relativeTo, source);\n    })\n    .map(function (source) { return '@import url(' + source + ');'; })\n    .join('');\n}\n\nfunction fromHash(self) {\n  var data = [];\n  var toBase = path.resolve(self.outerContext.options.target || self.outerContext.options.root);\n\n  for (var source in self.data) {\n    var styles = self.data[source].styles;\n    var inputSourceMap = self.data[source].sourceMap;\n    var isRemote = REMOTE_RESOURCE.test(source);\n    var absoluteSource = isRemote ? source : path.resolve(source);\n    var absoluteSourcePath = path.dirname(absoluteSource);\n\n    var rewriteOptions = {\n      absolute: self.outerContext.options.explicitRoot,\n      relative: !self.outerContext.options.explicitRoot,\n      imports: true,\n      rebase: self.outerContext.options.rebase,\n      fromBase: absoluteSourcePath,\n      toBase: isRemote ? absoluteSourcePath : toBase,\n      urlQuotes: self.outerContext.options.compatibility.properties.urlQuotes\n    };\n    styles = rewriteUrls(styles, rewriteOptions, self.outerContext);\n\n    self.trackSource(source, styles);\n\n    styles = self.outerContext.sourceTracker.store(source, styles);\n\n    // here we assume source map lies in the same directory as `source` does\n    if (self.outerContext.options.sourceMap && inputSourceMap)\n      self.outerContext.inputSourceMapTracker.trackLoaded(source, source, inputSourceMap);\n\n    data.push(styles);\n  }\n\n  return data.join('');\n}\n\nmodule.exports = SourceReader;\n"]}