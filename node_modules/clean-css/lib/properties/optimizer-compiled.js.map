{"version":3,"sources":["optimizer.js"],"names":[],"mappings":"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","file":"optimizer-compiled.js","sourcesContent":["var compactable = require('./compactable');\nvar wrapForOptimizing = require('./wrap-for-optimizing').all;\nvar populateComponents = require('./populate-components');\nvar compactOverrides = require('./override-compactor');\nvar compactShorthands = require('./shorthand-compactor');\nvar removeUnused = require('./remove-unused');\nvar restoreFromOptimizing = require('./restore-from-optimizing');\nvar stringifyProperty = require('../stringifier/one-time').property;\n\nvar shorthands = {\n  'animation-delay': ['animation'],\n  'animation-direction': ['animation'],\n  'animation-duration': ['animation'],\n  'animation-fill-mode': ['animation'],\n  'animation-iteration-count': ['animation'],\n  'animation-name': ['animation'],\n  'animation-play-state': ['animation'],\n  'animation-timing-function': ['animation'],\n  '-moz-animation-delay': ['-moz-animation'],\n  '-moz-animation-direction': ['-moz-animation'],\n  '-moz-animation-duration': ['-moz-animation'],\n  '-moz-animation-fill-mode': ['-moz-animation'],\n  '-moz-animation-iteration-count': ['-moz-animation'],\n  '-moz-animation-name': ['-moz-animation'],\n  '-moz-animation-play-state': ['-moz-animation'],\n  '-moz-animation-timing-function': ['-moz-animation'],\n  '-o-animation-delay': ['-o-animation'],\n  '-o-animation-direction': ['-o-animation'],\n  '-o-animation-duration': ['-o-animation'],\n  '-o-animation-fill-mode': ['-o-animation'],\n  '-o-animation-iteration-count': ['-o-animation'],\n  '-o-animation-name': ['-o-animation'],\n  '-o-animation-play-state': ['-o-animation'],\n  '-o-animation-timing-function': ['-o-animation'],\n  '-webkit-animation-delay': ['-webkit-animation'],\n  '-webkit-animation-direction': ['-webkit-animation'],\n  '-webkit-animation-duration': ['-webkit-animation'],\n  '-webkit-animation-fill-mode': ['-webkit-animation'],\n  '-webkit-animation-iteration-count': ['-webkit-animation'],\n  '-webkit-animation-name': ['-webkit-animation'],\n  '-webkit-animation-play-state': ['-webkit-animation'],\n  '-webkit-animation-timing-function': ['-webkit-animation'],\n  'border-color': ['border'],\n  'border-style': ['border'],\n  'border-width': ['border'],\n  'border-bottom': ['border'],\n  'border-bottom-color': ['border-bottom', 'border-color', 'border'],\n  'border-bottom-style': ['border-bottom', 'border-style', 'border'],\n  'border-bottom-width': ['border-bottom', 'border-width', 'border'],\n  'border-left': ['border'],\n  'border-left-color': ['border-left', 'border-color', 'border'],\n  'border-left-style': ['border-left', 'border-style', 'border'],\n  'border-left-width': ['border-left', 'border-width', 'border'],\n  'border-right': ['border'],\n  'border-right-color': ['border-right', 'border-color', 'border'],\n  'border-right-style': ['border-right', 'border-style', 'border'],\n  'border-right-width': ['border-right', 'border-width', 'border'],\n  'border-top': ['border'],\n  'border-top-color': ['border-top', 'border-color', 'border'],\n  'border-top-style': ['border-top', 'border-style', 'border'],\n  'border-top-width': ['border-top', 'border-width', 'border'],\n  'font-family': ['font'],\n  'font-size': ['font'],\n  'font-style': ['font'],\n  'font-variant': ['font'],\n  'font-weight': ['font'],\n  'transition-delay': ['transition'],\n  'transition-duration': ['transition'],\n  'transition-property': ['transition'],\n  'transition-timing-function': ['transition'],\n  '-moz-transition-delay': ['-moz-transition'],\n  '-moz-transition-duration': ['-moz-transition'],\n  '-moz-transition-property': ['-moz-transition'],\n  '-moz-transition-timing-function': ['-moz-transition'],\n  '-o-transition-delay': ['-o-transition'],\n  '-o-transition-duration': ['-o-transition'],\n  '-o-transition-property': ['-o-transition'],\n  '-o-transition-timing-function': ['-o-transition'],\n  '-webkit-transition-delay': ['-webkit-transition'],\n  '-webkit-transition-duration': ['-webkit-transition'],\n  '-webkit-transition-property': ['-webkit-transition'],\n  '-webkit-transition-timing-function': ['-webkit-transition']\n};\n\nfunction _optimize(properties, mergeAdjacent, aggressiveMerging, validator) {\n  var overrideMapping = {};\n  var lastName = null;\n  var lastProperty;\n  var j;\n\n  function mergeablePosition(position) {\n    if (mergeAdjacent === false || mergeAdjacent === true)\n      return mergeAdjacent;\n\n    return mergeAdjacent.indexOf(position) > -1;\n  }\n\n  function sameValue(position) {\n    var left = properties[position - 1];\n    var right = properties[position];\n\n    return stringifyProperty(left.all, left.position) == stringifyProperty(right.all, right.position);\n  }\n\n  propertyLoop:\n  for (var position = 0, total = properties.length; position < total; position++) {\n    var property = properties[position];\n    var _name = (property.name == '-ms-filter' || property.name == 'filter') ?\n      (lastName == 'background' || lastName == 'background-image' ? lastName : property.name) :\n      property.name;\n    var isImportant = property.important;\n    var isHack = property.hack;\n\n    if (property.unused)\n      continue;\n\n    if (position > 0 && lastProperty && _name == lastName && isImportant == lastProperty.important && isHack == lastProperty.hack && sameValue(position) && !lastProperty.unused) {\n      property.unused = true;\n      continue;\n    }\n\n    // comment is necessary - we assume that if two properties are one after another\n    // then it is intentional way of redefining property which may not be widely supported\n    // e.g. a{display:inline-block;display:-moz-inline-box}\n    // however if `mergeablePosition` yields true then the rule does not apply\n    // (e.g merging two adjacent selectors: `a{display:block}a{display:block}`)\n    if (_name in overrideMapping && (aggressiveMerging && _name != lastName || mergeablePosition(position))) {\n      var toOverridePositions = overrideMapping[_name];\n      var canOverride = compactable[_name] && compactable[_name].canOverride;\n      var anyRemoved = false;\n\n      for (j = toOverridePositions.length - 1; j >= 0; j--) {\n        var toRemove = properties[toOverridePositions[j]];\n        var longhandToShorthand = toRemove.name != _name;\n        var wasImportant = toRemove.important;\n        var wasHack = toRemove.hack;\n\n        if (toRemove.unused)\n          continue;\n\n        if (longhandToShorthand && wasImportant)\n          continue;\n\n        if (!wasImportant && (wasHack && !isHack || !wasHack && isHack))\n          continue;\n\n        if (wasImportant && (isHack == 'star' || isHack == 'underscore'))\n          continue;\n\n        if (!wasHack && !isHack && !longhandToShorthand && canOverride && !canOverride(toRemove, property, validator))\n          continue;\n\n        if (wasImportant && !isImportant || wasImportant && isHack) {\n          property.unused = true;\n          lastProperty = property;\n          continue propertyLoop;\n        } else {\n          anyRemoved = true;\n          toRemove.unused = true;\n        }\n      }\n\n      if (anyRemoved) {\n        position = -1;\n        lastProperty = null;\n        lastName = null;\n        overrideMapping = {};\n        continue;\n      }\n    } else {\n      overrideMapping[_name] = overrideMapping[_name] || [];\n      overrideMapping[_name].push(position);\n\n      // TODO: to be removed with\n      // certain shorthand (see values of `shorthands`) should trigger removal of\n      // longhand properties (see keys of `shorthands`)\n      var _shorthands = shorthands[_name];\n      if (_shorthands) {\n        for (j = _shorthands.length - 1; j >= 0; j--) {\n          var shorthand = _shorthands[j];\n          overrideMapping[shorthand] = overrideMapping[shorthand] || [];\n          overrideMapping[shorthand].push(position);\n        }\n      }\n    }\n\n    lastName = _name;\n    lastProperty = property;\n  }\n}\n\nfunction optimize(selector, properties, mergeAdjacent, withCompacting, options, context) {\n  var validator = context.validator;\n  var warnings = context.warnings;\n\n  var _properties = wrapForOptimizing(properties);\n  populateComponents(_properties, validator, warnings);\n  _optimize(_properties, mergeAdjacent, options.aggressiveMerging, validator);\n\n  for (var i = 0, l = _properties.length; i < l; i++) {\n    var _property = _properties[i];\n    if (_property.variable && _property.block)\n      optimize(selector, _property.value[0], mergeAdjacent, withCompacting, options, context);\n  }\n\n  if (withCompacting && options.shorthandCompacting) {\n    compactOverrides(_properties, options.compatibility, validator);\n    compactShorthands(_properties, options.sourceMap, validator);\n  }\n\n  restoreFromOptimizing(_properties);\n  removeUnused(_properties);\n}\n\nmodule.exports = optimize;\n"]}