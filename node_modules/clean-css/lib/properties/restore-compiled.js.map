{"version":3,"sources":["restore.js"],"names":[],"mappings":"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","file":"restore-compiled.js","sourcesContent":["var shallowClone = require('./clone').shallow;\nvar MULTIPLEX_SEPARATOR = ',';\nvar SIZE_POSITION_SEPARATOR = '/';\n\nfunction isInheritOnly(values) {\n  for (var i = 0, l = values.length; i < l; i++) {\n    var value = values[i][0];\n\n    if (value != 'inherit' && value != MULTIPLEX_SEPARATOR && value != SIZE_POSITION_SEPARATOR)\n      return false;\n  }\n\n  return true;\n}\n\nfunction background(property, compactable, lastInMultiplex) {\n  var components = property.components;\n  var restored = [];\n  var needsOne, needsBoth;\n\n  function restoreValue(component) {\n    Array.prototype.unshift.apply(restored, component.value);\n  }\n\n  function isDefaultValue(component) {\n    var descriptor = compactable[component.name];\n    if (descriptor.doubleValues) {\n      if (descriptor.defaultValue.length == 1)\n        return component.value[0][0] == descriptor.defaultValue[0] && (component.value[1] ? component.value[1][0] == descriptor.defaultValue[0] : true);\n      else\n        return component.value[0][0] == descriptor.defaultValue[0] && (component.value[1] ? component.value[1][0] : component.value[0][0]) == descriptor.defaultValue[1];\n    } else {\n      return component.value[0][0] == descriptor.defaultValue;\n    }\n  }\n\n  for (var i = components.length - 1; i >= 0; i--) {\n    var component = components[i];\n    var isDefault = isDefaultValue(component);\n\n    if (component.name == 'background-clip') {\n      var originComponent = components[i - 1];\n      var isOriginDefault = isDefaultValue(originComponent);\n\n      needsOne = component.value[0][0] == originComponent.value[0][0];\n\n      needsBoth = !needsOne && (\n        (isOriginDefault && !isDefault) ||\n        (!isOriginDefault && !isDefault) ||\n        (!isOriginDefault && isDefault && component.value[0][0] != originComponent.value[0][0]));\n\n      if (needsOne) {\n        restoreValue(originComponent);\n      } else if (needsBoth) {\n        restoreValue(component);\n        restoreValue(originComponent);\n      }\n\n      i--;\n    } else if (component.name == 'background-size') {\n      var positionComponent = components[i - 1];\n      var isPositionDefault = isDefaultValue(positionComponent);\n\n      needsOne = !isPositionDefault && isDefault;\n\n      needsBoth = !needsOne &&\n        (isPositionDefault && !isDefault || !isPositionDefault && !isDefault);\n\n      if (needsOne) {\n        restoreValue(positionComponent);\n      } else if (needsBoth) {\n        restoreValue(component);\n        restored.unshift([SIZE_POSITION_SEPARATOR]);\n        restoreValue(positionComponent);\n      } else if (positionComponent.value.length == 1) {\n        restoreValue(positionComponent);\n      }\n\n      i--;\n    } else {\n      if (isDefault || compactable[component.name].multiplexLastOnly && !lastInMultiplex)\n        continue;\n\n      restoreValue(component);\n    }\n  }\n\n  if (restored.length === 0 && property.value.length == 1 && property.value[0][0] == '0')\n    restored.push(property.value[0]);\n\n  if (restored.length === 0)\n    restored.push([compactable[property.name].defaultValue]);\n\n  if (isInheritOnly(restored))\n    return [restored[0]];\n\n  return restored;\n}\n\nfunction borderRadius(property, compactable) {\n  if (property.multiplex) {\n    var horizontal = shallowClone(property);\n    var vertical = shallowClone(property);\n\n    for (var i = 0; i < 4; i++) {\n      var component = property.components[i];\n\n      var horizontalComponent = shallowClone(property);\n      horizontalComponent.value = [component.value[0]];\n      horizontal.components.push(horizontalComponent);\n\n      var verticalComponent = shallowClone(property);\n      // FIXME: only shorthand compactor (see breakup#borderRadius) knows that border radius\n      // longhands have two values, whereas tokenizer does not care about populating 2nd value\n      // if it's missing, hence this fallback\n      verticalComponent.value = [component.value[1] || component.value[0]];\n      vertical.components.push(verticalComponent);\n    }\n\n    var horizontalValues = fourValues(horizontal, compactable);\n    var verticalValues = fourValues(vertical, compactable);\n\n    if (horizontalValues.length == verticalValues.length &&\n        horizontalValues[0][0] == verticalValues[0][0] &&\n        (horizontalValues.length > 1 ? horizontalValues[1][0] == verticalValues[1][0] : true) &&\n        (horizontalValues.length > 2 ? horizontalValues[2][0] == verticalValues[2][0] : true) &&\n        (horizontalValues.length > 3 ? horizontalValues[3][0] == verticalValues[3][0] : true)) {\n      return horizontalValues;\n    } else {\n      return horizontalValues.concat([['/']]).concat(verticalValues);\n    }\n  } else {\n    return fourValues(property, compactable);\n  }\n}\n\nfunction fourValues(property) {\n  var components = property.components;\n  var value1 = components[0].value[0];\n  var value2 = components[1].value[0];\n  var value3 = components[2].value[0];\n  var value4 = components[3].value[0];\n\n  if (value1[0] == value2[0] && value1[0] == value3[0] && value1[0] == value4[0]) {\n    return [value1];\n  } else if (value1[0] == value3[0] && value2[0] == value4[0]) {\n    return [value1, value2];\n  } else if (value2[0] == value4[0]) {\n    return [value1, value2, value3];\n  } else {\n    return [value1, value2, value3, value4];\n  }\n}\n\nfunction multiplex(restoreWith) {\n  return function (property, compactable) {\n    if (!property.multiplex)\n      return restoreWith(property, compactable, true);\n\n    var multiplexSize = 0;\n    var restored = [];\n    var componentMultiplexSoFar = {};\n    var i, l;\n\n    // At this point we don't know what's the multiplex size, e.g. how many background layers are there\n    for (i = 0, l = property.components[0].value.length; i < l; i++) {\n      if (property.components[0].value[i][0] == MULTIPLEX_SEPARATOR)\n        multiplexSize++;\n    }\n\n    for (i = 0; i <= multiplexSize; i++) {\n      var _property = shallowClone(property);\n\n      // We split multiplex into parts and restore them one by one\n      for (var j = 0, m = property.components.length; j < m; j++) {\n        var componentToClone = property.components[j];\n        var _component = shallowClone(componentToClone);\n        _property.components.push(_component);\n\n        // The trick is some properties has more than one value, so we iterate over values looking for\n        // a multiplex separator - a comma\n        for (var k = componentMultiplexSoFar[_component.name] || 0, n = componentToClone.value.length; k < n; k++) {\n          if (componentToClone.value[k][0] == MULTIPLEX_SEPARATOR) {\n            componentMultiplexSoFar[_component.name] = k + 1;\n            break;\n          }\n\n          _component.value.push(componentToClone.value[k]);\n        }\n      }\n\n      // No we can restore shorthand value\n      var lastInMultiplex = i == multiplexSize;\n      var _restored = restoreWith(_property, compactable, lastInMultiplex);\n      Array.prototype.push.apply(restored, _restored);\n\n      if (i < multiplexSize)\n        restored.push([',']);\n    }\n\n    return restored;\n  };\n}\n\nfunction withoutDefaults(property, compactable) {\n  var components = property.components;\n  var restored = [];\n\n  for (var i = components.length - 1; i >= 0; i--) {\n    var component = components[i];\n    var descriptor = compactable[component.name];\n\n    if (component.value[0][0] != descriptor.defaultValue)\n      restored.unshift(component.value[0]);\n  }\n\n  if (restored.length === 0)\n    restored.push([compactable[property.name].defaultValue]);\n\n  if (isInheritOnly(restored))\n    return [restored[0]];\n\n  return restored;\n}\n\nmodule.exports = {\n  background: background,\n  borderRadius: borderRadius,\n  fourValues: fourValues,\n  multiplex: multiplex,\n  withoutDefaults: withoutDefaults\n};\n"]}