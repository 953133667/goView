{"version":3,"sources":["override-compactor.js"],"names":[],"mappings":"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","file":"override-compactor-compiled.js","sourcesContent":["var canOverride = require('./can-override');\nvar compactable = require('./compactable');\nvar deepClone = require('./clone').deep;\nvar shallowClone = require('./clone').shallow;\nvar hasInherit = require('./has-inherit');\nvar restoreFromOptimizing = require('./restore-from-optimizing');\nvar everyCombination = require('./every-combination');\nvar sameVendorPrefixesIn = require('./vendor-prefixes').same;\n\nvar stringifyProperty = require('../stringifier/one-time').property;\n\nvar MULTIPLEX_SEPARATOR = ',';\n\n// Used when searching for a component that matches property\nfunction nameMatchFilter(to) {\n  return function (property) {\n    return to.name === property.name;\n  };\n}\n\nfunction wouldBreakCompatibility(property, validator) {\n  for (var i = 0; i < property.components.length; i++) {\n    var component = property.components[i];\n    var descriptor = compactable[component.name];\n    var canOverride = descriptor && descriptor.canOverride || canOverride.sameValue;\n\n    var _component = shallowClone(component);\n    _component.value = [[descriptor.defaultValue]];\n\n    if (!canOverride(_component, component, validator))\n      return true;\n  }\n\n  return false;\n}\n\nfunction isComponentOf(shorthand, longhand) {\n  return compactable[shorthand.name].components.indexOf(longhand.name) > -1;\n}\n\nfunction overrideIntoMultiplex(property, by) {\n  by.unused = true;\n\n  turnIntoMultiplex(by, multiplexSize(property));\n  property.value = by.value;\n}\n\nfunction overrideByMultiplex(property, by) {\n  by.unused = true;\n  property.multiplex = true;\n  property.value = by.value;\n}\n\nfunction overrideSimple(property, by) {\n  by.unused = true;\n  property.value = by.value;\n}\n\nfunction override(property, by) {\n  if (by.multiplex)\n    overrideByMultiplex(property, by);\n  else if (property.multiplex)\n    overrideIntoMultiplex(property, by);\n  else\n    overrideSimple(property, by);\n}\n\nfunction overrideShorthand(property, by) {\n  by.unused = true;\n\n  for (var i = 0, l = property.components.length; i < l; i++) {\n    override(property.components[i], by.components[i], property.multiplex);\n  }\n}\n\nfunction turnIntoMultiplex(property, size) {\n  property.multiplex = true;\n\n  for (var i = 0, l = property.components.length; i < l; i++) {\n    var component = property.components[i];\n    if (component.multiplex)\n      continue;\n\n    var value = component.value.slice(0);\n\n    for (var j = 1; j < size; j++) {\n      component.value.push([MULTIPLEX_SEPARATOR]);\n      Array.prototype.push.apply(component.value, value);\n    }\n  }\n}\n\nfunction multiplexSize(component) {\n  var size = 0;\n\n  for (var i = 0, l = component.value.length; i < l; i++) {\n    if (component.value[i][0] == MULTIPLEX_SEPARATOR)\n      size++;\n  }\n\n  return size + 1;\n}\n\nfunction lengthOf(property) {\n  var fakeAsArray = [[property.name]].concat(property.value);\n  return stringifyProperty([fakeAsArray], 0).length;\n}\n\nfunction moreSameShorthands(properties, startAt, name) {\n  // Since we run the main loop in `compactOverrides` backwards, at this point some\n  // properties may not be marked as unused.\n  // We should consider reverting the order if possible\n  var count = 0;\n\n  for (var i = startAt; i >= 0; i--) {\n    if (properties[i].name == name && !properties[i].unused)\n      count++;\n    if (count > 1)\n      break;\n  }\n\n  return count > 1;\n}\n\nfunction overridingFunction(shorthand, validator) {\n  for (var i = 0, l = shorthand.components.length; i < l; i++) {\n    if (anyValue(validator.isValidFunction, shorthand.components[i]))\n      return true;\n  }\n\n  return false;\n}\n\nfunction anyValue(fn, property) {\n  for (var i = 0, l = property.value.length; i < l; i++) {\n    if (property.value[i][0] == MULTIPLEX_SEPARATOR)\n      continue;\n\n    if (fn(property.value[i][0]))\n      return true;\n  }\n\n  return false;\n}\n\nfunction wouldResultInLongerValue(left, right) {\n  if (!left.multiplex && !right.multiplex || left.multiplex && right.multiplex)\n    return false;\n\n  var multiplex = left.multiplex ? left : right;\n  var simple = left.multiplex ? right : left;\n  var component;\n\n  var multiplexClone = deepClone(multiplex);\n  restoreFromOptimizing([multiplexClone]);\n\n  var simpleClone = deepClone(simple);\n  restoreFromOptimizing([simpleClone]);\n\n  var lengthBefore = lengthOf(multiplexClone) + 1 + lengthOf(simpleClone);\n\n  if (left.multiplex) {\n    component = multiplexClone.components.filter(nameMatchFilter(simpleClone))[0];\n    overrideIntoMultiplex(component, simpleClone);\n  } else {\n    component = simpleClone.components.filter(nameMatchFilter(multiplexClone))[0];\n    turnIntoMultiplex(simpleClone, multiplexSize(multiplexClone));\n    overrideByMultiplex(component, multiplexClone);\n  }\n\n  restoreFromOptimizing([simpleClone]);\n\n  var lengthAfter = lengthOf(simpleClone);\n\n  return lengthBefore < lengthAfter;\n}\n\nfunction isCompactable(property) {\n  return property.name in compactable;\n}\n\nfunction noneOverrideHack(left, right) {\n  return !left.multiplex &&\n    (left.name == 'background' || left.name == 'background-image') &&\n    right.multiplex &&\n    (right.name == 'background' || right.name == 'background-image') &&\n    anyLayerIsNone(right.value);\n}\n\nfunction anyLayerIsNone(values) {\n  var layers = intoLayers(values);\n\n  for (var i = 0, l = layers.length; i < l; i++) {\n    if (layers[i].length == 1 && layers[i][0][0] == 'none')\n      return true;\n  }\n\n  return false;\n}\n\nfunction intoLayers(values) {\n  var layers = [];\n\n  for (var i = 0, layer = [], l = values.length; i < l; i++) {\n    var value = values[i];\n    if (value[0] == MULTIPLEX_SEPARATOR) {\n      layers.push(layer);\n      layer = [];\n    } else {\n      layer.push(value);\n    }\n  }\n\n  layers.push(layer);\n  return layers;\n}\n\nfunction compactOverrides(properties, compatibility, validator) {\n  var mayOverride, right, left, component;\n  var i, j, k;\n\n  propertyLoop:\n  for (i = properties.length - 1; i >= 0; i--) {\n    right = properties[i];\n\n    if (!isCompactable(right))\n      continue;\n\n    if (right.variable)\n      continue;\n\n    mayOverride = compactable[right.name].canOverride || canOverride.sameValue;\n\n    for (j = i - 1; j >= 0; j--) {\n      left = properties[j];\n\n      if (!isCompactable(left))\n        continue;\n\n      if (left.variable)\n        continue;\n\n      if (left.unused || right.unused)\n        continue;\n\n      if (left.hack && !right.hack || !left.hack && right.hack)\n        continue;\n\n      if (hasInherit(right))\n        continue;\n\n      if (noneOverrideHack(left, right))\n        continue;\n\n      if (!left.shorthand && right.shorthand && isComponentOf(right, left)) {\n        // maybe `left` can be overridden by `right` which is a shorthand?\n        if (!right.important && left.important)\n          continue;\n\n        if (!sameVendorPrefixesIn([left], right.components))\n          continue;\n\n        if (!anyValue(validator.isValidFunction, left) && overridingFunction(right, validator))\n          continue;\n\n        component = right.components.filter(nameMatchFilter(left))[0];\n        mayOverride = (compactable[left.name] && compactable[left.name].canOverride) || canOverride.sameValue;\n        if (everyCombination(mayOverride, left, component, validator)) {\n          left.unused = true;\n        }\n      } else if (left.shorthand && !right.shorthand && isComponentOf(left, right)) {\n        // maybe `right` can be pulled into `left` which is a shorthand?\n        if (right.important && !left.important)\n          continue;\n\n        // Pending more clever algorithm in #527\n        if (moreSameShorthands(properties, i - 1, left.name))\n          continue;\n\n        if (overridingFunction(left, validator))\n          continue;\n\n        component = left.components.filter(nameMatchFilter(right))[0];\n        if (everyCombination(mayOverride, component, right, validator)) {\n          var disabledBackgroundMerging =\n            !compatibility.properties.backgroundClipMerging && component.name.indexOf('background-clip') > -1 ||\n            !compatibility.properties.backgroundOriginMerging && component.name.indexOf('background-origin') > -1 ||\n            !compatibility.properties.backgroundSizeMerging && component.name.indexOf('background-size') > -1;\n          var nonMergeableValue = compactable[right.name].nonMergeableValue === right.value[0][0];\n\n          if (disabledBackgroundMerging || nonMergeableValue)\n            continue;\n\n          if (!compatibility.properties.merging && wouldBreakCompatibility(left, validator))\n            continue;\n\n          if (component.value[0][0] != right.value[0][0] && (hasInherit(left) || hasInherit(right)))\n            continue;\n\n          if (wouldResultInLongerValue(left, right))\n            continue;\n\n          if (!left.multiplex && right.multiplex)\n            turnIntoMultiplex(left, multiplexSize(right));\n\n          override(component, right);\n          left.dirty = true;\n        }\n      } else if (left.shorthand && right.shorthand && left.name == right.name) {\n        // merge if all components can be merged\n\n        if (!left.multiplex && right.multiplex)\n          continue;\n\n        if (!right.important && left.important) {\n          right.unused = true;\n          continue propertyLoop;\n        }\n\n        if (right.important && !left.important) {\n          left.unused = true;\n          continue;\n        }\n\n        for (k = left.components.length - 1; k >= 0; k--) {\n          var leftComponent = left.components[k];\n          var rightComponent = right.components[k];\n\n          mayOverride = compactable[leftComponent.name].canOverride || canOverride.sameValue;\n          if (!everyCombination(mayOverride, leftComponent, rightComponent, validator))\n            continue propertyLoop;\n          if (!everyCombination(canOverride.twoOptionalFunctions, leftComponent, rightComponent, validator) && validator.isValidFunction(rightComponent))\n            continue propertyLoop;\n        }\n\n        overrideShorthand(left, right);\n        left.dirty = true;\n      } else if (left.shorthand && right.shorthand && isComponentOf(left, right)) {\n        // border is a shorthand but any of its components is a shorthand too\n\n        if (!left.important && right.important)\n          continue;\n\n        component = left.components.filter(nameMatchFilter(right))[0];\n        mayOverride = compactable[right.name].canOverride || canOverride.sameValue;\n        if (!everyCombination(mayOverride, component, right, validator))\n          continue;\n\n        if (left.important && !right.important) {\n          right.unused = true;\n          continue;\n        }\n\n        var rightRestored = compactable[right.name].restore(right, compactable);\n        if (rightRestored.length > 1)\n          continue;\n\n        component = left.components.filter(nameMatchFilter(right))[0];\n        override(component, right);\n        right.dirty = true;\n      } else if (left.name == right.name) {\n        // two non-shorthands should be merged based on understandability\n\n        if (left.important && !right.important) {\n          right.unused = true;\n          continue;\n        }\n\n        mayOverride = compactable[right.name].canOverride || canOverride.sameValue;\n        if (!everyCombination(mayOverride, left, right, validator))\n          continue;\n\n        left.unused = true;\n      }\n    }\n  }\n}\n\nmodule.exports = compactOverrides;\n"]}