{"version":3,"sources":["ModulesInDirectoriesPlugin.js"],"names":[],"mappings":"AAAA;;;;AAIA,IAAI,sBAAsB,QAAQ,uBAAR,CAA1B;AACA,IAAI,iBAAiB,QAAQ,kBAAR,CAArB;;AAEA,SAAS,0BAAT,CAAoC,UAApC,EAAgD,WAAhD,EAA6D;AAC5D,MAAK,UAAL,GAAkB,UAAlB;AACA,MAAK,WAAL,GAAmB,WAAnB;AACA;AACD,OAAO,OAAP,GAAiB,0BAAjB;;AAEA,2BAA2B,SAA3B,CAAqC,KAArC,GAA6C,UAAS,QAAT,EAAmB;AAC/D,KAAI,aAAa,KAAK,UAAtB;AACA,KAAI,cAAc,KAAK,WAAvB;AACA,UAAS,MAAT,CAAgB,QAAhB,EAA0B,UAAS,OAAT,EAAkB,QAAlB,EAA4B;AACrD,MAAI,KAAK,KAAK,UAAd;AACA,MAAI,QAAQ,CAAC,QAAQ,IAAT,CAAZ;AACA,MAAI,OAAO,CAAC,QAAQ,IAAT,CAAX;AACA,MAAI,cAAc,eAAe,IAAf,CAAlB;AACA,MAAI,mBAAmB,QAAvB;AACA,SAAM,WAAN,EAAmB;AAClB,SAAM,IAAN,CAAW,KAAK,CAAL,CAAX;AACA,iBAAc,eAAe,IAAf,CAAd;AACA;AACD,MAAI,QAAQ,MAAM,GAAN,CAAU,UAAS,CAAT,EAAY;AACjC,UAAO,YAAY,GAAZ,CAAgB,UAAS,CAAT,EAAY;AAClC,WAAO,KAAK,IAAL,CAAU,CAAV,EAAa,CAAb,CAAP;AACA,IAFM,EAEJ,IAFI,CAAP;AAGA,GAJW,EAIT,IAJS,EAIH,MAJG,CAII,UAAS,KAAT,EAAgB,CAAhB,EAAmB;AAClC,SAAM,IAAN,CAAW,KAAX,CAAiB,KAAjB,EAAwB,CAAxB;AACA,UAAO,KAAP;AACA,GAPW,EAOT,EAPS,CAAZ;AAQA,OAAK,WAAL,CAAiB,KAAjB,EAAwB,UAAS,IAAT,EAAe,QAAf,EAAyB;AAChD,MAAG,IAAH,CAAQ,IAAR,EAAc,UAAS,GAAT,EAAc,IAAd,EAAoB;AACjC,QAAG,CAAC,GAAD,IAAQ,IAAR,IAAgB,KAAK,WAAL,EAAnB,EAAuC;AACtC,UAAK,8BAAL,CAAoC,YAAY,UAAhD,EAA4D;AAC3D,YAAM,IADqD;AAE3D,eAAS,QAAQ,OAF0C;AAG3D,aAAO,QAAQ,KAH4C;AAI3D,iBAAW,QAAQ;AAJwC,MAA5D,EAKG,oBAAoB,UAAS,GAAT,EAAc,MAAd,EAAsB;AAC5C,UAAG,GAAH,EAAQ,OAAO,SAAS,GAAT,CAAP;AACR,UAAG,CAAC,MAAJ,EAAY,OAAO,UAAP;AACZ,aAAO,SAAS,IAAT,EAAe,MAAf,CAAP;AACA,MAJE,EAIA,gBAJA,EAIkB,4BAA4B,IAJ9C,CALH;AAUA;AACA;AACD,WAAO,UAAP;AACA,IAfa,CAeZ,IAfY,CAeP,IAfO,CAAd;AAgBA,GAjBuB,CAiBtB,IAjBsB,CAiBjB,IAjBiB,CAAxB,EAiBc,UAAS,GAAT,EAAc,MAAd,EAAsB;AACnC,OAAG,GAAH,EAAQ,OAAO,SAAS,GAAT,CAAP;AACR,OAAG,CAAC,MAAJ,EAAY,OAAO,UAAP;AACZ,UAAO,SAAS,IAAT,EAAe,MAAf,CAAP;AACA,GArBD;AAsBA,EAxCD;AAyCA,CA5CD","file":"ModulesInDirectoriesPlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\nvar popPathSeqment = require(\"./popPathSeqment\");\r\n\r\nfunction ModulesInDirectoriesPlugin(moduleType, directories) {\r\n\tthis.moduleType = moduleType;\r\n\tthis.directories = directories;\r\n}\r\nmodule.exports = ModulesInDirectoriesPlugin;\r\n\r\nModulesInDirectoriesPlugin.prototype.apply = function(resolver) {\r\n\tvar moduleType = this.moduleType;\r\n\tvar directories = this.directories;\r\n\tresolver.plugin(\"module\", function(request, callback) {\r\n\t\tvar fs = this.fileSystem;\r\n\t\tvar paths = [request.path];\r\n\t\tvar addr = [request.path];\r\n\t\tvar pathSeqment = popPathSeqment(addr);\r\n\t\tvar topLevelCallback = callback;\r\n\t\twhile(pathSeqment) {\r\n\t\t\tpaths.push(addr[0]);\r\n\t\t\tpathSeqment = popPathSeqment(addr);\r\n\t\t}\r\n\t\tvar addrs = paths.map(function(p) {\r\n\t\t\treturn directories.map(function(d) {\r\n\t\t\t\treturn this.join(p, d);\r\n\t\t\t}, this);\r\n\t\t}, this).reduce(function(array, p) {\r\n\t\t\tarray.push.apply(array, p);\r\n\t\t\treturn array;\r\n\t\t}, []);\r\n\t\tthis.forEachBail(addrs, function(addr, callback) {\r\n\t\t\tfs.stat(addr, function(err, stat) {\r\n\t\t\t\tif(!err && stat && stat.isDirectory()) {\r\n\t\t\t\t\tthis.applyPluginsParallelBailResult(\"module-\" + moduleType, {\r\n\t\t\t\t\t\tpath: addr,\r\n\t\t\t\t\t\trequest: request.request,\r\n\t\t\t\t\t\tquery: request.query,\r\n\t\t\t\t\t\tdirectory: request.directory\r\n\t\t\t\t\t}, createInnerCallback(function(err, result) {\r\n\t\t\t\t\t\tif(err) return callback(err);\r\n\t\t\t\t\t\tif(!result) return callback();\r\n\t\t\t\t\t\treturn callback(null, result);\r\n\t\t\t\t\t}, topLevelCallback, \"looking for modules in \" + addr));\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treturn callback();\r\n\t\t\t}.bind(this));\r\n\t\t}.bind(this), function(err, result) {\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(!result) return callback();\r\n\t\t\treturn callback(null, result);\r\n\t\t});\r\n\t});\r\n};\r\n"]}