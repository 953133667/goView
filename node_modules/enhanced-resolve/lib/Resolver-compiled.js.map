{"version":3,"sources":["Resolver.js"],"names":[],"mappings":"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","file":"Resolver-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar Tapable = require(\"tapable\");\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction Resolver(fileSystem) {\r\n\tTapable.call(this);\r\n\tthis.fileSystem = fileSystem;\r\n}\r\nmodule.exports = Resolver;\r\n\r\nResolver.prototype = Object.create(Tapable.prototype);\r\n\r\nResolver.prototype.resolveSync = function resolveSync(context, request) {\r\n\tvar err, result, sync = false;\r\n\tthis.resolve(context, request, function(e, r) {\r\n\t\terr = e;\r\n\t\tresult = r;\r\n\t\tsync = true;\r\n\t});\r\n\tif(!sync) throw new Error(\"Cannot 'resolveSync' because the fileSystem is not sync. Use 'resolve'!\");\r\n\tif(err) throw err;\r\n\treturn result;\r\n};\r\n\r\nResolver.prototype.resolve = function resolve(context, request, callback) {\r\n\tif(typeof request === \"string\") request = this.parse(request);\r\n\tthis.applyPlugins(\"resolve\", context, request);\r\n\tvar obj = {\r\n\t\tpath: context,\r\n\t\trequest: request.path,\r\n\t\tquery: request.query,\r\n\t\tdirectory: request.directory\r\n\t};\r\n\tfunction onResolved(err, result) {\r\n\t\tif(err) return callback(err);\r\n\t\treturn callback(null, result.path === false ? false : result.path + (result.query || \"\"));\r\n\t}\r\n\tonResolved.log = callback.log;\r\n\tonResolved.missing = callback.missing;\r\n\tif(request.module) return this.doResolve(\"module\", obj, onResolved);\r\n\tif(request.directory) return this.doResolve(\"directory\", obj, onResolved);\r\n\treturn this.doResolve([\"file\", \"directory\"], obj, onResolved);\r\n};\r\n\r\nResolver.prototype.doResolve = function doResolve(types, request, callback, noError) {\r\n\tif(!Array.isArray(types)) types = [types];\r\n\tvar stackLine = types.join(\" or \") + \": (\" + request.path + \") \" +\r\n\t\t(request.request || \"\") + (request.query || \"\") +\r\n\t\t(request.directory ? \" directory\" : \"\") +\r\n\t\t(request.module ? \" module\" : \"\");\r\n\tvar newStack = [stackLine];\r\n\tif(callback.stack) {\r\n\t\tnewStack = callback.stack.concat(newStack);\r\n\t\tif(callback.stack.indexOf(stackLine) >= 0) {\r\n\t\t\t// Prevent recursion\r\n\t\t\tvar recursionError = new Error(\"Recursion in resolving\\nStack:\\n  \" + newStack.join(\"\\n  \"));\r\n\t\t\trecursionError.recursion = true;\r\n\t\t\tif(callback.log) callback.log(\"abort resolving because of recursion\");\r\n\t\t\treturn callback(recursionError);\r\n\t\t}\r\n\t}\r\n\tthis.applyPlugins(\"resolve-step\", types, request);\r\n\tvar localMissing = [];\r\n\tvar missing = callback.missing ? {\r\n\t\tpush: function(item) {\r\n\t\t\tcallback.missing.push(item);\r\n\t\t\tlocalMissing.push(item);\r\n\t\t}\r\n\t} : localMissing;\r\n\tvar log = [];\r\n\tfunction writeLog(msg) {\r\n\t\tlog.push(msg);\r\n\t}\r\n\tfunction logAsString() {\r\n\t\treturn log.join(\"\\n\");\r\n\t}\r\n\tvar currentRequestString = request.request ? request.request + \" in \" + request.path : request.path;\r\n\tif(types.length == 1 && !noError) {\r\n\t\t// If only one type, we can pass the error.\r\n\t\treturn this.applyPluginsParallelBailResult(types[0], request, createInnerCallback(function innerCallback(err, result) {\r\n\t\t\tif(callback.log) {\r\n\t\t\t\tfor(var i = 0; i < log.length; i++)\r\n\t\t\t\t\tcallback.log(log[i]);\r\n\t\t\t}\r\n\t\t\tif(err) return callback(err);\r\n\t\t\tif(result) return callback(null, result);\r\n\t\t\tif(types[0] === \"result\") return callback(null, request);\r\n\t\t\tvar error = new Error(\"Cannot resolve \" + types[0] + \" '\" + request.request + \"' in \" + request.path);\r\n\t\t\terror.details = logAsString();\r\n\t\t\terror.missing = localMissing;\r\n\t\t\treturn callback(error);\r\n\t\t}, {\r\n\t\t\tlog: writeLog,\r\n\t\t\tmissing: missing,\r\n\t\t\tstack: newStack\r\n\t\t}, \"resolve \" + types[0] + \" \" + currentRequestString));\r\n\t}\r\n\t// For multiple type we list the errors in the details although some of them are not important\r\n\tthis.forEachBail(types, function(type, callback) {\r\n\t\tthis.applyPluginsParallelBailResult(type, request, createInnerCallback(function(err, result) {\r\n\t\t\tif(!err && result) return callback(result);\r\n\t\t\tif (err) {\r\n\t\t\t\t(err.message || \"\").split(\"\\n\").forEach(function(line) {\r\n\t\t\t\t\tlog.push(\"  \" + line);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tcallback();\r\n\t\t}, {\r\n\t\t\tlog: writeLog,\r\n\t\t\tmissing: missing,\r\n\t\t\tstack: newStack\r\n\t\t}, \"resolve \" + type));\r\n\t}.bind(this), function(result) {\r\n\t\tif(callback.log) {\r\n\t\t\tcallback.log(\"resolve '\" + types.join(\"' or '\") + \"' \" + currentRequestString);\r\n\t\t\tfor(var i = 0; i < log.length; i++)\r\n\t\t\t\tcallback.log(\"  \" + log[i]);\r\n\t\t}\r\n\t\tif(noError && !result) return callback();\r\n\t\tif(result) return callback(null, result);\r\n\t\tvar error = new Error(\"Cannot resolve '\" + types.join(\"' or '\") + \"' \" + currentRequestString);\r\n\t\terror.details = logAsString();\r\n\t\terror.missing = localMissing;\r\n\t\treturn callback(error);\r\n\t});\r\n};\r\n\r\nResolver.prototype.parse = function parse(identifier) {\r\n\tif(identifier === \"\") return null;\r\n\tvar part = {\r\n\t\tpath: null,\r\n\t\tquery: null,\r\n\t\tmodule: false,\r\n\t\tdirectory: false,\r\n\t\tfile: false\r\n\t};\r\n\tvar idxQuery = identifier.indexOf(\"?\");\r\n\tif(idxQuery == 0) {\r\n\t\tpart.query = identifier;\r\n\t} else if(idxQuery > 0) {\r\n\t\tpart.path = identifier.slice(0, idxQuery);\r\n\t\tpart.query = identifier.slice(idxQuery);\r\n\t} else {\r\n\t\tpart.path = identifier;\r\n\t}\r\n\tif(part.path) {\r\n\t\tpart.module = this.isModule(part.path);\r\n\t\tif(part.directory = this.isDirectory(part.path)) {\r\n\t\t\tpart.path = part.path.substr(0, part.path.length - 1);\r\n\t\t}\r\n\t}\r\n\treturn part;\r\n};\r\n\r\nvar notModuleRegExp = /^\\.$|^\\.[\\\\\\/]|^\\.\\.$|^\\.\\.[\\/\\\\]|^\\/|^[A-Z]:[\\\\\\/]/i;\r\nResolver.prototype.isModule = function isModule(path) {\r\n\treturn !notModuleRegExp.test(path);\r\n};\r\n\r\nvar directoryRegExp = /[\\/\\\\]$/i;\r\nResolver.prototype.isDirectory = function isDirectory(path) {\r\n\treturn directoryRegExp.test(path);\r\n};\r\n\r\nResolver.prototype.join = require(\"memory-fs/lib/join\");\r\n\r\nResolver.prototype.normalize = require(\"memory-fs/lib/normalize\");\r\n\r\nResolver.prototype.forEachBail = function(array, iterator, callback) {\r\n\tif(array.length == 0) return callback();\r\n\tvar currentPos = array.length;\r\n\tvar currentError, currentResult;\r\n\tvar done = [];\r\n\tfor(var i = 0; i < array.length; i++) {\r\n\t\tvar itCb = (function(i) {\r\n\t\t\treturn function() {\r\n\t\t\t\tif(i >= currentPos) return; // ignore\r\n\t\t\t\tvar args = Array.prototype.slice.call(arguments);\r\n\t\t\t\tdone.push(i);\r\n\t\t\t\tif(args.length > 0) {\r\n\t\t\t\t\tcurrentPos = i + 1;\r\n\t\t\t\t\tdone = done.filter(function(item) {\r\n\t\t\t\t\t\treturn item <= i;\r\n\t\t\t\t\t});\r\n\t\t\t\t\tcurrentResult = args;\r\n\t\t\t\t}\r\n\t\t\t\tif(done.length == currentPos) {\r\n\t\t\t\t\tcallback.apply(null, currentResult);\r\n\t\t\t\t\tcurrentPos = 0;\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}(i));\r\n\t\titerator(array[i], itCb);\r\n\t\tif(currentPos == 0) break;\r\n\t}\r\n};\r\n\r\n"]}