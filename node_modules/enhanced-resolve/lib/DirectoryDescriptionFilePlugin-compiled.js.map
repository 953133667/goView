{"version":3,"sources":["DirectoryDescriptionFilePlugin.js"],"names":[],"mappings":"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","file":"DirectoryDescriptionFilePlugin-compiled.js","sourcesContent":["/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nvar createInnerCallback = require(\"./createInnerCallback\");\r\n\r\nfunction DirectoryDescriptionFilePlugin(filename, fields) {\r\n\tthis.filename = filename;\r\n\tthis.fields = fields;\r\n}\r\nmodule.exports = DirectoryDescriptionFilePlugin;\r\n\r\nDirectoryDescriptionFilePlugin.prototype.apply = function(resolver) {\r\n\tvar filename = this.filename;\r\n\tvar fields = this.fields;\r\n\tresolver.plugin(\"directory\", function(request, callback) {\r\n\t\tvar fs = this.fileSystem;\r\n\t\tvar directory = this.join(request.path, request.request);\r\n\t\tvar descriptionFilePath = this.join(directory, filename);\r\n\t\tfs.readFile(descriptionFilePath, function(err, content) {\r\n\t\t\tif(err) {\r\n\t\t\t\tif(callback.log)\r\n\t\t\t\t\tcallback.log(descriptionFilePath + \" doesn't exist (directory description file)\");\r\n\t\t\t\treturn callback();\r\n\t\t\t}\r\n\t\t\tcontent = content.toString(\"utf-8\");\r\n\t\t\ttry {\r\n\t\t\t\tcontent = JSON.parse(content);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tif(callback.log)\r\n\t\t\t\t\tcallback.log(descriptionFilePath + \" (directory description file): \" + e);\r\n\t\t\t\telse\r\n\t\t\t\t\te.message = descriptionFilePath + \" (directory description file): \" + e;\r\n\t\t\t\treturn callback(e);\r\n\t\t\t}\r\n\t\t\tvar mainModules = [];\r\n\t\t\tfor(var i = 0; i < fields.length; i++) {\r\n\t\t\t\tif(Array.isArray(fields[i])) {\r\n\t\t\t\t\tvar current = content;\r\n\t\t\t\t\tfor(var j = 0; j < fields[i].length; j++) {\r\n\t\t\t\t\t\tif(current === null || typeof current !== \"object\") {\r\n\t\t\t\t\t\t\tcurrent = null;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar field = fields[i][j];\r\n\t\t\t\t\t\tcurrent = current[field];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif(typeof current === \"string\") {\r\n\t\t\t\t\t\tmainModules.push(current);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar field = fields[i];\r\n\t\t\t\t\tif(typeof content[field] === \"string\") {\r\n\t\t\t\t\t\tmainModules.push(content[field]);\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t(function next() {\r\n\t\t\t\tif(mainModules.length == 0) return callback();\r\n\t\t\t\tvar mainModule = mainModules.shift();\r\n\t\t\t\treturn this.doResolve([\"file\", \"directory\"], {\r\n\t\t\t\t\tpath: directory,\r\n\t\t\t\t\tquery: request.query,\r\n\t\t\t\t\trequest: mainModule\r\n\t\t\t\t}, createInnerCallback(function(err, result) {\r\n\t\t\t\t\tif(!err && result) return callback(null, result);\r\n\t\t\t\t\treturn next.call(this);\r\n\t\t\t\t}.bind(this), callback, \"use \" + mainModule + \" from \" + filename));\r\n\t\t\t}.call(this))\r\n\t\t}.bind(this));\r\n\t});\r\n};"]}